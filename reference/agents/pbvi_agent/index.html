
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../model_based_util/vi_solver/">
      
      
        <link rel="next" href="../pbvi_ger_agent/">
      
      
        
      
      
      <link rel="icon" href="../../../img/squid_drawing.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>pbvi_agent - Olfactory Navigation Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#olfactory_navigation.agents.pbvi_agent" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="Olfactory Navigation Documentation" class="md-header__button md-logo" aria-label="Olfactory Navigation Documentation" data-md-component="logo">
      
  <img src="../../../img/squid_drawing.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Olfactory Navigation Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              pbvi_agent
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12s-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/PimLb/olfactory-navigation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    PimLb/olfactory-navigation
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../../.." class="md-tabs__link">
        
  
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../../" class="md-tabs__link">
          
  
  
  Code Reference

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../../tutorials/environment_description/" class="md-tabs__link">
          
  
  
  Tutorials

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="Olfactory Navigation Documentation" class="md-nav__button md-logo" aria-label="Olfactory Navigation Documentation" data-md-component="logo">
      
  <img src="../../../img/squid_drawing.png" alt="logo">

    </a>
    Olfactory Navigation Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PimLb/olfactory-navigation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    PimLb/olfactory-navigation
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Home
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    
  
    Code Reference
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Code Reference
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    olfactory_navigation
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            
  
    olfactory_navigation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" checked>
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    agents
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    agents
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fsvi_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    fsvi_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../hsvi_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    hsvi_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../infotaxis_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    infotaxis_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2_4" >
        
          
          <div class="md-nav__link md-nav__container">
            <a href="../model_based_util/" class="md-nav__link ">
              
  
  
  <span class="md-ellipsis">
    
  
    model_based_util
  

    
  </span>
  
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_2_4" id="__nav_2_1_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    model_based_util
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_based_util/belief/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    belief
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_based_util/belief_value_mapping/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    belief_value_mapping
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_based_util/environment_converter/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    environment_converter
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_based_util/mdp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    mdp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_based_util/pomdp/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pomdp
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_based_util/value_function/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    value_function
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../model_based_util/vi_solver/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    vi_solver
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    pbvi_agent
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    pbvi_agent
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        pbvi_agent
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        PBVI_Agent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PBVI_Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.backup" class="md-nav__link">
    <span class="md-ellipsis">
      
        backup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.choose_action" class="md-nav__link">
    <span class="md-ellipsis">
      
        choose_action
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.compute_change" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.expand" class="md-nav__link">
    <span class="md-ellipsis">
      
        expand
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.generate_beliefs_from_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_beliefs_from_trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.initialize_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.kill" class="md-nav__link">
    <span class="md-ellipsis">
      
        kill
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.load" class="md-nav__link">
    <span class="md-ellipsis">
      
        load
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.modify_environment" class="md-nav__link">
    <span class="md-ellipsis">
      
        modify_environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.save" class="md-nav__link">
    <span class="md-ellipsis">
      
        save
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.to_cpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_cpu
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.to_gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_gpu
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.train" class="md-nav__link">
    <span class="md-ellipsis">
      
        train
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.update_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_state
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory" class="md-nav__link">
    <span class="md-ellipsis">
      
        TrainingHistory
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TrainingHistory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.explored_beliefs" class="md-nav__link">
    <span class="md-ellipsis">
      
        explored_beliefs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.add_backup_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_backup_step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.add_expand_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_expand_step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.add_prune_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_prune_step
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pbvi_ger_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pbvi_ger_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pbvi_ra_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pbvi_ra_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pbvi_ssea_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pbvi_ssea_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pbvi_ssga_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pbvi_ssga_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pbvi_ssra_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    pbvi_ssra_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../perseus_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    perseus_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../q_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    q_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../qmdp_agent/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    qmdp_agent
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../build_environment_gui/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    build_environment_gui
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../environment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    environment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../simulation/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    simulation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../test_setups/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    test_setups
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../visualization/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    visualization
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Tutorials
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Tutorials
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/environment_description/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is an Environment?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/agent_description/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What is an Agent?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/simulation_process/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    How does a simulation work?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../tutorials/available_tests/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    What tests are available?
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        pbvi_agent
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent" class="md-nav__link">
    <span class="md-ellipsis">
      
        PBVI_Agent
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="PBVI_Agent">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.backup" class="md-nav__link">
    <span class="md-ellipsis">
      
        backup
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.choose_action" class="md-nav__link">
    <span class="md-ellipsis">
      
        choose_action
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.compute_change" class="md-nav__link">
    <span class="md-ellipsis">
      
        compute_change
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.expand" class="md-nav__link">
    <span class="md-ellipsis">
      
        expand
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.generate_beliefs_from_trajectory" class="md-nav__link">
    <span class="md-ellipsis">
      
        generate_beliefs_from_trajectory
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.initialize_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        initialize_state
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.kill" class="md-nav__link">
    <span class="md-ellipsis">
      
        kill
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.load" class="md-nav__link">
    <span class="md-ellipsis">
      
        load
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.modify_environment" class="md-nav__link">
    <span class="md-ellipsis">
      
        modify_environment
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.save" class="md-nav__link">
    <span class="md-ellipsis">
      
        save
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.to_cpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_cpu
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.to_gpu" class="md-nav__link">
    <span class="md-ellipsis">
      
        to_gpu
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.train" class="md-nav__link">
    <span class="md-ellipsis">
      
        train
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent.update_state" class="md-nav__link">
    <span class="md-ellipsis">
      
        update_state
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory" class="md-nav__link">
    <span class="md-ellipsis">
      
        TrainingHistory
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="TrainingHistory">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.explored_beliefs" class="md-nav__link">
    <span class="md-ellipsis">
      
        explored_beliefs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.solution" class="md-nav__link">
    <span class="md-ellipsis">
      
        solution
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.summary" class="md-nav__link">
    <span class="md-ellipsis">
      
        summary
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.add_backup_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_backup_step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.add_expand_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_expand_step
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.add_prune_step" class="md-nav__link">
    <span class="md-ellipsis">
      
        add_prune_step
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
                



  


  <nav class="md-path" aria-label="Navigation" >
    <ol class="md-path__list">
      
        
  
  
    <li class="md-path__item">
      <a href="../../.." class="md-path__link">
        
  <span class="md-ellipsis">
    Home
  </span>

      </a>
    </li>
  

      
      
        
  
  
    
    
      
  
  
    
    
      <li class="md-path__item">
        <a href="../../agent/" class="md-path__link">
          
  <span class="md-ellipsis">
    Code Reference
  </span>

        </a>
      </li>
    
  

    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../../agent/" class="md-path__link">
          
  <span class="md-ellipsis">
    olfactory_navigation
  </span>

        </a>
      </li>
    
  

      
        
  
  
    
    
      <li class="md-path__item">
        <a href="../fsvi_agent/" class="md-path__link">
          
  <span class="md-ellipsis">
    agents
  </span>

        </a>
      </li>
    
  

      
    </ol>
  </nav>

              
              <article class="md-content__inner md-typeset">
                
                  


  
  


  <h1>pbvi_agent</h1>

<div class="doc doc-object doc-module">



<a id="olfactory_navigation.agents.pbvi_agent"></a>
    <div class="doc doc-contents first">










<div class="doc doc-children">









<div class="doc doc-object doc-class">



<h2 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent" class="doc doc-heading">
            <code>PBVI_Agent</code>


</h2>


    <div class="doc doc-contents ">
            <p class="doc doc-class-bases">
              Bases: <code><a class="autorefs autorefs-internal" title="Agent (olfactory_navigation.agent.Agent)" href="../../agent/#olfactory_navigation.agent.Agent">Agent</a></code></p>



        <p>A generic Point-Based Value Iteration based agent. It relies on Model-Based reinforcement learning as described in: Pineau J. et al, Point-based value iteration: An anytime algorithm for POMDPs
The training consist in two steps:</p>
<ul>
<li>
<p>Expand: Where belief points are explored based on the some strategy (to be defined by subclasses).</p>
</li>
<li>
<p>Backup: Using the generated belief points, the value function is updated.</p>
</li>
</ul>
<p>The belief points are probability distributions over the state space and are therefore vectors of |S| elements.</p>
<p>Actions are chosen based on a value function. A value function is a set of alpha vectors of dimentionality |S|.
Each alpha vector is associated to a single action but multiple alpha vectors can be associated to the same action.
To choose an action at a given belief point, a dot product is taken between each alpha vector and the belief point and the action associated with the highest result is chosen.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>environment</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Environment (olfactory_navigation.environment.Environment)" href="../../environment/#olfactory_navigation.environment.Environment">Environment</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The olfactory environment to train the agent with.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>thresholds</code>
            </td>
            <td>
                  <code><span title="float">float</span> or <span title="list">list</span>[<span title="float">float</span>] or <span title="dict">dict</span>[<span title="str">str</span>, <span title="float">float</span>] or <span title="dict">dict</span>[<span title="str">str</span>, <span title="list">list</span>[<span title="float">float</span>]]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The olfactory thresholds. If an odor cue above this threshold is detected, the agent detects it, else it does not.
If a list of thresholds is provided, he agent should be able to detect |thresholds|+1 levels of odor.
A dictionary of (list of) thresholds can also be provided when the environment is layered.
In such case, the number of layers provided must match the environment's layers and their labels must match.
The thresholds provided will be converted to an array where the levels start with -inf and end with +inf.</p>
              </div>
            </td>
            <td>
                  <code>3e-6</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>space_aware</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the agent is aware of it's own position in space.
This is to be used in scenarios where, for example, the agent is an enclosed container and the source is the variable.
Note: The observation array will have a different shape when returned to the update_state function!</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spacial_subdivisions</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many spacial compartments the agent has to internally represent the space it lives in.
By default, it will be as many as there are grid points in the environment.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>actions</code>
            </td>
            <td>
                  <code><span title="dict">dict</span> or <span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The set of action available to the agent. It should match the type of environment (ie: if the environment has layers, it should contain a layer component to the action vector, and similarly for a third dimension).
Else, a dict of strings and action vectors where the strings represent the action labels.
If none is provided, by default, all unit movement vectors are included and shuch for all layers (if the environment has layers.)</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A custom name to give the agent. If not provided is will be a combination of the class-name and the threshold.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>For reproducible randomness.</p>
              </div>
            </td>
            <td>
                  <code>12131415</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Model (olfactory_navigation.agents.model_based_util.pomdp.Model)" href="../model_based_util/pomdp/#olfactory_navigation.agents.model_based_util.pomdp.Model">Model</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A POMDP model to use to represent the olfactory environment.
If not provided, the environment_converter parameter will be used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>environment_converter</code>
            </td>
            <td>
                  <code><span title="typing.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A function to convert the olfactory environment instance to a POMDP Model instance.
By default, we use an exact convertion that keeps the shape of the environment to make the amount of states of the POMDP Model.
This parameter will be ignored if the model parameter is provided.</p>
              </div>
            </td>
            <td>
                  <code>exact_converter</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>converter_parameters</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A set of additional parameters to be passed down to the environment converter.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.environment">environment</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Environment (olfactory_navigation.environment.Environment)" href="../../environment/#olfactory_navigation.environment.Environment">Environment</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.thresholds">thresholds</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An array of the thresholds of detection, starting with -inf and ending with +inf.
In the case of a 2D array of thresholds, the rows of thresholds apply to the different layers of the environment.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.space_aware">space_aware</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.spacial_subdivisions">spacial_subdivisions</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.name">name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.action_set">action_set</span></code></td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The actions allowed of the agent. Formulated as movement vectors as [(layer,) (dz,) dy, dx].</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.action_labels">action_labels</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The labels associated to the action vectors present in the action set.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.model">model</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Model (olfactory_navigation.agents.model_based_util.pomdp.Model)" href="../model_based_util/pomdp/#olfactory_navigation.agents.model_based_util.pomdp.Model">Model</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The environment converted to a POMDP model using the "from_environment" constructor of the Model class.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.saved_at">saved_at</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The place on disk where the agent has been saved (None if not saved yet).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.on_gpu">on_gpu</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the agent has been sent to the gpu or not.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.class_name">class_name</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the class of the agent.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.seed">seed</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The seed used for the random operations (to allow for reproducability).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.rnd_state">rnd_state</span></code></td>
            <td>
                  <code><span title="numpy.random.RandomState">RandomState</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The random state variable used to generate random values.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.cpu_version">cpu_version</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Agent (olfactory_navigation.agent.Agent)" href="../../agent/#olfactory_navigation.agent.Agent">Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the agent on the CPU. If it already is, it returns itself.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.gpu_version">gpu_version</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Agent (olfactory_navigation.agent.Agent)" href="../../agent/#olfactory_navigation.agent.Agent">Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An instance of the agent on the CPU. If it already is, it returns itself.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.trained_at">trained_at</span></code></td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A string timestamp of when the agent has been trained (None if not trained yet).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.value_function">value_function</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value function used for the agent to make decisions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.belief">belief</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used only during simulations.
Part of the Agent's status. Where the agent believes he is over the state space.
It is a list of n belief points based on how many simulations are running at once.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.action_played">action_played</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Used only during simulations.
Part of the Agent's status. Records what action was last played by the agent.
A list of n actions played based on how many simulations are running at once.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">PBVI_Agent</span><span class="p">(</span><span class="n">Agent</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    A generic Point-Based Value Iteration based agent. It relies on Model-Based reinforcement learning as described in: Pineau J. et al, Point-based value iteration: An anytime algorithm for POMDPs</span>
<span class="sd">    The training consist in two steps:</span>

<span class="sd">    - Expand: Where belief points are explored based on the some strategy (to be defined by subclasses).</span>

<span class="sd">    - Backup: Using the generated belief points, the value function is updated.</span>

<span class="sd">    The belief points are probability distributions over the state space and are therefore vectors of |S| elements.</span>

<span class="sd">    Actions are chosen based on a value function. A value function is a set of alpha vectors of dimentionality |S|.</span>
<span class="sd">    Each alpha vector is associated to a single action but multiple alpha vectors can be associated to the same action.</span>
<span class="sd">    To choose an action at a given belief point, a dot product is taken between each alpha vector and the belief point and the action associated with the highest result is chosen.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    environment : Environment</span>
<span class="sd">        The olfactory environment to train the agent with.</span>
<span class="sd">    thresholds : float or list[float] or dict[str, float] or dict[str, list[float]], default=3e-6</span>
<span class="sd">        The olfactory thresholds. If an odor cue above this threshold is detected, the agent detects it, else it does not.</span>
<span class="sd">        If a list of thresholds is provided, he agent should be able to detect |thresholds|+1 levels of odor.</span>
<span class="sd">        A dictionary of (list of) thresholds can also be provided when the environment is layered.</span>
<span class="sd">        In such case, the number of layers provided must match the environment&#39;s layers and their labels must match.</span>
<span class="sd">        The thresholds provided will be converted to an array where the levels start with -inf and end with +inf.</span>
<span class="sd">    space_aware : bool, default=False</span>
<span class="sd">        Whether the agent is aware of it&#39;s own position in space.</span>
<span class="sd">        This is to be used in scenarios where, for example, the agent is an enclosed container and the source is the variable.</span>
<span class="sd">        Note: The observation array will have a different shape when returned to the update_state function!</span>
<span class="sd">    spacial_subdivisions : np.ndarray, optional</span>
<span class="sd">        How many spacial compartments the agent has to internally represent the space it lives in.</span>
<span class="sd">        By default, it will be as many as there are grid points in the environment.</span>
<span class="sd">    actions : dict or np.ndarray, optional</span>
<span class="sd">        The set of action available to the agent. It should match the type of environment (ie: if the environment has layers, it should contain a layer component to the action vector, and similarly for a third dimension).</span>
<span class="sd">        Else, a dict of strings and action vectors where the strings represent the action labels.</span>
<span class="sd">        If none is provided, by default, all unit movement vectors are included and shuch for all layers (if the environment has layers.)</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        A custom name to give the agent. If not provided is will be a combination of the class-name and the threshold.</span>
<span class="sd">    seed : int, default=12131415</span>
<span class="sd">        For reproducible randomness.</span>
<span class="sd">    model : Model, optional</span>
<span class="sd">        A POMDP model to use to represent the olfactory environment.</span>
<span class="sd">        If not provided, the environment_converter parameter will be used.</span>
<span class="sd">    environment_converter : Callable, default=exact_converter</span>
<span class="sd">        A function to convert the olfactory environment instance to a POMDP Model instance.</span>
<span class="sd">        By default, we use an exact convertion that keeps the shape of the environment to make the amount of states of the POMDP Model.</span>
<span class="sd">        This parameter will be ignored if the model parameter is provided.</span>
<span class="sd">    converter_parameters : dict, optional</span>
<span class="sd">        A set of additional parameters to be passed down to the environment converter.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ---------</span>
<span class="sd">    environment : Environment</span>
<span class="sd">    thresholds : np.ndarray</span>
<span class="sd">        An array of the thresholds of detection, starting with -inf and ending with +inf.</span>
<span class="sd">        In the case of a 2D array of thresholds, the rows of thresholds apply to the different layers of the environment.</span>
<span class="sd">    space_aware : bool</span>
<span class="sd">    spacial_subdivisions : np.ndarray</span>
<span class="sd">    name : str</span>
<span class="sd">    action_set : np.ndarray</span>
<span class="sd">        The actions allowed of the agent. Formulated as movement vectors as [(layer,) (dz,) dy, dx].</span>
<span class="sd">    action_labels : list[str]</span>
<span class="sd">        The labels associated to the action vectors present in the action set.</span>
<span class="sd">    model : Model</span>
<span class="sd">        The environment converted to a POMDP model using the &quot;from_environment&quot; constructor of the Model class.</span>
<span class="sd">    saved_at : str</span>
<span class="sd">        The place on disk where the agent has been saved (None if not saved yet).</span>
<span class="sd">    on_gpu : bool</span>
<span class="sd">        Whether the agent has been sent to the gpu or not.</span>
<span class="sd">    class_name : str</span>
<span class="sd">        The name of the class of the agent.</span>
<span class="sd">    seed : int</span>
<span class="sd">        The seed used for the random operations (to allow for reproducability).</span>
<span class="sd">    rnd_state : np.random.RandomState</span>
<span class="sd">        The random state variable used to generate random values.</span>
<span class="sd">    cpu_version : Agent</span>
<span class="sd">        An instance of the agent on the CPU. If it already is, it returns itself.</span>
<span class="sd">    gpu_version : Agent</span>
<span class="sd">        An instance of the agent on the CPU. If it already is, it returns itself.</span>
<span class="sd">    trained_at : str</span>
<span class="sd">        A string timestamp of when the agent has been trained (None if not trained yet).</span>
<span class="sd">    value_function : ValueFunction</span>
<span class="sd">        The value function used for the agent to make decisions.</span>
<span class="sd">    belief : BeliefSet</span>
<span class="sd">        Used only during simulations.</span>
<span class="sd">        Part of the Agent&#39;s status. Where the agent believes he is over the state space.</span>
<span class="sd">        It is a list of n belief points based on how many simulations are running at once.</span>
<span class="sd">    action_played : list[int]</span>
<span class="sd">        Used only during simulations.</span>
<span class="sd">        Part of the Agent&#39;s status. Records what action was last played by the agent.</span>
<span class="sd">        A list of n actions played based on how many simulations are running at once.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">environment</span><span class="p">:</span> <span class="n">Environment</span><span class="p">,</span>
                 <span class="n">thresholds</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="mf">3e-6</span><span class="p">,</span>
                 <span class="n">space_aware</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">spacial_subdivisions</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">actions</span><span class="p">:</span> <span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12131415</span><span class="p">,</span>
                 <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">environment_converter</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">converter_parameters</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span><span class="p">,</span>
            <span class="n">thresholds</span> <span class="o">=</span> <span class="n">thresholds</span><span class="p">,</span>
            <span class="n">space_aware</span> <span class="o">=</span> <span class="n">space_aware</span><span class="p">,</span>
            <span class="n">spacial_subdivisions</span> <span class="o">=</span> <span class="n">spacial_subdivisions</span><span class="p">,</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="n">actions</span><span class="p">,</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">,</span>
            <span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="p">)</span>

        <span class="c1"># Converting the olfactory environment to a POMDP Model</span>
        <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">loaded_model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">environment_converter</span><span class="p">):</span>
            <span class="n">loaded_model</span> <span class="o">=</span> <span class="n">environment_converter</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">converter_parameters</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Using the exact converter</span>
            <span class="n">loaded_model</span> <span class="o">=</span> <span class="n">exact_converter</span><span class="p">(</span><span class="n">agent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">:</span><span class="n">Model</span> <span class="o">=</span> <span class="n">loaded_model</span>

        <span class="c1"># Trainable variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Status variables</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_played</span> <span class="o">=</span> <span class="kc">None</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">to_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBVI_Agent&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to send the numpy arrays of the agent to the gpu.</span>
<span class="sd">        It returns a new instance of the Agent class with the arrays on the gpu.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gpu_agent : Agent</span>
<span class="sd">            A copy of the agent with the arrays on the GPU.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Check whether the agent is already on the gpu or not</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="c1"># Warn and overwrite alternate_version in case it already exists</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[warning] A GPU instance already existed and is being recreated.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">assert</span> <span class="n">gpu_support</span><span class="p">,</span> <span class="s2">&quot;GPU support is not enabled, Cupy might need to be installed...&quot;</span>

        <span class="c1"># Generating a new instance</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">gpu_agent</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Copying arguments to gpu</span>
        <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;rnd_state&#39;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">gpu_model</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ValueFunction</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">())</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">BeliefSet</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Belief</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># Self reference instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="n">gpu_agent</span>
        <span class="n">gpu_agent</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">gpu_agent</span><span class="o">.</span><span class="n">on_gpu</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">gpu_agent</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">to_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBVI_Agent&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to send the numpy arrays of the agent to the cpu.</span>
<span class="sd">        It returns a new instance of the Agent class with the arrays on the cpu.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cpu_agent : Agent</span>
<span class="sd">            A new environment instance where the arrays are on the cpu memory.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Check whether the agent is already on the cpu or not</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[warning] A CPU instance already existed and is being recreated.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Generating a new instance</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">cpu_agent</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Copying arguments to gpu</span>
        <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;rnd_state&#39;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">))</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">cpu_model</span><span class="p">)</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ValueFunction</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">())</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">BeliefSet</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Belief</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># Self reference instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="n">cpu_agent</span>
        <span class="n">cpu_agent</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">cpu_agent</span><span class="o">.</span><span class="n">on_gpu</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">cpu_agent</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">save_environment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The save function for PBVI Agents consists in recording the value function after the training.</span>
<span class="sd">        It saves the agent in a folder with the name of the agent (class name + training timestamp).</span>
<span class="sd">        In this folder, there will be the metadata of the agent (all the attributes) in a json format and the value function.</span>

<span class="sd">        Optionally, the environment can be saved too to be able to load it alongside the agent for future reuse.</span>
<span class="sd">        If the agent has already been saved, the saving will not happen unless the force parameter is toggled.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : str, optional</span>
<span class="sd">            The folder under which to save the agent (a subfolder will be created under this folder).</span>
<span class="sd">            The agent will therefore be saved at &lt;folder&gt;/Agent-&lt;agent_name&gt; .</span>
<span class="sd">            By default the current folder is used.</span>
<span class="sd">        force : bool, default=False</span>
<span class="sd">            Whether to overwrite an already saved agent with the same name at the same path.</span>
<span class="sd">        save_environment : bool, default=False</span>
<span class="sd">            Whether to save the environment data along with the agent.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;The agent is not trained, there is nothing to save.&quot;</span>

        <span class="c1"># GPU support</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cpu_version</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">save_environment</span><span class="o">=</span><span class="n">save_environment</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="c1"># Adding env name to folder path</span>
        <span class="k">if</span> <span class="n">folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./Agent-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">+=</span> <span class="s1">&#39;/Agent-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Checking the folder exists or creates it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)):</span>
            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1"> is not empty. If you want to overwrite the saved model, enable &quot;force&quot;.&#39;</span><span class="p">)</span>

        <span class="c1"># If requested save environment</span>
        <span class="k">if</span> <span class="n">save_environment</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>

        <span class="c1"># TODO: Add MODEL to save function</span>
        <span class="c1"># Generating the metadata arguments dictionary</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_name</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">layer_lab</span><span class="p">:</span> <span class="n">layer_thresholds</span> <span class="k">for</span> <span class="n">layer_lab</span><span class="p">,</span> <span class="n">layer_thresholds</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">layer_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">tolist</span><span class="p">())}</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;environment_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">name</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;environment_saved_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">saved_at</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;space_aware&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space_aware</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;spacial_subdivisions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacial_subdivisions</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;action_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_labels</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;action_set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_set</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;trained_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>

        <span class="c1"># Output the arguments to a METADATA file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/METADATA.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Save value function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;Value_Function.npy&#39;</span><span class="p">)</span>

        <span class="c1"># Finalization</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_at</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Agent saved to: </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
             <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBVI_Agent&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to load a PBVI agent from a given folder it has been saved to.</span>
<span class="sd">        It will load the environment the agent has been trained on along with it.</span>

<span class="sd">        If it is a subclass of the PBVI_Agent, an instance of that specific subclass will be returned.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : str</span>
<span class="sd">            The agent folder.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        instance : PBVI_Agent</span>
<span class="sd">            The loaded instance of the PBVI Agent.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Load arguments</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/METADATA.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

        <span class="c1"># Load environment</span>
        <span class="n">environment</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;environment_saved_at&#39;</span><span class="p">])</span>

        <span class="c1"># Load specific class</span>
        <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;PBVI_Agent&#39;</span><span class="p">:</span>
            <span class="kn">from</span><span class="w"> </span><span class="nn">olfactory_navigation</span><span class="w"> </span><span class="kn">import</span> <span class="n">agents</span>
            <span class="bp">cls</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="n">obj</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">agents</span><span class="p">)}[</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]]</span>

        <span class="c1"># Build instance</span>
        <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
            <span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span><span class="p">,</span>
            <span class="n">thresholds</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">],</span>
            <span class="n">space_aware</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;space_aware&#39;</span><span class="p">],</span>
            <span class="n">spacial_subdivisions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;spacial_subdivisions&#39;</span><span class="p">]),</span>
            <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span><span class="n">a_label</span><span class="p">:</span> <span class="n">a_vector</span> <span class="k">for</span> <span class="n">a_label</span><span class="p">,</span> <span class="n">a_vector</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;action_labels&#39;</span><span class="p">],</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;action_set&#39;</span><span class="p">])},</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">seed</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># Load and set the value function on the instance</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="n">ValueFunction</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
            <span class="n">file</span><span class="o">=</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/Value_Function.npy&#39;</span><span class="p">,</span>
            <span class="n">model</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">model</span>
        <span class="p">)</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">trained_at</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;trained_at&#39;</span><span class="p">]</span>
        <span class="n">instance</span><span class="o">.</span><span class="n">saved_at</span> <span class="o">=</span> <span class="n">folder</span>

        <span class="k">return</span> <span class="n">instance</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
              <span class="n">expansions</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
              <span class="n">full_backup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
              <span class="n">update_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
              <span class="n">max_belief_growth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
              <span class="n">initial_belief</span><span class="p">:</span> <span class="n">BeliefSet</span> <span class="o">|</span> <span class="n">Belief</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">initial_value_function</span><span class="p">:</span> <span class="n">ValueFunction</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
              <span class="n">prune_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
              <span class="n">prune_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
              <span class="n">limit_value_function_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
              <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span>
              <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
              <span class="n">use_gpu</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
              <span class="n">history_tracking_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
              <span class="n">overwrite_training</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
              <span class="n">print_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
              <span class="n">print_stats</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
              <span class="o">**</span><span class="n">expand_arguments</span>
              <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainingHistory</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Main loop of the Point-Based Value Iteration algorithm.</span>
<span class="sd">        It consists in 2 steps, Backup and Expand.</span>
<span class="sd">        1. Expand: Expands the belief set base with a expansion strategy given by the parameter expand_function</span>
<span class="sd">        2. Backup: Updates the alpha vectors based on the current belief set</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expansions : int</span>
<span class="sd">            How many times the algorithm has to expand the belief set. (the size will be doubled every time, eg: for 5, the belief set will be of size 32)</span>
<span class="sd">        full_backup : bool, default=True</span>
<span class="sd">            Whether to force the backup function has to be run on the full set beliefs uncovered since the beginning or only on the new points.</span>
<span class="sd">        update_passes : int, default=1</span>
<span class="sd">            How many times the backup function has to be run every time the belief set is expanded.</span>
<span class="sd">        max_belief_growth : int, default=10</span>
<span class="sd">            How many beliefs can be added at every expansion step to the belief set.</span>
<span class="sd">        initial_belief : BeliefSet or Belief, optional</span>
<span class="sd">            An initial list of beliefs to start with.</span>
<span class="sd">        initial_value_function : ValueFunction, optional</span>
<span class="sd">            An initial value function to start the solving process with.</span>
<span class="sd">        prune_level : int, default=1</span>
<span class="sd">            Parameter to prune the value function further before the expand function.</span>
<span class="sd">        prune_interval : int, default=10</span>
<span class="sd">            How often to prune the value function. It is counted in number of backup iterations.</span>
<span class="sd">        limit_value_function_size : int, default=-1</span>
<span class="sd">            When the value function size crosses this threshold, a random selection of &#39;max_belief_growth&#39; alpha vectors will be removed from the value function</span>
<span class="sd">            If set to -1, the value function can grow without bounds.</span>
<span class="sd">        use_gpu : bool, default=False</span>
<span class="sd">            Whether to use the GPU with cupy array to accelerate solving.</span>
<span class="sd">        gamma : float, default=0.99</span>
<span class="sd">            The discount factor to value immediate rewards more than long term rewards.</span>
<span class="sd">            The learning rate is 1/gamma.</span>
<span class="sd">        eps : float, default=1e-6</span>
<span class="sd">            The smallest allowed changed for the value function.</span>
<span class="sd">            Bellow the amound of change, the value function is considered converged and the value iteration process will end early.</span>
<span class="sd">        history_tracking_level : int, default=1</span>
<span class="sd">            How thorough the tracking of the solving process should be. (0: Nothing; 1: Times and sizes of belief sets and value function; 2: The actual value functions and beliefs sets)</span>
<span class="sd">        overwrite_training : bool, default=False</span>
<span class="sd">            Whether to force the overwriting of the training if a value function already exists for this agent.</span>
<span class="sd">        print_progress : bool, default=True</span>
<span class="sd">            Whether or not to print out the progress of the value iteration process.</span>
<span class="sd">        print_stats : bool, default=True</span>
<span class="sd">            Whether or not to print out statistics at the end of the training run.</span>
<span class="sd">        expand_arguments : kwargs</span>
<span class="sd">            An arbitrary amount of parameters that will be passed on to the expand function.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        solver_history : SolverHistory</span>
<span class="sd">            The history of the solving process with some plotting options.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># GPU support</span>
        <span class="k">if</span> <span class="n">use_gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
            <span class="n">gpu_agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">()</span>
            <span class="n">solver_history</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">gpu_agent</span><span class="p">)</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
                <span class="n">expansions</span><span class="o">=</span><span class="n">expansions</span><span class="p">,</span>
                <span class="n">full_backup</span><span class="o">=</span><span class="n">full_backup</span><span class="p">,</span>
                <span class="n">update_passes</span><span class="o">=</span><span class="n">update_passes</span><span class="p">,</span>
                <span class="n">max_belief_growth</span><span class="o">=</span><span class="n">max_belief_growth</span><span class="p">,</span>
                <span class="n">initial_belief</span><span class="o">=</span><span class="n">initial_belief</span><span class="p">,</span>
                <span class="n">initial_value_function</span><span class="o">=</span><span class="n">initial_value_function</span><span class="p">,</span>
                <span class="n">prune_level</span><span class="o">=</span><span class="n">prune_level</span><span class="p">,</span>
                <span class="n">prune_interval</span><span class="o">=</span><span class="n">prune_interval</span><span class="p">,</span>
                <span class="n">limit_value_function_size</span><span class="o">=</span><span class="n">limit_value_function_size</span><span class="p">,</span>
                <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
                <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
                <span class="n">history_tracking_level</span><span class="o">=</span><span class="n">history_tracking_level</span><span class="p">,</span>
                <span class="n">overwrite_training</span><span class="o">=</span><span class="n">overwrite_training</span><span class="p">,</span>
                <span class="n">print_progress</span><span class="o">=</span><span class="n">print_progress</span><span class="p">,</span>
                <span class="n">print_stats</span><span class="o">=</span><span class="n">print_stats</span><span class="p">,</span>
                <span class="o">**</span><span class="n">expand_arguments</span>
            <span class="p">)</span>

            <span class="c1"># Setting parameters of CPU agent after the training</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="n">gpu_agent</span><span class="o">.</span><span class="n">value_function</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span> <span class="o">=</span> <span class="n">gpu_agent</span><span class="o">.</span><span class="n">trained_at</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">gpu_agent</span><span class="o">.</span><span class="n">name</span>

            <span class="k">return</span> <span class="n">solver_history</span>

        <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">cp</span>

        <span class="c1"># Getting model</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

        <span class="c1"># Initial belief</span>
        <span class="k">if</span> <span class="n">initial_belief</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">belief_set</span> <span class="o">=</span> <span class="n">BeliefSet</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="n">Belief</span><span class="p">(</span><span class="n">model</span><span class="p">)])</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initial_belief</span><span class="p">,</span> <span class="n">BeliefSet</span><span class="p">):</span>
            <span class="n">belief_set</span> <span class="o">=</span> <span class="n">initial_belief</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">initial_belief</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initial_belief</span> <span class="o">=</span> <span class="n">Belief</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">initial_belief</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
            <span class="n">belief_set</span> <span class="o">=</span> <span class="n">BeliefSet</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="n">initial_belief</span><span class="p">])</span>

        <span class="c1"># Handeling the case where the agent is already trained</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">overwrite_training</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[warning] The value function is being overwritten&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span> <span class="o">=</span> <span class="kc">None</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">initial_value_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span>

        <span class="c1"># Initial value function</span>
        <span class="k">if</span> <span class="n">initial_value_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">value_function</span> <span class="o">=</span> <span class="n">ValueFunction</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">expected_rewards_table</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">value_function</span> <span class="o">=</span> <span class="n">initial_value_function</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">initial_value_function</span>

        <span class="c1"># Convergence check boundary</span>
        <span class="n">max_allowed_change</span> <span class="o">=</span> <span class="n">eps</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">gamma</span><span class="p">))</span>

        <span class="c1"># History tracking</span>
        <span class="n">training_history</span> <span class="o">=</span> <span class="n">TrainingHistory</span><span class="p">(</span><span class="n">tracking_level</span><span class="o">=</span><span class="n">history_tracking_level</span><span class="p">,</span>
                                           <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                                           <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                                           <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
                                           <span class="n">expand_append</span><span class="o">=</span><span class="n">full_backup</span><span class="p">,</span>
                                           <span class="n">initial_value_function</span><span class="o">=</span><span class="n">value_function</span><span class="p">,</span>
                                           <span class="n">initial_belief_set</span><span class="o">=</span><span class="n">belief_set</span><span class="p">)</span>

        <span class="c1"># Loop</span>
        <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">expand_value_function</span> <span class="o">=</span> <span class="n">value_function</span>
        <span class="n">old_value_function</span> <span class="o">=</span> <span class="n">value_function</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">iterator</span> <span class="o">=</span> <span class="n">trange</span><span class="p">(</span><span class="n">expansions</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Expansions&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">print_progress</span> <span class="k">else</span> <span class="nb">range</span><span class="p">(</span><span class="n">expansions</span><span class="p">)</span>
            <span class="n">iterator_postfix</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="k">for</span> <span class="n">expansion_i</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>

                <span class="c1"># 1: Expand belief set</span>
                <span class="n">start_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

                <span class="n">new_belief_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">belief_set</span><span class="o">=</span><span class="n">belief_set</span><span class="p">,</span>
                                             <span class="n">value_function</span><span class="o">=</span><span class="n">value_function</span><span class="p">,</span>
                                             <span class="n">max_generation</span><span class="o">=</span><span class="n">max_belief_growth</span><span class="p">,</span>
                                             <span class="o">**</span><span class="n">expand_arguments</span><span class="p">)</span>

                <span class="c1"># Add new beliefs points to the total belief_set</span>
                <span class="n">belief_set</span> <span class="o">=</span> <span class="n">belief_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">new_belief_set</span><span class="p">)</span>

                <span class="n">expand_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                <span class="n">training_history</span><span class="o">.</span><span class="n">add_expand_step</span><span class="p">(</span><span class="n">expansion_time</span><span class="o">=</span><span class="n">expand_time</span><span class="p">,</span> <span class="n">belief_set</span><span class="o">=</span><span class="n">belief_set</span><span class="p">)</span>

                <span class="c1"># 2: Backup, update value function (alpha vector set)</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">update_passes</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">print_progress</span> <span class="ow">or</span> <span class="n">update_passes</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">trange</span><span class="p">(</span><span class="n">update_passes</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Backups </span><span class="si">{</span><span class="n">expansion_i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
                    <span class="n">start_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

                    <span class="c1"># Backup step</span>
                    <span class="n">value_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">belief_set</span> <span class="k">if</span> <span class="n">full_backup</span> <span class="k">else</span> <span class="n">new_belief_set</span><span class="p">,</span>
                                                 <span class="n">value_function</span><span class="p">,</span>
                                                 <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                                                 <span class="n">append</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="n">full_backup</span><span class="p">),</span>
                                                 <span class="n">belief_dominance_prune</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                    <span class="n">backup_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

                    <span class="c1"># Additional pruning</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">iteration</span> <span class="o">%</span> <span class="n">prune_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">start_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                        <span class="n">vf_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span>

                        <span class="n">value_function</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="n">prune_level</span><span class="p">)</span>

                        <span class="n">prune_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                        <span class="n">alpha_vectors_pruned</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span> <span class="o">-</span> <span class="n">vf_len</span>
                        <span class="n">training_history</span><span class="o">.</span><span class="n">add_prune_step</span><span class="p">(</span><span class="n">prune_time</span><span class="p">,</span> <span class="n">alpha_vectors_pruned</span><span class="p">)</span>

                    <span class="c1"># Check if value function size is above threshold</span>
                    <span class="k">if</span> <span class="n">limit_value_function_size</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limit_value_function_size</span><span class="p">:</span>
                        <span class="c1"># Compute matrix multiplications between avs and beliefs</span>
                        <span class="n">alpha_value_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="p">,</span> <span class="n">belief_set</span><span class="o">.</span><span class="n">belief_array</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

                        <span class="c1"># Select the useful alpha vectors</span>
                        <span class="n">best_alpha_vector_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">alpha_value_per_belief</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                        <span class="n">useful_alpha_vectors</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">best_alpha_vector_per_belief</span><span class="p">)</span>

                        <span class="c1"># Select a random selection of vectors to delete</span>
                        <span class="n">unuseful_alpha_vectors</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)),</span> <span class="n">useful_alpha_vectors</span><span class="p">)</span>
                        <span class="n">random_vectors_to_delete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">unuseful_alpha_vectors</span><span class="p">,</span>
                                                                         <span class="n">size</span><span class="o">=</span><span class="n">max_belief_growth</span><span class="p">,</span>
                                                                         <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unuseful_alpha_vectors</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unuseful_alpha_vectors</span><span class="p">)))))</span>
                                                                         <span class="c1"># replace=False,</span>
                                                                         <span class="c1"># p=1/len(unuseful_alpha_vectors))</span>

                        <span class="n">value_function</span> <span class="o">=</span> <span class="n">ValueFunction</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                                                       <span class="n">alpha_vectors</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="p">,</span> <span class="n">random_vectors_to_delete</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                                       <span class="n">action_list</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">value_function</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span> <span class="n">random_vectors_to_delete</span><span class="p">))</span>

                        <span class="n">iterator_postfix</span><span class="p">[</span><span class="s1">&#39;|useful|&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">useful_alpha_vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                    <span class="c1"># Compute the change between value functions</span>
                    <span class="n">max_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_change</span><span class="p">(</span><span class="n">value_function</span><span class="p">,</span> <span class="n">old_value_function</span><span class="p">,</span> <span class="n">belief_set</span><span class="p">)</span>

                    <span class="c1"># History tracking</span>
                    <span class="n">training_history</span><span class="o">.</span><span class="n">add_backup_step</span><span class="p">(</span><span class="n">backup_time</span><span class="p">,</span> <span class="n">max_change</span><span class="p">,</span> <span class="n">value_function</span><span class="p">)</span>

                    <span class="c1"># Convergence check</span>
                    <span class="k">if</span> <span class="n">max_change</span> <span class="o">&lt;</span> <span class="n">max_allowed_change</span><span class="p">:</span>
                        <span class="k">break</span>

                    <span class="n">old_value_function</span> <span class="o">=</span> <span class="n">value_function</span>

                    <span class="c1"># Update iteration counter</span>
                    <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Compute change with old expansion value function</span>
                <span class="n">expand_max_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_change</span><span class="p">(</span><span class="n">expand_value_function</span><span class="p">,</span> <span class="n">value_function</span><span class="p">,</span> <span class="n">belief_set</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">expand_max_change</span> <span class="o">&lt;</span> <span class="n">max_allowed_change</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">print_progress</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Converged!&#39;</span><span class="p">)</span>
                    <span class="k">break</span>

                <span class="n">expand_value_function</span> <span class="o">=</span> <span class="n">value_function</span>

                <span class="n">iterator_postfix</span><span class="p">[</span><span class="s1">&#39;|V|&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span>
                <span class="n">iterator_postfix</span><span class="p">[</span><span class="s1">&#39;|B|&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">belief_set</span><span class="p">)</span>

                <span class="k">if</span> <span class="n">print_progress</span><span class="p">:</span>
                    <span class="n">iterator</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">(</span><span class="n">iterator_postfix</span><span class="p">)</span>

        <span class="k">except</span> <span class="ne">MemoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Memory full: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Returning value function and history as is...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="c1"># Final pruning</span>
        <span class="n">start_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
        <span class="n">vf_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span>

        <span class="n">value_function</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="n">prune_level</span><span class="p">)</span>

        <span class="c1"># History tracking</span>
        <span class="n">prune_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">alpha_vectors_pruned</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span> <span class="o">-</span> <span class="n">vf_len</span>
        <span class="n">training_history</span><span class="o">.</span><span class="n">add_prune_step</span><span class="p">(</span><span class="n">prune_time</span><span class="p">,</span> <span class="n">alpha_vectors_pruned</span><span class="p">)</span>

        <span class="c1"># Record when it was trained</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;-trained_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span><span class="si">}</span><span class="s1">&#39;</span>

        <span class="c1"># Saving value function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="n">value_function</span>

        <span class="c1"># Print stats if requested</span>
        <span class="k">if</span> <span class="n">print_stats</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">training_history</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">training_history</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">compute_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">value_function</span><span class="p">:</span> <span class="n">ValueFunction</span><span class="p">,</span>
                       <span class="n">new_value_function</span><span class="p">:</span> <span class="n">ValueFunction</span><span class="p">,</span>
                       <span class="n">belief_set</span><span class="p">:</span> <span class="n">BeliefSet</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to compute whether the change between two value functions can be considered as having converged based on the eps parameter of the Solver.</span>
<span class="sd">        It check for each belief, the maximum value and take the max change between believe&#39;s value functions.</span>
<span class="sd">        If this max change is lower than eps * (gamma / (1 - gamma)).</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value_function : ValueFunction</span>
<span class="sd">            The first value function to compare.</span>
<span class="sd">        new_value_function : ValueFunction</span>
<span class="sd">            The second value function to compare.</span>
<span class="sd">        belief_set : BeliefSet</span>
<span class="sd">            The set of believes to check the values on to compute the max change on.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        max_change : float</span>
<span class="sd">            The maximum change between value functions at belief points.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Get numpy corresponding to the arrays</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu_support</span> <span class="k">else</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_array_module</span><span class="p">(</span><span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="p">)</span>

        <span class="c1"># Computing Delta for each beliefs</span>
        <span class="n">max_val_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">belief_set</span><span class="o">.</span><span class="n">belief_array</span><span class="p">,</span> <span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">new_max_val_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">belief_set</span><span class="o">.</span><span class="n">belief_array</span><span class="p">,</span> <span class="n">new_value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">max_change</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">new_max_val_per_belief</span> <span class="o">-</span> <span class="n">max_val_per_belief</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">max_change</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">belief_set</span><span class="p">:</span> <span class="n">BeliefSet</span><span class="p">,</span>
               <span class="n">value_function</span><span class="p">:</span> <span class="n">ValueFunction</span><span class="p">,</span>
               <span class="n">max_generation</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
               <span class="o">**</span><span class="n">kwargs</span>
               <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BeliefSet</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Abstract function!</span>
<span class="sd">        This function should be implemented in subclasses.</span>
<span class="sd">        The expand function consists in the exploration of the belief set.</span>
<span class="sd">        It takes as input a belief set and generates at most &#39;max_generation&#39; beliefs from it.</span>

<span class="sd">        The current value function is also passed as an argument as it is used in some PBVI techniques to guide the belief exploration.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        belief_set : BeliefSet</span>
<span class="sd">            The belief or set of beliefs to be used as a starting point for the exploration.</span>
<span class="sd">        value_function : ValueFunction</span>
<span class="sd">            The current value function. To be used to guide the exploration process.</span>
<span class="sd">        max_generation : int</span>
<span class="sd">            How many beliefs to be generated at most.</span>
<span class="sd">        kwargs</span>
<span class="sd">            Special parameters for the particular flavors of the PBVI Agent.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new_belief_set : BeliefSet</span>
<span class="sd">            A new (or expanded) set of beliefs.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;PBVI class is abstract so expand function is not implemented, make an PBVI_agent subclass to implement the method&#39;</span><span class="p">)</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">belief_set</span><span class="p">:</span> <span class="n">BeliefSet</span><span class="p">,</span>
               <span class="n">value_function</span><span class="p">:</span> <span class="n">ValueFunction</span><span class="p">,</span>
               <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span>
               <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
               <span class="n">belief_dominance_prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
               <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueFunction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function has purpose to update the set of alpha vectors. It does so in 3 steps:</span>
<span class="sd">        1. It creates projections from each alpha vector for each possible action and each possible observation</span>
<span class="sd">        2. It collapses this set of generated alpha vectors by taking the weighted sum of the alpha vectors weighted by the observation probability and this for each action and for each belief.</span>
<span class="sd">        3. Then it further collapses the set to take the best alpha vector and action per belief</span>
<span class="sd">        In the end we have a set of alpha vectors as large as the amount of beliefs.</span>

<span class="sd">        The alpha vectors are also pruned to avoid duplicates and remove dominated ones.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        belief_set : BeliefSet</span>
<span class="sd">            The belief set to use to generate the new alpha vectors with.</span>
<span class="sd">        value_function : ValueFunction</span>
<span class="sd">            The alpha vectors to generate the new set from.</span>
<span class="sd">        gamma : float, default=0.99</span>
<span class="sd">            The discount factor to value immediate rewards more than long term rewards.</span>
<span class="sd">            The learning rate is 1/gamma.</span>
<span class="sd">        append : bool, default=False</span>
<span class="sd">            Whether to append the new alpha vectors generated to the old alpha vectors before pruning.</span>
<span class="sd">        belief_dominance_prune : bool, default=True</span>
<span class="sd">            Whether, before returning the new value function, checks what alpha vectors have a supperior value, if so it adds it.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new_alpha_set : ValueFunction</span>
<span class="sd">            A list of updated alpha vectors.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">cp</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

        <span class="c1"># Step 1</span>
        <span class="n">vector_array</span> <span class="o">=</span> <span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span>
        <span class="n">vectors_array_reachable_states</span> <span class="o">=</span> <span class="n">vector_array</span><span class="p">[</span><span class="n">xp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">vector_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">reachable_states</span><span class="p">[</span><span class="kc">None</span><span class="p">,:,:,:]]</span>

        <span class="n">gamma_a_o_t</span> <span class="o">=</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">xp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;saor,vsar-&gt;aovs&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">reachable_transitional_observation_table</span><span class="p">,</span> <span class="n">vectors_array_reachable_states</span><span class="p">)</span>

        <span class="c1"># Step 2</span>
        <span class="n">belief_array</span> <span class="o">=</span> <span class="n">belief_set</span><span class="o">.</span><span class="n">belief_array</span> <span class="c1"># bs</span>
        <span class="n">best_alpha_ind</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">belief_array</span><span class="p">,</span> <span class="n">gamma_a_o_t</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># argmax(bs,aovs-&gt;baov) -&gt; bao</span>

        <span class="n">best_alphas_per_o</span> <span class="o">=</span> <span class="n">gamma_a_o_t</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="kc">None</span><span class="p">,:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">observations</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:,</span><span class="kc">None</span><span class="p">],</span> <span class="n">best_alpha_ind</span><span class="p">[:,:,:,</span><span class="kc">None</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:]]</span> <span class="c1"># baos</span>

        <span class="n">alpha_a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">expected_rewards_table</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">best_alphas_per_o</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># as + bas</span>

        <span class="c1"># Step 3</span>
        <span class="n">best_actions</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bas,bs-&gt;ba&#39;</span><span class="p">,</span> <span class="n">alpha_a</span><span class="p">,</span> <span class="n">belief_array</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">alpha_vectors</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">(</span><span class="n">alpha_a</span><span class="p">,</span> <span class="n">best_actions</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">,:]</span>

        <span class="c1"># Belief domination</span>
        <span class="k">if</span> <span class="n">belief_dominance_prune</span><span class="p">:</span>
            <span class="n">best_value_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">belief_array</span> <span class="o">*</span> <span class="n">alpha_vectors</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">old_best_value_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">belief_array</span><span class="p">,</span> <span class="n">vector_array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">dominating_vectors</span> <span class="o">=</span> <span class="n">best_value_per_belief</span> <span class="o">&gt;</span> <span class="n">old_best_value_per_belief</span>

            <span class="n">best_actions</span> <span class="o">=</span> <span class="n">best_actions</span><span class="p">[</span><span class="n">dominating_vectors</span><span class="p">]</span>
            <span class="n">alpha_vectors</span> <span class="o">=</span> <span class="n">alpha_vectors</span><span class="p">[</span><span class="n">dominating_vectors</span><span class="p">]</span>

        <span class="c1"># Creation of value function</span>
        <span class="n">new_value_function</span> <span class="o">=</span> <span class="n">ValueFunction</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">alpha_vectors</span><span class="p">,</span> <span class="n">best_actions</span><span class="p">)</span>

        <span class="c1"># Union with previous value function</span>
        <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
            <span class="n">new_value_function</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">new_value_function</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">modify_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">new_environment</span><span class="p">:</span> <span class="n">Environment</span>
                           <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Agent&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to modify the environment of the agent.</span>
<span class="sd">        If the agent is already trained, the trained element should also be adapted to fit this new environment.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_environment : Environment</span>
<span class="sd">            A modified environment.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        modified_agent : PBVI_Agent</span>
<span class="sd">            A new pbvi agent with a modified environment</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># TODO: Fix this to account for other init parameters</span>
        <span class="c1"># GPU support</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">()</span><span class="o">.</span><span class="n">modify_environment</span><span class="p">(</span><span class="n">new_environment</span><span class="o">=</span><span class="n">new_environment</span><span class="p">)</span>

        <span class="c1"># Creating a new agent instance</span>
        <span class="n">modified_agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">environment</span> <span class="o">=</span> <span class="n">new_environment</span><span class="p">,</span>
                                        <span class="n">thresholds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">,</span>
                                        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Modifying the value function</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reshaped_vf_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">av</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modified_agent</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                                          <span class="k">for</span> <span class="n">av</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_function</span><span class="p">),</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)])</span>
            <span class="n">modified_vf</span> <span class="o">=</span> <span class="n">ValueFunction</span><span class="p">(</span><span class="n">modified_agent</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">alpha_vectors</span><span class="o">=</span><span class="n">reshaped_vf_array</span><span class="p">,</span> <span class="n">action_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value_function</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
            <span class="n">modified_agent</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="n">modified_vf</span>

        <span class="k">return</span> <span class="n">modified_agent</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                         <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                         <span class="n">belief</span><span class="p">:</span> <span class="n">BeliefSet</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        To use an agent within a simulation, the agent&#39;s state needs to be initialized.</span>
<span class="sd">        The initialization consists of setting the agent&#39;s initial belief.</span>
<span class="sd">        Multiple agents can be used at once for simulations, for this reason, the belief parameter is a BeliefSet by default.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int, default=1</span>
<span class="sd">            How many agents are to be used during the simulation.</span>
<span class="sd">        belief : BeliefSet, optional</span>
<span class="sd">            An optional set of beliefs to initialize the simulations with.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Agent was not trained, run the training function first...&quot;</span>

        <span class="k">if</span> <span class="n">belief</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="n">BeliefSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="n">Belief</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">belief</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;The amount of beliefs provided (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">belief</span><span class="p">)</span><span class="si">}</span><span class="s2">) to initialize the state need to match the amount of stimulations to initialize (n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">).&quot;</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">belief</span><span class="o">.</span><span class="n">is_on_gpu</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="n">belief</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">()</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="ow">and</span> <span class="n">belief</span><span class="o">.</span><span class="n">is_on_gpu</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="n">belief</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">()</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="n">belief</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">choose_action</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to let the agent or set of agents choose an action based on their current belief.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        movement_vector : np.ndarray</span>
<span class="sd">            A single or a list of actions chosen by the agent(s) based on their belief.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Agent was not initialized yet, run the initialize_state function first&quot;</span>

        <span class="c1"># Evaluated value function</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span><span class="o">.</span><span class="n">evaluate_at</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">belief</span><span class="p">)</span>

        <span class="c1"># Recording the action played</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">action_played</span> <span class="o">=</span> <span class="n">action</span>

        <span class="c1"># Converting action indexes to movement vectors</span>
        <span class="n">movemement_vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_set</span><span class="p">[</span><span class="n">action</span><span class="p">,:]</span>

        <span class="k">return</span> <span class="n">movemement_vector</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">action</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                     <span class="n">observation</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                     <span class="n">source_reached</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to update the internal state(s) of the agent(s) based on the previous action(s) taken and the observation(s) received.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        action : np.ndarray</span>
<span class="sd">            A 2D array of n movement vectors. If the environment is layered, the 1st component should be the layer.</span>
<span class="sd">        observation : np.ndarray</span>
<span class="sd">            The observation(s) the agent(s) made.</span>
<span class="sd">        source_reached : np.ndarray</span>
<span class="sd">            A boolean array of whether the agent(s) have reached the source or not.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        update_successfull : np.ndarray, optional</span>
<span class="sd">            If nothing is returned, it means all the agent&#39;s state updates have been successfull.</span>
<span class="sd">            Else, a boolean np.ndarray of size n can be returned confirming for each agent whether the update has been successful or not.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Agent was not initialized yet, run the initialize_state function first&quot;</span>

        <span class="c1"># Discretizing observations</span>
        <span class="n">observation_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discretize_observations</span><span class="p">(</span><span class="n">observation</span><span class="o">=</span><span class="n">observation</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">source_reached</span><span class="o">=</span><span class="n">source_reached</span><span class="p">)</span>

        <span class="c1"># Update the set of beliefs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">belief</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">action_played</span><span class="p">,</span> <span class="n">observations</span><span class="o">=</span><span class="n">observation_ids</span><span class="p">,</span> <span class="n">throw_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

        <span class="c1"># Check for failed updates</span>
        <span class="n">update_successful</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">belief</span><span class="o">.</span><span class="n">belief_array</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">update_successful</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">simulations_to_kill</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to kill any simulations that have not reached the source but can&#39;t continue further</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        simulations_to_kill : np.ndarray</span>
<span class="sd">            A boolean array of the simulations to kill.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">simulations_to_kill</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="n">BeliefSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">belief</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">belief</span><span class="o">.</span><span class="n">belief_array</span><span class="p">[</span><span class="o">~</span><span class="n">simulations_to_kill</span><span class="p">])</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">generate_beliefs_from_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                         <span class="n">history</span><span class="p">:</span> <span class="n">SimulationHistory</span><span class="p">,</span>
                                         <span class="n">trajectory_i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                         <span class="n">initial_belief</span><span class="p">:</span> <span class="n">Belief</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BeliefSet</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to generate a sequence of belief points from the trajectory from SimulationHistory instance.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        history : SimulationHistory</span>
<span class="sd">            The simulation history from which the agent&#39;s trajectory is extracted.</span>
<span class="sd">        trajectory_i : int, default=0</span>
<span class="sd">            The id of the trajectory from which to build the belief sequence.</span>
<span class="sd">        initial_belief : Belief, optional</span>
<span class="sd">            The initial belief point from which to start the sequence.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        belief_sequence : BeliefSet</span>
<span class="sd">            The sequence of beliefs the agent going through in the the trajectory of the simulation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># If the initial belief is not provided, generate one</span>
        <span class="k">if</span> <span class="n">initial_belief</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">initial_belief</span> <span class="o">=</span> <span class="n">Belief</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

        <span class="c1"># Retrieve the trjactory&#39;s simulation dataframe</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">simulation_dfs</span><span class="p">[</span><span class="n">trajectory_i</span><span class="p">]</span>

        <span class="c1"># Set the belief that will be iterate on</span>
        <span class="n">belief</span> <span class="o">=</span> <span class="n">initial_belief</span>

        <span class="c1"># Belief sequence to be returned at the end</span>
        <span class="n">belief_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_belief</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">row_id</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
            <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c1"># Skip initial position</span>
            <span class="k">if</span> <span class="n">row_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">continue</span>

            <span class="c1"># Check the ID of the action</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">action_set</span> <span class="o">==</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

            <span class="c1"># Retrieve observations</span>
            <span class="n">o</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">]]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">space_aware</span><span class="p">:</span>
                <span class="n">o</span> <span class="o">+=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]]</span>

            <span class="c1"># Discretize observations</span>
            <span class="n">discrete_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discretize_observations</span><span class="p">(</span><span class="n">observation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">o</span><span class="p">]),</span> <span class="n">action</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">]),</span> <span class="n">source_reached</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Update belief</span>
                <span class="n">belief</span> <span class="o">=</span> <span class="n">belief</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="n">discrete_o</span><span class="p">)</span>
                <span class="n">belief_sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">belief</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[Warning] Update of belief failed at step </span><span class="si">{</span><span class="n">row_id</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">BeliefSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">belief_sequence</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">










<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.backup" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">backup</span><span class="p">(</span><span class="n">belief_set</span><span class="p">,</span> <span class="n">value_function</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">append</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">belief_dominance_prune</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>This function has purpose to update the set of alpha vectors. It does so in 3 steps:
1. It creates projections from each alpha vector for each possible action and each possible observation
2. It collapses this set of generated alpha vectors by taking the weighted sum of the alpha vectors weighted by the observation probability and this for each action and for each belief.
3. Then it further collapses the set to take the best alpha vector and action per belief
In the end we have a set of alpha vectors as large as the amount of beliefs.</p>
<p>The alpha vectors are also pruned to avoid duplicates and remove dominated ones.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>belief_set</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The belief set to use to generate the new alpha vectors with.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value_function</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The alpha vectors to generate the new set from.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discount factor to value immediate rewards more than long term rewards.
The learning rate is 1/gamma.</p>
              </div>
            </td>
            <td>
                  <code>0.99</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>append</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to append the new alpha vectors generated to the old alpha vectors before pruning.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>belief_dominance_prune</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether, before returning the new value function, checks what alpha vectors have a supperior value, if so it adds it.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>new_alpha_set</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of updated alpha vectors.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">backup</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
           <span class="n">belief_set</span><span class="p">:</span> <span class="n">BeliefSet</span><span class="p">,</span>
           <span class="n">value_function</span><span class="p">:</span> <span class="n">ValueFunction</span><span class="p">,</span>
           <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span>
           <span class="n">append</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
           <span class="n">belief_dominance_prune</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
           <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueFunction</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function has purpose to update the set of alpha vectors. It does so in 3 steps:</span>
<span class="sd">    1. It creates projections from each alpha vector for each possible action and each possible observation</span>
<span class="sd">    2. It collapses this set of generated alpha vectors by taking the weighted sum of the alpha vectors weighted by the observation probability and this for each action and for each belief.</span>
<span class="sd">    3. Then it further collapses the set to take the best alpha vector and action per belief</span>
<span class="sd">    In the end we have a set of alpha vectors as large as the amount of beliefs.</span>

<span class="sd">    The alpha vectors are also pruned to avoid duplicates and remove dominated ones.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    belief_set : BeliefSet</span>
<span class="sd">        The belief set to use to generate the new alpha vectors with.</span>
<span class="sd">    value_function : ValueFunction</span>
<span class="sd">        The alpha vectors to generate the new set from.</span>
<span class="sd">    gamma : float, default=0.99</span>
<span class="sd">        The discount factor to value immediate rewards more than long term rewards.</span>
<span class="sd">        The learning rate is 1/gamma.</span>
<span class="sd">    append : bool, default=False</span>
<span class="sd">        Whether to append the new alpha vectors generated to the old alpha vectors before pruning.</span>
<span class="sd">    belief_dominance_prune : bool, default=True</span>
<span class="sd">        Whether, before returning the new value function, checks what alpha vectors have a supperior value, if so it adds it.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_alpha_set : ValueFunction</span>
<span class="sd">        A list of updated alpha vectors.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">cp</span>
    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

    <span class="c1"># Step 1</span>
    <span class="n">vector_array</span> <span class="o">=</span> <span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span>
    <span class="n">vectors_array_reachable_states</span> <span class="o">=</span> <span class="n">vector_array</span><span class="p">[</span><span class="n">xp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">vector_array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">reachable_states</span><span class="p">[</span><span class="kc">None</span><span class="p">,:,:,:]]</span>

    <span class="n">gamma_a_o_t</span> <span class="o">=</span> <span class="n">gamma</span> <span class="o">*</span> <span class="n">xp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;saor,vsar-&gt;aovs&#39;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">reachable_transitional_observation_table</span><span class="p">,</span> <span class="n">vectors_array_reachable_states</span><span class="p">)</span>

    <span class="c1"># Step 2</span>
    <span class="n">belief_array</span> <span class="o">=</span> <span class="n">belief_set</span><span class="o">.</span><span class="n">belief_array</span> <span class="c1"># bs</span>
    <span class="n">best_alpha_ind</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">tensordot</span><span class="p">(</span><span class="n">belief_array</span><span class="p">,</span> <span class="n">gamma_a_o_t</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="c1"># argmax(bs,aovs-&gt;baov) -&gt; bao</span>

    <span class="n">best_alphas_per_o</span> <span class="o">=</span> <span class="n">gamma_a_o_t</span><span class="p">[</span><span class="n">model</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="kc">None</span><span class="p">,:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">observations</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:,</span><span class="kc">None</span><span class="p">],</span> <span class="n">best_alpha_ind</span><span class="p">[:,:,:,</span><span class="kc">None</span><span class="p">],</span> <span class="n">model</span><span class="o">.</span><span class="n">states</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:]]</span> <span class="c1"># baos</span>

    <span class="n">alpha_a</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">expected_rewards_table</span><span class="o">.</span><span class="n">T</span> <span class="o">+</span> <span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">best_alphas_per_o</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="c1"># as + bas</span>

    <span class="c1"># Step 3</span>
    <span class="n">best_actions</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;bas,bs-&gt;ba&#39;</span><span class="p">,</span> <span class="n">alpha_a</span><span class="p">,</span> <span class="n">belief_array</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">alpha_vectors</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">take_along_axis</span><span class="p">(</span><span class="n">alpha_a</span><span class="p">,</span> <span class="n">best_actions</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)[:,</span><span class="mi">0</span><span class="p">,:]</span>

    <span class="c1"># Belief domination</span>
    <span class="k">if</span> <span class="n">belief_dominance_prune</span><span class="p">:</span>
        <span class="n">best_value_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">belief_array</span> <span class="o">*</span> <span class="n">alpha_vectors</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">old_best_value_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">belief_array</span><span class="p">,</span> <span class="n">vector_array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dominating_vectors</span> <span class="o">=</span> <span class="n">best_value_per_belief</span> <span class="o">&gt;</span> <span class="n">old_best_value_per_belief</span>

        <span class="n">best_actions</span> <span class="o">=</span> <span class="n">best_actions</span><span class="p">[</span><span class="n">dominating_vectors</span><span class="p">]</span>
        <span class="n">alpha_vectors</span> <span class="o">=</span> <span class="n">alpha_vectors</span><span class="p">[</span><span class="n">dominating_vectors</span><span class="p">]</span>

    <span class="c1"># Creation of value function</span>
    <span class="n">new_value_function</span> <span class="o">=</span> <span class="n">ValueFunction</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">alpha_vectors</span><span class="p">,</span> <span class="n">best_actions</span><span class="p">)</span>

    <span class="c1"># Union with previous value function</span>
    <span class="k">if</span> <span class="n">append</span><span class="p">:</span>
        <span class="n">new_value_function</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_value_function</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.choose_action" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">choose_action</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to let the agent or set of agents choose an action based on their current belief.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>movement_vector</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A single or a list of actions chosen by the agent(s) based on their belief.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">choose_action</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to let the agent or set of agents choose an action based on their current belief.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    movement_vector : np.ndarray</span>
<span class="sd">        A single or a list of actions chosen by the agent(s) based on their belief.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Agent was not initialized yet, run the initialize_state function first&quot;</span>

    <span class="c1"># Evaluated value function</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">action</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span><span class="o">.</span><span class="n">evaluate_at</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">belief</span><span class="p">)</span>

    <span class="c1"># Recording the action played</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">action_played</span> <span class="o">=</span> <span class="n">action</span>

    <span class="c1"># Converting action indexes to movement vectors</span>
    <span class="n">movemement_vector</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_set</span><span class="p">[</span><span class="n">action</span><span class="p">,:]</span>

    <span class="k">return</span> <span class="n">movemement_vector</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.compute_change" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_change</span><span class="p">(</span><span class="n">value_function</span><span class="p">,</span> <span class="n">new_value_function</span><span class="p">,</span> <span class="n">belief_set</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to compute whether the change between two value functions can be considered as having converged based on the eps parameter of the Solver.
It check for each belief, the maximum value and take the max change between believe's value functions.
If this max change is lower than eps * (gamma / (1 - gamma)).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value_function</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The first value function to compare.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_value_function</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The second value function to compare.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>belief_set</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The set of believes to check the values on to compute the max change on.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>max_change</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum change between value functions at belief points.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">compute_change</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">value_function</span><span class="p">:</span> <span class="n">ValueFunction</span><span class="p">,</span>
                   <span class="n">new_value_function</span><span class="p">:</span> <span class="n">ValueFunction</span><span class="p">,</span>
                   <span class="n">belief_set</span><span class="p">:</span> <span class="n">BeliefSet</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to compute whether the change between two value functions can be considered as having converged based on the eps parameter of the Solver.</span>
<span class="sd">    It check for each belief, the maximum value and take the max change between believe&#39;s value functions.</span>
<span class="sd">    If this max change is lower than eps * (gamma / (1 - gamma)).</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    value_function : ValueFunction</span>
<span class="sd">        The first value function to compare.</span>
<span class="sd">    new_value_function : ValueFunction</span>
<span class="sd">        The second value function to compare.</span>
<span class="sd">    belief_set : BeliefSet</span>
<span class="sd">        The set of believes to check the values on to compute the max change on.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    max_change : float</span>
<span class="sd">        The maximum change between value functions at belief points.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Get numpy corresponding to the arrays</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">gpu_support</span> <span class="k">else</span> <span class="n">cp</span><span class="o">.</span><span class="n">get_array_module</span><span class="p">(</span><span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="p">)</span>

    <span class="c1"># Computing Delta for each beliefs</span>
    <span class="n">max_val_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">belief_set</span><span class="o">.</span><span class="n">belief_array</span><span class="p">,</span> <span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">new_max_val_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">belief_set</span><span class="o">.</span><span class="n">belief_array</span><span class="p">,</span> <span class="n">new_value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="o">.</span><span class="n">T</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">max_change</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">new_max_val_per_belief</span> <span class="o">-</span> <span class="n">max_val_per_belief</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">max_change</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.expand" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expand</span><span class="p">(</span><span class="n">belief_set</span><span class="p">,</span> <span class="n">value_function</span><span class="p">,</span> <span class="n">max_generation</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Abstract function!
This function should be implemented in subclasses.
The expand function consists in the exploration of the belief set.
It takes as input a belief set and generates at most 'max_generation' beliefs from it.</p>
<p>The current value function is also passed as an argument as it is used in some PBVI techniques to guide the belief exploration.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>belief_set</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The belief or set of beliefs to be used as a starting point for the exploration.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value_function</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The current value function. To be used to guide the exploration process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_generation</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many beliefs to be generated at most.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kwargs</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Special parameters for the particular flavors of the PBVI Agent.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>new_belief_set</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new (or expanded) set of beliefs.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expand</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
           <span class="n">belief_set</span><span class="p">:</span> <span class="n">BeliefSet</span><span class="p">,</span>
           <span class="n">value_function</span><span class="p">:</span> <span class="n">ValueFunction</span><span class="p">,</span>
           <span class="n">max_generation</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
           <span class="o">**</span><span class="n">kwargs</span>
           <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BeliefSet</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Abstract function!</span>
<span class="sd">    This function should be implemented in subclasses.</span>
<span class="sd">    The expand function consists in the exploration of the belief set.</span>
<span class="sd">    It takes as input a belief set and generates at most &#39;max_generation&#39; beliefs from it.</span>

<span class="sd">    The current value function is also passed as an argument as it is used in some PBVI techniques to guide the belief exploration.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    belief_set : BeliefSet</span>
<span class="sd">        The belief or set of beliefs to be used as a starting point for the exploration.</span>
<span class="sd">    value_function : ValueFunction</span>
<span class="sd">        The current value function. To be used to guide the exploration process.</span>
<span class="sd">    max_generation : int</span>
<span class="sd">        How many beliefs to be generated at most.</span>
<span class="sd">    kwargs</span>
<span class="sd">        Special parameters for the particular flavors of the PBVI Agent.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_belief_set : BeliefSet</span>
<span class="sd">        A new (or expanded) set of beliefs.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;PBVI class is abstract so expand function is not implemented, make an PBVI_agent subclass to implement the method&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.generate_beliefs_from_trajectory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_beliefs_from_trajectory</span><span class="p">(</span><span class="n">history</span><span class="p">,</span> <span class="n">trajectory_i</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">initial_belief</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to generate a sequence of belief points from the trajectory from SimulationHistory instance.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>history</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="SimulationHistory (olfactory_navigation.simulation.SimulationHistory)" href="../../simulation/#olfactory_navigation.simulation.SimulationHistory">SimulationHistory</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The simulation history from which the agent's trajectory is extracted.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trajectory_i</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The id of the trajectory from which to build the belief sequence.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_belief</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Belief (olfactory_navigation.agents.model_based_util.belief.Belief)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.Belief">Belief</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial belief point from which to start the sequence.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>belief_sequence</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The sequence of beliefs the agent going through in the the trajectory of the simulation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">generate_beliefs_from_trajectory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                     <span class="n">history</span><span class="p">:</span> <span class="n">SimulationHistory</span><span class="p">,</span>
                                     <span class="n">trajectory_i</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                                     <span class="n">initial_belief</span><span class="p">:</span> <span class="n">Belief</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BeliefSet</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to generate a sequence of belief points from the trajectory from SimulationHistory instance.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    history : SimulationHistory</span>
<span class="sd">        The simulation history from which the agent&#39;s trajectory is extracted.</span>
<span class="sd">    trajectory_i : int, default=0</span>
<span class="sd">        The id of the trajectory from which to build the belief sequence.</span>
<span class="sd">    initial_belief : Belief, optional</span>
<span class="sd">        The initial belief point from which to start the sequence.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    belief_sequence : BeliefSet</span>
<span class="sd">        The sequence of beliefs the agent going through in the the trajectory of the simulation.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># If the initial belief is not provided, generate one</span>
    <span class="k">if</span> <span class="n">initial_belief</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">initial_belief</span> <span class="o">=</span> <span class="n">Belief</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span>

    <span class="c1"># Retrieve the trjactory&#39;s simulation dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">history</span><span class="o">.</span><span class="n">simulation_dfs</span><span class="p">[</span><span class="n">trajectory_i</span><span class="p">]</span>

    <span class="c1"># Set the belief that will be iterate on</span>
    <span class="n">belief</span> <span class="o">=</span> <span class="n">initial_belief</span>

    <span class="c1"># Belief sequence to be returned at the end</span>
    <span class="n">belief_sequence</span> <span class="o">=</span> <span class="p">[</span><span class="n">initial_belief</span><span class="p">]</span>

    <span class="k">for</span> <span class="n">row_id</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">iterrows</span><span class="p">()):</span>
        <span class="n">row</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="c1"># Skip initial position</span>
        <span class="k">if</span> <span class="n">row_id</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">continue</span>

        <span class="c1"># Check the ID of the action</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">action_set</span> <span class="o">==</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;dy&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;dx&#39;</span><span class="p">]]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

        <span class="c1"># Retrieve observations</span>
        <span class="n">o</span> <span class="o">=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;o&#39;</span><span class="p">]]</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">space_aware</span><span class="p">:</span>
            <span class="n">o</span> <span class="o">+=</span> <span class="p">[</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;x&#39;</span><span class="p">]]</span>

        <span class="c1"># Discretize observations</span>
        <span class="n">discrete_o</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discretize_observations</span><span class="p">(</span><span class="n">observation</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">o</span><span class="p">]),</span> <span class="n">action</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="p">]),</span> <span class="n">source_reached</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="kc">False</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Update belief</span>
            <span class="n">belief</span> <span class="o">=</span> <span class="n">belief</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">a</span><span class="p">,</span> <span class="n">o</span><span class="o">=</span><span class="n">discrete_o</span><span class="p">)</span>
            <span class="n">belief_sequence</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">belief</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;[Warning] Update of belief failed at step </span><span class="si">{</span><span class="n">row_id</span><span class="si">}</span><span class="s1">...&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">BeliefSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">belief_sequence</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.initialize_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">initialize_state</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">belief</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>To use an agent within a simulation, the agent's state needs to be initialized.
The initialization consists of setting the agent's initial belief.
Multiple agents can be used at once for simulations, for this reason, the belief parameter is a BeliefSet by default.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>n</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many agents are to be used during the simulation.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>belief</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An optional set of beliefs to initialize the simulations with.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">initialize_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
                     <span class="n">belief</span><span class="p">:</span> <span class="n">BeliefSet</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    To use an agent within a simulation, the agent&#39;s state needs to be initialized.</span>
<span class="sd">    The initialization consists of setting the agent&#39;s initial belief.</span>
<span class="sd">    Multiple agents can be used at once for simulations, for this reason, the belief parameter is a BeliefSet by default.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : int, default=1</span>
<span class="sd">        How many agents are to be used during the simulation.</span>
<span class="sd">    belief : BeliefSet, optional</span>
<span class="sd">        An optional set of beliefs to initialize the simulations with.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Agent was not trained, run the training function first...&quot;</span>

    <span class="k">if</span> <span class="n">belief</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="n">BeliefSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="n">Belief</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">belief</span><span class="p">)</span> <span class="o">==</span> <span class="n">n</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;The amount of beliefs provided (</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">belief</span><span class="p">)</span><span class="si">}</span><span class="s2">) to initialize the state need to match the amount of stimulations to initialize (n=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s2">).&quot;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">belief</span><span class="o">.</span><span class="n">is_on_gpu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="n">belief</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="ow">and</span> <span class="n">belief</span><span class="o">.</span><span class="n">is_on_gpu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="n">belief</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="n">belief</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.kill" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">kill</span><span class="p">(</span><span class="n">simulations_to_kill</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to kill any simulations that have not reached the source but can't continue further</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>simulations_to_kill</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A boolean array of the simulations to kill.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">kill</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
         <span class="n">simulations_to_kill</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
         <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to kill any simulations that have not reached the source but can&#39;t continue further</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    simulations_to_kill : np.ndarray</span>
<span class="sd">        A boolean array of the simulations to kill.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="n">simulations_to_kill</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="n">BeliefSet</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">belief</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">belief</span><span class="o">.</span><span class="n">belief_array</span><span class="p">[</span><span class="o">~</span><span class="n">simulations_to_kill</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.load" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>Function to load a PBVI agent from a given folder it has been saved to.
It will load the environment the agent has been trained on along with it.</p>
<p>If it is a subclass of the PBVI_Agent, an instance of that specific subclass will be returned.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The agent folder.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>instance</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="PBVI_Agent (olfactory_navigation.agents.pbvi_agent.PBVI_Agent)" href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent">PBVI_Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The loaded instance of the PBVI Agent.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span><span class="w"> </span><span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
         <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span>
         <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBVI_Agent&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to load a PBVI agent from a given folder it has been saved to.</span>
<span class="sd">    It will load the environment the agent has been trained on along with it.</span>

<span class="sd">    If it is a subclass of the PBVI_Agent, an instance of that specific subclass will be returned.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    folder : str</span>
<span class="sd">        The agent folder.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    instance : PBVI_Agent</span>
<span class="sd">        The loaded instance of the PBVI Agent.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Load arguments</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/METADATA.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

    <span class="c1"># Load environment</span>
    <span class="n">environment</span> <span class="o">=</span> <span class="n">Environment</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;environment_saved_at&#39;</span><span class="p">])</span>

    <span class="c1"># Load specific class</span>
    <span class="k">if</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;PBVI_Agent&#39;</span><span class="p">:</span>
        <span class="kn">from</span><span class="w"> </span><span class="nn">olfactory_navigation</span><span class="w"> </span><span class="kn">import</span> <span class="n">agents</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span><span class="n">obj</span> <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">obj</span> <span class="ow">in</span> <span class="n">inspect</span><span class="o">.</span><span class="n">getmembers</span><span class="p">(</span><span class="n">agents</span><span class="p">)}[</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]]</span>

    <span class="c1"># Build instance</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span>
        <span class="n">environment</span> <span class="o">=</span> <span class="n">environment</span><span class="p">,</span>
        <span class="n">thresholds</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">],</span>
        <span class="n">space_aware</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;space_aware&#39;</span><span class="p">],</span>
        <span class="n">spacial_subdivisions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;spacial_subdivisions&#39;</span><span class="p">]),</span>
        <span class="n">actions</span> <span class="o">=</span> <span class="p">{</span><span class="n">a_label</span><span class="p">:</span> <span class="n">a_vector</span> <span class="k">for</span> <span class="n">a_label</span><span class="p">,</span> <span class="n">a_vector</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;action_labels&#39;</span><span class="p">],</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;action_set&#39;</span><span class="p">])},</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
        <span class="n">seed</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Load and set the value function on the instance</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="n">ValueFunction</span><span class="o">.</span><span class="n">load</span><span class="p">(</span>
        <span class="n">file</span><span class="o">=</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/Value_Function.npy&#39;</span><span class="p">,</span>
        <span class="n">model</span><span class="o">=</span><span class="n">instance</span><span class="o">.</span><span class="n">model</span>
    <span class="p">)</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">trained_at</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;trained_at&#39;</span><span class="p">]</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">saved_at</span> <span class="o">=</span> <span class="n">folder</span>

    <span class="k">return</span> <span class="n">instance</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.modify_environment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">modify_environment</span><span class="p">(</span><span class="n">new_environment</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to modify the environment of the agent.
If the agent is already trained, the trained element should also be adapted to fit this new environment.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>new_environment</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Environment (olfactory_navigation.environment.Environment)" href="../../environment/#olfactory_navigation.environment.Environment">Environment</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A modified environment.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>modified_agent</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="PBVI_Agent (olfactory_navigation.agents.pbvi_agent.PBVI_Agent)" href="#olfactory_navigation.agents.pbvi_agent.PBVI_Agent">PBVI_Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new pbvi agent with a modified environment</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">modify_environment</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">new_environment</span><span class="p">:</span> <span class="n">Environment</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Agent&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to modify the environment of the agent.</span>
<span class="sd">    If the agent is already trained, the trained element should also be adapted to fit this new environment.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    new_environment : Environment</span>
<span class="sd">        A modified environment.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    modified_agent : PBVI_Agent</span>
<span class="sd">        A new pbvi agent with a modified environment</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># TODO: Fix this to account for other init parameters</span>
    <span class="c1"># GPU support</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">()</span><span class="o">.</span><span class="n">modify_environment</span><span class="p">(</span><span class="n">new_environment</span><span class="o">=</span><span class="n">new_environment</span><span class="p">)</span>

    <span class="c1"># Creating a new agent instance</span>
    <span class="n">modified_agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="n">environment</span> <span class="o">=</span> <span class="n">new_environment</span><span class="p">,</span>
                                    <span class="n">thresholds</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="p">,</span>
                                    <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

    <span class="c1"># Modifying the value function</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">reshaped_vf_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cv2</span><span class="o">.</span><span class="n">resize</span><span class="p">(</span><span class="n">av</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modified_agent</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
                                      <span class="k">for</span> <span class="n">av</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_function</span><span class="p">),</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_grid</span><span class="o">.</span><span class="n">shape</span><span class="p">)])</span>
        <span class="n">modified_vf</span> <span class="o">=</span> <span class="n">ValueFunction</span><span class="p">(</span><span class="n">modified_agent</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="n">alpha_vectors</span><span class="o">=</span><span class="n">reshaped_vf_array</span><span class="p">,</span> <span class="n">action_list</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">value_function</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
        <span class="n">modified_agent</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="n">modified_vf</span>

    <span class="k">return</span> <span class="n">modified_agent</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.save" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">save_environment</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>The save function for PBVI Agents consists in recording the value function after the training.
It saves the agent in a folder with the name of the agent (class name + training timestamp).
In this folder, there will be the metadata of the agent (all the attributes) in a json format and the value function.</p>
<p>Optionally, the environment can be saved too to be able to load it alongside the agent for future reuse.
If the agent has already been saved, the saving will not happen unless the force parameter is toggled.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>folder</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The folder under which to save the agent (a subfolder will be created under this folder).
The agent will therefore be saved at <folder>/Agent-<agent_name> .
By default the current folder is used.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to overwrite an already saved agent with the same name at the same path.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_environment</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to save the environment data along with the agent.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
         <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
         <span class="n">save_environment</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
         <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    The save function for PBVI Agents consists in recording the value function after the training.</span>
<span class="sd">    It saves the agent in a folder with the name of the agent (class name + training timestamp).</span>
<span class="sd">    In this folder, there will be the metadata of the agent (all the attributes) in a json format and the value function.</span>

<span class="sd">    Optionally, the environment can be saved too to be able to load it alongside the agent for future reuse.</span>
<span class="sd">    If the agent has already been saved, the saving will not happen unless the force parameter is toggled.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    folder : str, optional</span>
<span class="sd">        The folder under which to save the agent (a subfolder will be created under this folder).</span>
<span class="sd">        The agent will therefore be saved at &lt;folder&gt;/Agent-&lt;agent_name&gt; .</span>
<span class="sd">        By default the current folder is used.</span>
<span class="sd">    force : bool, default=False</span>
<span class="sd">        Whether to overwrite an already saved agent with the same name at the same path.</span>
<span class="sd">    save_environment : bool, default=False</span>
<span class="sd">        Whether to save the environment data along with the agent.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;The agent is not trained, there is nothing to save.&quot;</span>

    <span class="c1"># GPU support</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cpu_version</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">save_environment</span><span class="o">=</span><span class="n">save_environment</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="c1"># Adding env name to folder path</span>
    <span class="k">if</span> <span class="n">folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./Agent-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">folder</span> <span class="o">+=</span> <span class="s1">&#39;/Agent-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="c1"># Checking the folder exists or creates it</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1"> is not empty. If you want to overwrite the saved model, enable &quot;force&quot;.&#39;</span><span class="p">)</span>

    <span class="c1"># If requested save environment</span>
    <span class="k">if</span> <span class="n">save_environment</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">)</span>

    <span class="c1"># TODO: Add MODEL to save function</span>
    <span class="c1"># Generating the metadata arguments dictionary</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;class&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_name</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">layer_lab</span><span class="p">:</span> <span class="n">layer_thresholds</span> <span class="k">for</span> <span class="n">layer_lab</span><span class="p">,</span> <span class="n">layer_thresholds</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">layer_labels</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">tolist</span><span class="p">())}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;thresholds&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">thresholds</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;environment_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">name</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;environment_saved_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">environment</span><span class="o">.</span><span class="n">saved_at</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;space_aware&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">space_aware</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;spacial_subdivisions&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">spacial_subdivisions</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;action_labels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_labels</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;action_set&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_set</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;trained_at&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>

    <span class="c1"># Output the arguments to a METADATA file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/METADATA.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Save value function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span> <span class="n">file_name</span><span class="o">=</span><span class="s1">&#39;Value_Function.npy&#39;</span><span class="p">)</span>

    <span class="c1"># Finalization</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">saved_at</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Agent saved to: </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.to_cpu" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_cpu</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to send the numpy arrays of the agent to the cpu.
It returns a new instance of the Agent class with the arrays on the cpu.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>cpu_agent</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Agent (olfactory_navigation.agent.Agent)" href="../../agent/#olfactory_navigation.agent.Agent">Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A new environment instance where the arrays are on the cpu memory.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBVI_Agent&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to send the numpy arrays of the agent to the cpu.</span>
<span class="sd">    It returns a new instance of the Agent class with the arrays on the cpu.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cpu_agent : Agent</span>
<span class="sd">        A new environment instance where the arrays are on the cpu memory.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Check whether the agent is already on the cpu or not</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[warning] A CPU instance already existed and is being recreated.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1"># Generating a new instance</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
    <span class="n">cpu_agent</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="c1"># Copying arguments to gpu</span>
    <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">asnumpy</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;rnd_state&#39;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">cpu_model</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ValueFunction</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">BeliefSet</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Belief</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">cpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="c1"># Self reference instances</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="n">cpu_agent</span>
    <span class="n">cpu_agent</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="n">cpu_agent</span><span class="o">.</span><span class="n">on_gpu</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">cpu_agent</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.to_gpu" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">to_gpu</span><span class="p">()</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to send the numpy arrays of the agent to the gpu.
It returns a new instance of the Agent class with the arrays on the gpu.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>gpu_agent</code></td>            <td>
                  <code><a class="autorefs autorefs-internal" title="Agent (olfactory_navigation.agent.Agent)" href="../../agent/#olfactory_navigation.agent.Agent">Agent</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A copy of the agent with the arrays on the GPU.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">to_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;PBVI_Agent&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to send the numpy arrays of the agent to the gpu.</span>
<span class="sd">    It returns a new instance of the Agent class with the arrays on the gpu.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gpu_agent : Agent</span>
<span class="sd">        A copy of the agent with the arrays on the GPU.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># Check whether the agent is already on the gpu or not</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="c1"># Warn and overwrite alternate_version in case it already exists</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[warning] A GPU instance already existed and is being recreated.&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">assert</span> <span class="n">gpu_support</span><span class="p">,</span> <span class="s2">&quot;GPU support is not enabled, Cupy might need to be installed...&quot;</span>

    <span class="c1"># Generating a new instance</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
    <span class="n">gpu_agent</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="c1"># Copying arguments to gpu</span>
    <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;rnd_state&#39;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">))</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Model</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">gpu_model</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">ValueFunction</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">())</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">BeliefSet</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">Belief</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_agent</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="c1"># Self reference instances</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="n">gpu_agent</span>
    <span class="n">gpu_agent</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="n">gpu_agent</span><span class="o">.</span><span class="n">on_gpu</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">gpu_agent</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.train" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train</span><span class="p">(</span><span class="n">expansions</span><span class="p">,</span> <span class="n">full_backup</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">update_passes</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_belief_growth</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">initial_belief</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">initial_value_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prune_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">prune_interval</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">limit_value_function_size</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-06</span><span class="p">,</span> <span class="n">use_gpu</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">history_tracking_level</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">overwrite_training</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">print_progress</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">print_stats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">expand_arguments</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Main loop of the Point-Based Value Iteration algorithm.
It consists in 2 steps, Backup and Expand.
1. Expand: Expands the belief set base with a expansion strategy given by the parameter expand_function
2. Backup: Updates the alpha vectors based on the current belief set</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expansions</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many times the algorithm has to expand the belief set. (the size will be doubled every time, eg: for 5, the belief set will be of size 32)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_backup</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force the backup function has to be run on the full set beliefs uncovered since the beginning or only on the new points.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>update_passes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many times the backup function has to be run every time the belief set is expanded.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_belief_growth</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many beliefs can be added at every expansion step to the belief set.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_belief</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a> or <a class="autorefs autorefs-internal" title="Belief (olfactory_navigation.agents.model_based_util.belief.Belief)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.Belief">Belief</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An initial list of beliefs to start with.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_value_function</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An initial value function to start the solving process with.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_level</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Parameter to prune the value function further before the expand function.</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>prune_interval</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How often to prune the value function. It is counted in number of backup iterations.</p>
              </div>
            </td>
            <td>
                  <code>10</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>limit_value_function_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>When the value function size crosses this threshold, a random selection of 'max_belief_growth' alpha vectors will be removed from the value function
If set to -1, the value function can grow without bounds.</p>
              </div>
            </td>
            <td>
                  <code>-1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_gpu</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to use the GPU with cupy array to accelerate solving.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The discount factor to value immediate rewards more than long term rewards.
The learning rate is 1/gamma.</p>
              </div>
            </td>
            <td>
                  <code>0.99</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The smallest allowed changed for the value function.
Bellow the amound of change, the value function is considered converged and the value iteration process will end early.</p>
              </div>
            </td>
            <td>
                  <code>1e-6</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>history_tracking_level</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How thorough the tracking of the solving process should be. (0: Nothing; 1: Times and sizes of belief sets and value function; 2: The actual value functions and beliefs sets)</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite_training</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether to force the overwriting of the training if a value function already exists for this agent.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_progress</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print out the progress of the value iteration process.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_stats</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether or not to print out statistics at the end of the training run.</p>
              </div>
            </td>
            <td>
                  <code>True</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>expand_arguments</code>
            </td>
            <td>
                  <code><span title="kwargs">kwargs</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An arbitrary amount of parameters that will be passed on to the expand function.</p>
              </div>
            </td>
            <td>
                  <code>{}</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>solver_history</code></td>            <td>
                  <code><span title="SolverHistory">SolverHistory</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The history of the solving process with some plotting options.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
          <span class="n">expansions</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
          <span class="n">full_backup</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
          <span class="n">update_passes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
          <span class="n">max_belief_growth</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
          <span class="n">initial_belief</span><span class="p">:</span> <span class="n">BeliefSet</span> <span class="o">|</span> <span class="n">Belief</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">initial_value_function</span><span class="p">:</span> <span class="n">ValueFunction</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
          <span class="n">prune_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
          <span class="n">prune_interval</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span>
          <span class="n">limit_value_function_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
          <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.99</span><span class="p">,</span>
          <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span>
          <span class="n">use_gpu</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
          <span class="n">history_tracking_level</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
          <span class="n">overwrite_training</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
          <span class="n">print_progress</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
          <span class="n">print_stats</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
          <span class="o">**</span><span class="n">expand_arguments</span>
          <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TrainingHistory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Main loop of the Point-Based Value Iteration algorithm.</span>
<span class="sd">    It consists in 2 steps, Backup and Expand.</span>
<span class="sd">    1. Expand: Expands the belief set base with a expansion strategy given by the parameter expand_function</span>
<span class="sd">    2. Backup: Updates the alpha vectors based on the current belief set</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expansions : int</span>
<span class="sd">        How many times the algorithm has to expand the belief set. (the size will be doubled every time, eg: for 5, the belief set will be of size 32)</span>
<span class="sd">    full_backup : bool, default=True</span>
<span class="sd">        Whether to force the backup function has to be run on the full set beliefs uncovered since the beginning or only on the new points.</span>
<span class="sd">    update_passes : int, default=1</span>
<span class="sd">        How many times the backup function has to be run every time the belief set is expanded.</span>
<span class="sd">    max_belief_growth : int, default=10</span>
<span class="sd">        How many beliefs can be added at every expansion step to the belief set.</span>
<span class="sd">    initial_belief : BeliefSet or Belief, optional</span>
<span class="sd">        An initial list of beliefs to start with.</span>
<span class="sd">    initial_value_function : ValueFunction, optional</span>
<span class="sd">        An initial value function to start the solving process with.</span>
<span class="sd">    prune_level : int, default=1</span>
<span class="sd">        Parameter to prune the value function further before the expand function.</span>
<span class="sd">    prune_interval : int, default=10</span>
<span class="sd">        How often to prune the value function. It is counted in number of backup iterations.</span>
<span class="sd">    limit_value_function_size : int, default=-1</span>
<span class="sd">        When the value function size crosses this threshold, a random selection of &#39;max_belief_growth&#39; alpha vectors will be removed from the value function</span>
<span class="sd">        If set to -1, the value function can grow without bounds.</span>
<span class="sd">    use_gpu : bool, default=False</span>
<span class="sd">        Whether to use the GPU with cupy array to accelerate solving.</span>
<span class="sd">    gamma : float, default=0.99</span>
<span class="sd">        The discount factor to value immediate rewards more than long term rewards.</span>
<span class="sd">        The learning rate is 1/gamma.</span>
<span class="sd">    eps : float, default=1e-6</span>
<span class="sd">        The smallest allowed changed for the value function.</span>
<span class="sd">        Bellow the amound of change, the value function is considered converged and the value iteration process will end early.</span>
<span class="sd">    history_tracking_level : int, default=1</span>
<span class="sd">        How thorough the tracking of the solving process should be. (0: Nothing; 1: Times and sizes of belief sets and value function; 2: The actual value functions and beliefs sets)</span>
<span class="sd">    overwrite_training : bool, default=False</span>
<span class="sd">        Whether to force the overwriting of the training if a value function already exists for this agent.</span>
<span class="sd">    print_progress : bool, default=True</span>
<span class="sd">        Whether or not to print out the progress of the value iteration process.</span>
<span class="sd">    print_stats : bool, default=True</span>
<span class="sd">        Whether or not to print out statistics at the end of the training run.</span>
<span class="sd">    expand_arguments : kwargs</span>
<span class="sd">        An arbitrary amount of parameters that will be passed on to the expand function.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    solver_history : SolverHistory</span>
<span class="sd">        The history of the solving process with some plotting options.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># GPU support</span>
    <span class="k">if</span> <span class="n">use_gpu</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
        <span class="n">gpu_agent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">()</span>
        <span class="n">solver_history</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="p">,</span> <span class="n">gpu_agent</span><span class="p">)</span><span class="o">.</span><span class="n">train</span><span class="p">(</span>
            <span class="n">expansions</span><span class="o">=</span><span class="n">expansions</span><span class="p">,</span>
            <span class="n">full_backup</span><span class="o">=</span><span class="n">full_backup</span><span class="p">,</span>
            <span class="n">update_passes</span><span class="o">=</span><span class="n">update_passes</span><span class="p">,</span>
            <span class="n">max_belief_growth</span><span class="o">=</span><span class="n">max_belief_growth</span><span class="p">,</span>
            <span class="n">initial_belief</span><span class="o">=</span><span class="n">initial_belief</span><span class="p">,</span>
            <span class="n">initial_value_function</span><span class="o">=</span><span class="n">initial_value_function</span><span class="p">,</span>
            <span class="n">prune_level</span><span class="o">=</span><span class="n">prune_level</span><span class="p">,</span>
            <span class="n">prune_interval</span><span class="o">=</span><span class="n">prune_interval</span><span class="p">,</span>
            <span class="n">limit_value_function_size</span><span class="o">=</span><span class="n">limit_value_function_size</span><span class="p">,</span>
            <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
            <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
            <span class="n">use_gpu</span><span class="o">=</span><span class="n">use_gpu</span><span class="p">,</span>
            <span class="n">history_tracking_level</span><span class="o">=</span><span class="n">history_tracking_level</span><span class="p">,</span>
            <span class="n">overwrite_training</span><span class="o">=</span><span class="n">overwrite_training</span><span class="p">,</span>
            <span class="n">print_progress</span><span class="o">=</span><span class="n">print_progress</span><span class="p">,</span>
            <span class="n">print_stats</span><span class="o">=</span><span class="n">print_stats</span><span class="p">,</span>
            <span class="o">**</span><span class="n">expand_arguments</span>
        <span class="p">)</span>

        <span class="c1"># Setting parameters of CPU agent after the training</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="n">gpu_agent</span><span class="o">.</span><span class="n">value_function</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span> <span class="o">=</span> <span class="n">gpu_agent</span><span class="o">.</span><span class="n">trained_at</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">gpu_agent</span><span class="o">.</span><span class="n">name</span>

        <span class="k">return</span> <span class="n">solver_history</span>

    <span class="n">xp</span> <span class="o">=</span> <span class="n">np</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">cp</span>

    <span class="c1"># Getting model</span>
    <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>

    <span class="c1"># Initial belief</span>
    <span class="k">if</span> <span class="n">initial_belief</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">belief_set</span> <span class="o">=</span> <span class="n">BeliefSet</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="n">Belief</span><span class="p">(</span><span class="n">model</span><span class="p">)])</span>
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">initial_belief</span><span class="p">,</span> <span class="n">BeliefSet</span><span class="p">):</span>
        <span class="n">belief_set</span> <span class="o">=</span> <span class="n">initial_belief</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">initial_belief</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">initial_belief</span> <span class="o">=</span> <span class="n">Belief</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">initial_belief</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
        <span class="n">belief_set</span> <span class="o">=</span> <span class="n">BeliefSet</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="p">[</span><span class="n">initial_belief</span><span class="p">])</span>

    <span class="c1"># Handeling the case where the agent is already trained</span>
    <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">overwrite_training</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[warning] The value function is being overwritten&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;-&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">initial_value_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span>

    <span class="c1"># Initial value function</span>
    <span class="k">if</span> <span class="n">initial_value_function</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">value_function</span> <span class="o">=</span> <span class="n">ValueFunction</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">expected_rewards_table</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">actions</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">value_function</span> <span class="o">=</span> <span class="n">initial_value_function</span><span class="o">.</span><span class="n">to_gpu</span><span class="p">()</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">initial_value_function</span>

    <span class="c1"># Convergence check boundary</span>
    <span class="n">max_allowed_change</span> <span class="o">=</span> <span class="n">eps</span> <span class="o">*</span> <span class="p">(</span><span class="n">gamma</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">gamma</span><span class="p">))</span>

    <span class="c1"># History tracking</span>
    <span class="n">training_history</span> <span class="o">=</span> <span class="n">TrainingHistory</span><span class="p">(</span><span class="n">tracking_level</span><span class="o">=</span><span class="n">history_tracking_level</span><span class="p">,</span>
                                       <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                                       <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                                       <span class="n">eps</span><span class="o">=</span><span class="n">eps</span><span class="p">,</span>
                                       <span class="n">expand_append</span><span class="o">=</span><span class="n">full_backup</span><span class="p">,</span>
                                       <span class="n">initial_value_function</span><span class="o">=</span><span class="n">value_function</span><span class="p">,</span>
                                       <span class="n">initial_belief_set</span><span class="o">=</span><span class="n">belief_set</span><span class="p">)</span>

    <span class="c1"># Loop</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">expand_value_function</span> <span class="o">=</span> <span class="n">value_function</span>
    <span class="n">old_value_function</span> <span class="o">=</span> <span class="n">value_function</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">iterator</span> <span class="o">=</span> <span class="n">trange</span><span class="p">(</span><span class="n">expansions</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="s1">&#39;Expansions&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">print_progress</span> <span class="k">else</span> <span class="nb">range</span><span class="p">(</span><span class="n">expansions</span><span class="p">)</span>
        <span class="n">iterator_postfix</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">expansion_i</span> <span class="ow">in</span> <span class="n">iterator</span><span class="p">:</span>

            <span class="c1"># 1: Expand belief set</span>
            <span class="n">start_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

            <span class="n">new_belief_set</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">belief_set</span><span class="o">=</span><span class="n">belief_set</span><span class="p">,</span>
                                         <span class="n">value_function</span><span class="o">=</span><span class="n">value_function</span><span class="p">,</span>
                                         <span class="n">max_generation</span><span class="o">=</span><span class="n">max_belief_growth</span><span class="p">,</span>
                                         <span class="o">**</span><span class="n">expand_arguments</span><span class="p">)</span>

            <span class="c1"># Add new beliefs points to the total belief_set</span>
            <span class="n">belief_set</span> <span class="o">=</span> <span class="n">belief_set</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">new_belief_set</span><span class="p">)</span>

            <span class="n">expand_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
            <span class="n">training_history</span><span class="o">.</span><span class="n">add_expand_step</span><span class="p">(</span><span class="n">expansion_time</span><span class="o">=</span><span class="n">expand_time</span><span class="p">,</span> <span class="n">belief_set</span><span class="o">=</span><span class="n">belief_set</span><span class="p">)</span>

            <span class="c1"># 2: Backup, update value function (alpha vector set)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">update_passes</span><span class="p">)</span> <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">print_progress</span> <span class="ow">or</span> <span class="n">update_passes</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">trange</span><span class="p">(</span><span class="n">update_passes</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Backups </span><span class="si">{</span><span class="n">expansion_i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">):</span>
                <span class="n">start_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

                <span class="c1"># Backup step</span>
                <span class="n">value_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">backup</span><span class="p">(</span><span class="n">belief_set</span> <span class="k">if</span> <span class="n">full_backup</span> <span class="k">else</span> <span class="n">new_belief_set</span><span class="p">,</span>
                                             <span class="n">value_function</span><span class="p">,</span>
                                             <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                                             <span class="n">append</span><span class="o">=</span><span class="p">(</span><span class="ow">not</span> <span class="n">full_backup</span><span class="p">),</span>
                                             <span class="n">belief_dominance_prune</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
                <span class="n">backup_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

                <span class="c1"># Additional pruning</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">iteration</span> <span class="o">%</span> <span class="n">prune_interval</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">iteration</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">start_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
                    <span class="n">vf_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span>

                    <span class="n">value_function</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="n">prune_level</span><span class="p">)</span>

                    <span class="n">prune_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
                    <span class="n">alpha_vectors_pruned</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span> <span class="o">-</span> <span class="n">vf_len</span>
                    <span class="n">training_history</span><span class="o">.</span><span class="n">add_prune_step</span><span class="p">(</span><span class="n">prune_time</span><span class="p">,</span> <span class="n">alpha_vectors_pruned</span><span class="p">)</span>

                <span class="c1"># Check if value function size is above threshold</span>
                <span class="k">if</span> <span class="n">limit_value_function_size</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">limit_value_function_size</span><span class="p">:</span>
                    <span class="c1"># Compute matrix multiplications between avs and beliefs</span>
                    <span class="n">alpha_value_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="p">,</span> <span class="n">belief_set</span><span class="o">.</span><span class="n">belief_array</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

                    <span class="c1"># Select the useful alpha vectors</span>
                    <span class="n">best_alpha_vector_per_belief</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">alpha_value_per_belief</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                    <span class="n">useful_alpha_vectors</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">best_alpha_vector_per_belief</span><span class="p">)</span>

                    <span class="c1"># Select a random selection of vectors to delete</span>
                    <span class="n">unuseful_alpha_vectors</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)),</span> <span class="n">useful_alpha_vectors</span><span class="p">)</span>
                    <span class="n">random_vectors_to_delete</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">unuseful_alpha_vectors</span><span class="p">,</span>
                                                                     <span class="n">size</span><span class="o">=</span><span class="n">max_belief_growth</span><span class="p">,</span>
                                                                     <span class="n">p</span><span class="o">=</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unuseful_alpha_vectors</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">unuseful_alpha_vectors</span><span class="p">)))))</span>
                                                                     <span class="c1"># replace=False,</span>
                                                                     <span class="c1"># p=1/len(unuseful_alpha_vectors))</span>

                    <span class="n">value_function</span> <span class="o">=</span> <span class="n">ValueFunction</span><span class="p">(</span><span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
                                                   <span class="n">alpha_vectors</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">value_function</span><span class="o">.</span><span class="n">alpha_vector_array</span><span class="p">,</span> <span class="n">random_vectors_to_delete</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                                                   <span class="n">action_list</span><span class="o">=</span><span class="n">xp</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="n">value_function</span><span class="o">.</span><span class="n">actions</span><span class="p">,</span> <span class="n">random_vectors_to_delete</span><span class="p">))</span>

                    <span class="n">iterator_postfix</span><span class="p">[</span><span class="s1">&#39;|useful|&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">useful_alpha_vectors</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

                <span class="c1"># Compute the change between value functions</span>
                <span class="n">max_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_change</span><span class="p">(</span><span class="n">value_function</span><span class="p">,</span> <span class="n">old_value_function</span><span class="p">,</span> <span class="n">belief_set</span><span class="p">)</span>

                <span class="c1"># History tracking</span>
                <span class="n">training_history</span><span class="o">.</span><span class="n">add_backup_step</span><span class="p">(</span><span class="n">backup_time</span><span class="p">,</span> <span class="n">max_change</span><span class="p">,</span> <span class="n">value_function</span><span class="p">)</span>

                <span class="c1"># Convergence check</span>
                <span class="k">if</span> <span class="n">max_change</span> <span class="o">&lt;</span> <span class="n">max_allowed_change</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="n">old_value_function</span> <span class="o">=</span> <span class="n">value_function</span>

                <span class="c1"># Update iteration counter</span>
                <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>

            <span class="c1"># Compute change with old expansion value function</span>
            <span class="n">expand_max_change</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_change</span><span class="p">(</span><span class="n">expand_value_function</span><span class="p">,</span> <span class="n">value_function</span><span class="p">,</span> <span class="n">belief_set</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">expand_max_change</span> <span class="o">&lt;</span> <span class="n">max_allowed_change</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">print_progress</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Converged!&#39;</span><span class="p">)</span>
                <span class="k">break</span>

            <span class="n">expand_value_function</span> <span class="o">=</span> <span class="n">value_function</span>

            <span class="n">iterator_postfix</span><span class="p">[</span><span class="s1">&#39;|V|&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span>
            <span class="n">iterator_postfix</span><span class="p">[</span><span class="s1">&#39;|B|&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">belief_set</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">print_progress</span><span class="p">:</span>
                <span class="n">iterator</span><span class="o">.</span><span class="n">set_postfix</span><span class="p">(</span><span class="n">iterator_postfix</span><span class="p">)</span>

    <span class="k">except</span> <span class="ne">MemoryError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Memory full: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Returning value function and history as is...</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Final pruning</span>
    <span class="n">start_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>
    <span class="n">vf_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span>

    <span class="n">value_function</span><span class="o">.</span><span class="n">prune</span><span class="p">(</span><span class="n">prune_level</span><span class="p">)</span>

    <span class="c1"># History tracking</span>
    <span class="n">prune_time</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="n">alpha_vectors_pruned</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">)</span> <span class="o">-</span> <span class="n">vf_len</span>
    <span class="n">training_history</span><span class="o">.</span><span class="n">add_prune_step</span><span class="p">(</span><span class="n">prune_time</span><span class="p">,</span> <span class="n">alpha_vectors_pruned</span><span class="p">)</span>

    <span class="c1"># Record when it was trained</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%Y%m</span><span class="si">%d</span><span class="s2">_%H%M%S&quot;</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;-trained_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">trained_at</span><span class="si">}</span><span class="s1">&#39;</span>

    <span class="c1"># Saving value function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">value_function</span> <span class="o">=</span> <span class="n">value_function</span>

    <span class="c1"># Print stats if requested</span>
    <span class="k">if</span> <span class="n">print_stats</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">training_history</span><span class="o">.</span><span class="n">summary</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">training_history</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.PBVI_Agent.update_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">update_state</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">source_reached</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to update the internal state(s) of the agent(s) based on the previous action(s) taken and the observation(s) received.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>action</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A 2D array of n movement vectors. If the environment is layered, the 1st component should be the layer.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The observation(s) the agent(s) made.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_reached</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A boolean array of whether the agent(s) have reached the source or not.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>update_successfull</code></td>            <td>
                  <code>(<span title="numpy.ndarray">ndarray</span>, <span title="optional">optional</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>If nothing is returned, it means all the agent's state updates have been successfull.
Else, a boolean np.ndarray of size n can be returned confirming for each agent whether the update has been successful or not.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">update_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">action</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                 <span class="n">observation</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                 <span class="n">source_reached</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to update the internal state(s) of the agent(s) based on the previous action(s) taken and the observation(s) received.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    action : np.ndarray</span>
<span class="sd">        A 2D array of n movement vectors. If the environment is layered, the 1st component should be the layer.</span>
<span class="sd">    observation : np.ndarray</span>
<span class="sd">        The observation(s) the agent(s) made.</span>
<span class="sd">    source_reached : np.ndarray</span>
<span class="sd">        A boolean array of whether the agent(s) have reached the source or not.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    update_successfull : np.ndarray, optional</span>
<span class="sd">        If nothing is returned, it means all the agent&#39;s state updates have been successfull.</span>
<span class="sd">        Else, a boolean np.ndarray of size n can be returned confirming for each agent whether the update has been successful or not.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Agent was not initialized yet, run the initialize_state function first&quot;</span>

    <span class="c1"># Discretizing observations</span>
    <span class="n">observation_ids</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">discretize_observations</span><span class="p">(</span><span class="n">observation</span><span class="o">=</span><span class="n">observation</span><span class="p">,</span> <span class="n">action</span><span class="o">=</span><span class="n">action</span><span class="p">,</span> <span class="n">source_reached</span><span class="o">=</span><span class="n">source_reached</span><span class="p">)</span>

    <span class="c1"># Update the set of beliefs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">belief</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">belief</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">actions</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">action_played</span><span class="p">,</span> <span class="n">observations</span><span class="o">=</span><span class="n">observation_ids</span><span class="p">,</span> <span class="n">throw_error</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Check for failed updates</span>
    <span class="n">update_successful</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">belief</span><span class="o">.</span><span class="n">belief_array</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="mf">0.0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">update_successful</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-class">



<h2 id="olfactory_navigation.agents.pbvi_agent.TrainingHistory" class="doc doc-heading">
            <code>TrainingHistory</code>


</h2>


    <div class="doc doc-contents ">



        <p>Class to represent the history of a solver for a POMDP solver.
It has mainly the purpose to have visualizations for the solution, belief set and the whole solving history.
The visualizations available are:
    - Belief set plot
    - Solution plot
    - Video of value function and belief set evolution over training.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tracking_level</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The tracking level of the solver.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Model (olfactory_navigation.agents.model_based_util.pomdp.Model)" href="../model_based_util/pomdp/#olfactory_navigation.agents.model_based_util.pomdp.Model">Model</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The model the solver has solved.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>gamma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The gamma parameter used by the solver (learning rate).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The epsilon parameter used by the solver (covergence bound).</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>expand_append</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Whether the expand function appends new belief points to the belief set of reloads it all.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_value_function</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial value function the solver will use to start the solving process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>initial_belief_set</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The initial belief set the solver will use to start the solving process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<p><span class="doc-section-title">Attributes:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.tracking_level">tracking_level</span></code></td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.model">model</span></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="Model (olfactory_navigation.agents.model_based_util.pomdp.Model)" href="../model_based_util/pomdp/#olfactory_navigation.agents.model_based_util.pomdp.Model">Model</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.gamma">gamma</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.eps">eps</span></code></td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.expand_append">expand_append</span></code></td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.run_ts">run_ts</span></code></td>
            <td>
                  <code><span title="datetime.datetime">datetime</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time at which the SolverHistory object was instantiated which is assumed to be the start of the solving run.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.expansion_times">expansion_times</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of recorded times of the expand function.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.backup_times">backup_times</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of recorded times of the backup function.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.alpha_vector_counts">alpha_vector_counts</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of recorded alpha vector count making up the value function over the solving process.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.beliefs_counts">beliefs_counts</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of recorded belief count making up the belief set over the solving process.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.value_function_changes">value_function_changes</span></code></td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of recorded value function changes (the maximum changed value between 2 value functions).</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.value_functions">value_functions</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of recorded value functions.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><span title="olfactory_navigation.agents.pbvi_agent.TrainingHistory.belief_sets">belief_sets</span></code></td>
            <td>
                  <code><span title="list">list</span>[<a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of recorded belief sets.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="solution

  
      property
   (olfactory_navigation.agents.pbvi_agent.TrainingHistory.solution)" href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.solution">solution</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td><code><a class="autorefs autorefs-internal" title="explored_beliefs

  
      property
   (olfactory_navigation.agents.pbvi_agent.TrainingHistory.explored_beliefs)" href="#olfactory_navigation.agents.pbvi_agent.TrainingHistory.explored_beliefs">explored_beliefs</a></code></td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>








              <details class="mkdocstrings-source">
                <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">TrainingHistory</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class to represent the history of a solver for a POMDP solver.</span>
<span class="sd">    It has mainly the purpose to have visualizations for the solution, belief set and the whole solving history.</span>
<span class="sd">    The visualizations available are:</span>
<span class="sd">        - Belief set plot</span>
<span class="sd">        - Solution plot</span>
<span class="sd">        - Video of value function and belief set evolution over training.</span>


<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    tracking_level : int</span>
<span class="sd">        The tracking level of the solver.</span>
<span class="sd">    model : Model</span>
<span class="sd">        The model the solver has solved.</span>
<span class="sd">    gamma : float</span>
<span class="sd">        The gamma parameter used by the solver (learning rate).</span>
<span class="sd">    eps : float</span>
<span class="sd">        The epsilon parameter used by the solver (covergence bound).</span>
<span class="sd">    expand_append : bool</span>
<span class="sd">        Whether the expand function appends new belief points to the belief set of reloads it all.</span>
<span class="sd">    initial_value_function : ValueFunction</span>
<span class="sd">        The initial value function the solver will use to start the solving process.</span>
<span class="sd">    initial_belief_set : BeliefSet</span>
<span class="sd">        The initial belief set the solver will use to start the solving process.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    tracking_level : int</span>
<span class="sd">    model : Model</span>
<span class="sd">    gamma : float</span>
<span class="sd">    eps : float</span>
<span class="sd">    expand_append : bool</span>
<span class="sd">    run_ts : datetime</span>
<span class="sd">        The time at which the SolverHistory object was instantiated which is assumed to be the start of the solving run.</span>
<span class="sd">    expansion_times : list[float]</span>
<span class="sd">        A list of recorded times of the expand function.</span>
<span class="sd">    backup_times : list[float]</span>
<span class="sd">        A list of recorded times of the backup function.</span>
<span class="sd">    alpha_vector_counts : list[int]</span>
<span class="sd">        A list of recorded alpha vector count making up the value function over the solving process.</span>
<span class="sd">    beliefs_counts : list[int]</span>
<span class="sd">        A list of recorded belief count making up the belief set over the solving process.</span>
<span class="sd">    value_function_changes : list[float]</span>
<span class="sd">        A list of recorded value function changes (the maximum changed value between 2 value functions).</span>
<span class="sd">    value_functions : list[ValueFunction]</span>
<span class="sd">        A list of recorded value functions.</span>
<span class="sd">    belief_sets : list[BeliefSet]</span>
<span class="sd">        A list of recorded belief sets.</span>
<span class="sd">    solution : ValueFunction</span>
<span class="sd">    explored_beliefs : BeliefSet</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">tracking_level</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
                 <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span>
                 <span class="n">gamma</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">eps</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                 <span class="n">expand_append</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
                 <span class="n">initial_value_function</span><span class="p">:</span> <span class="n">ValueFunction</span><span class="p">,</span>
                 <span class="n">initial_belief_set</span><span class="p">:</span> <span class="n">BeliefSet</span>
                 <span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">=</span> <span class="n">tracking_level</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eps</span> <span class="o">=</span> <span class="n">eps</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expand_append</span> <span class="o">=</span> <span class="n">expand_append</span>

        <span class="c1"># Time tracking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expansion_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_times</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pruning_times</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Value function and belief set sizes tracking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_vector_counts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beliefs_counts</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_counts</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha_vector_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial_value_function</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beliefs_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">initial_belief_set</span><span class="p">))</span>

        <span class="c1"># Value function and belief set tracking</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">belief_sets</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_functions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_function_changes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">belief_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initial_belief_set</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">initial_value_function</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">solution</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ValueFunction</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The last value function of the solving process.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Tracking level is set too low, increase it to 2 if you want to have value function tracking as well.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_functions</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">explored_beliefs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">BeliefSet</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The final set of beliefs explored during the solving.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Tracking level is set too low, increase it to 2 if you want to have belief sets tracking as well.&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">belief_sets</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">add_expand_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">expansion_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                        <span class="n">belief_set</span><span class="p">:</span> <span class="n">BeliefSet</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to add an expansion step in the simulation history by the explored belief set the expand function generated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        expansion_time : float</span>
<span class="sd">            The time it took to run a step of expansion of the belief set. (Also known as the exploration step.)</span>
<span class="sd">        belief_set : BeliefSet</span>
<span class="sd">            The belief set used for the Update step of the solving process.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">expansion_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">expansion_time</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">beliefs_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">belief_set</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">belief_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">belief_set</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">belief_set</span><span class="o">.</span><span class="n">is_on_gpu</span> <span class="k">else</span> <span class="n">belief_set</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">())</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">add_backup_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">backup_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                        <span class="n">value_function_change</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                        <span class="n">value_function</span><span class="p">:</span> <span class="n">ValueFunction</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to add a backup step in the simulation history by recording the value function the backup function generated.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        backup_time : float</span>
<span class="sd">            The time it took to run a step of backup of the value function. (Also known as the value function update.)</span>
<span class="sd">        value_function_change : float</span>
<span class="sd">            The change between the value function of this iteration and of the previous iteration.</span>
<span class="sd">        value_function : ValueFunction</span>
<span class="sd">            The value function resulting after a step of the solving process.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">backup_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">backup_time</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alpha_vector_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_function_changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value_function_change</span><span class="p">))</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value_function</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">value_function</span><span class="o">.</span><span class="n">is_on_gpu</span> <span class="k">else</span> <span class="n">value_function</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">())</span>


    <span class="k">def</span><span class="w"> </span><span class="nf">add_prune_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">prune_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                       <span class="n">alpha_vectors_pruned</span><span class="p">:</span> <span class="nb">int</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to add a prune step in the simulation history by recording the amount of alpha vectors that were pruned by the pruning function and how long it took.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        prune_time : float</span>
<span class="sd">            The time it took to run the pruning step.</span>
<span class="sd">        alpha_vectors_pruned : int</span>
<span class="sd">            How many alpha vectors were pruned.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pruning_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prune_time</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">prune_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha_vectors_pruned</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span><span class="w"> </span><span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        A summary as a string of the information recorded.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">summary_str</span> <span class="o">=</span>  <span class="sa">f</span><span class="s1">&#39;Summary of Point Based Value Iteration run&#39;</span>
        <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  - Model: </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">state_count</span><span class="si">}</span><span class="s1"> state, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">action_count</span><span class="si">}</span><span class="s1"> action, </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">observation_count</span><span class="si">}</span><span class="s1"> observations&#39;</span>
        <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  - Converged or stopped after </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_times</span><span class="p">)</span><span class="si">}</span><span class="s1"> expansion steps and </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_times</span><span class="p">)</span><span class="si">}</span><span class="s1"> backup steps.&#39;</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  - Resulting value function has </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_vector_counts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> alpha vectors.&#39;</span>
            <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  - Converged in </span><span class="si">{</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_times</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_times</span><span class="p">))</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">s&#39;</span>
            <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>

            <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  - Expand function took on average </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_times</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_times</span><span class="p">)</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">s &#39;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">expand_append</span><span class="p">:</span>
                <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;and yielded on average </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beliefs_counts</span><span class="p">))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beliefs_counts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> beliefs per iteration.&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;and yielded on average </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beliefs_counts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">beliefs_counts</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> beliefs per iteration.&#39;</span>
            <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_times</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">beliefs_counts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">expansion_times</span><span class="p">)</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">s/it/belief)&#39;</span>

            <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  - Backup function took on average </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_times</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_times</span><span class="p">)</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">s &#39;</span>
            <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;and yielded on average </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_vector_counts</span><span class="p">))</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> alpha vectors per iteration.&#39;</span>
            <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39; (</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_times</span><span class="p">,</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">alpha_vector_counts</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">backup_times</span><span class="p">)</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">s/it/alpha)&#39;</span>

            <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">  - Pruning function took on average </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pruning_times</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pruning_times</span><span class="p">)</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">s &#39;</span>
            <span class="n">summary_str</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;and yielded on average prunings of </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_counts</span><span class="p">)</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">prune_counts</span><span class="p">)</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> alpha vectors per iteration.&#39;</span>

        <span class="k">return</span> <span class="n">summary_str</span>
</code></pre></div></td></tr></table></div>
              </details>



<div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="olfactory_navigation.agents.pbvi_agent.TrainingHistory.explored_beliefs" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">explored_beliefs</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The final set of beliefs explored during the solving.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="olfactory_navigation.agents.pbvi_agent.TrainingHistory.solution" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">solution</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>The last value function of the solving process.</p>

    </div>

</div>

<div class="doc doc-object doc-attribute">



<h3 id="olfactory_navigation.agents.pbvi_agent.TrainingHistory.summary" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">summary</span></code>

  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


    <div class="doc doc-contents ">

        <p>A summary as a string of the information recorded.</p>

    </div>

</div>




<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.TrainingHistory.add_backup_step" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_backup_step</span><span class="p">(</span><span class="n">backup_time</span><span class="p">,</span> <span class="n">value_function_change</span><span class="p">,</span> <span class="n">value_function</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to add a backup step in the simulation history by recording the value function the backup function generated.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>backup_time</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time it took to run a step of backup of the value function. (Also known as the value function update.)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value_function_change</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The change between the value function of this iteration and of the previous iteration.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>value_function</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="ValueFunction (olfactory_navigation.agents.model_based_util.value_function.ValueFunction)" href="../model_based_util/value_function/#olfactory_navigation.agents.model_based_util.value_function.ValueFunction">ValueFunction</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The value function resulting after a step of the solving process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_backup_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">backup_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">value_function_change</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">value_function</span><span class="p">:</span> <span class="n">ValueFunction</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to add a backup step in the simulation history by recording the value function the backup function generated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    backup_time : float</span>
<span class="sd">        The time it took to run a step of backup of the value function. (Also known as the value function update.)</span>
<span class="sd">    value_function_change : float</span>
<span class="sd">        The change between the value function of this iteration and of the previous iteration.</span>
<span class="sd">    value_function : ValueFunction</span>
<span class="sd">        The value function resulting after a step of the solving process.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">backup_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">backup_time</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alpha_vector_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">value_function</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_function_changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">value_function_change</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_functions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">value_function</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">value_function</span><span class="o">.</span><span class="n">is_on_gpu</span> <span class="k">else</span> <span class="n">value_function</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.TrainingHistory.add_expand_step" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_expand_step</span><span class="p">(</span><span class="n">expansion_time</span><span class="p">,</span> <span class="n">belief_set</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to add an expansion step in the simulation history by the explored belief set the expand function generated.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>expansion_time</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time it took to run a step of expansion of the belief set. (Also known as the exploration step.)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>belief_set</code>
            </td>
            <td>
                  <code><a class="autorefs autorefs-internal" title="BeliefSet (olfactory_navigation.agents.model_based_util.belief.BeliefSet)" href="../model_based_util/belief/#olfactory_navigation.agents.model_based_util.belief.BeliefSet">BeliefSet</a></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The belief set used for the Update step of the solving process.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_expand_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">expansion_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                    <span class="n">belief_set</span><span class="p">:</span> <span class="n">BeliefSet</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to add an expansion step in the simulation history by the explored belief set the expand function generated.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    expansion_time : float</span>
<span class="sd">        The time it took to run a step of expansion of the belief set. (Also known as the exploration step.)</span>
<span class="sd">    belief_set : BeliefSet</span>
<span class="sd">        The belief set used for the Update step of the solving process.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">expansion_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">expansion_time</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">beliefs_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">belief_set</span><span class="p">))</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">belief_sets</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">belief_set</span> <span class="k">if</span> <span class="ow">not</span> <span class="n">belief_set</span><span class="o">.</span><span class="n">is_on_gpu</span> <span class="k">else</span> <span class="n">belief_set</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="olfactory_navigation.agents.pbvi_agent.TrainingHistory.add_prune_step" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_prune_step</span><span class="p">(</span><span class="n">prune_time</span><span class="p">,</span> <span class="n">alpha_vectors_pruned</span><span class="p">)</span></code>

</h3>


    <div class="doc doc-contents ">

        <p>Function to add a prune step in the simulation history by recording the amount of alpha vectors that were pruned by the pruning function and how long it took.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>prune_time</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The time it took to run the pruning step.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha_vectors_pruned</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>How many alpha vectors were pruned.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="mkdocstrings-source">
              <summary>Source code in <code>olfactory_navigation/agents/pbvi_agent.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">add_prune_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">prune_time</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
                   <span class="n">alpha_vectors_pruned</span><span class="p">:</span> <span class="nb">int</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to add a prune step in the simulation history by recording the amount of alpha vectors that were pruned by the pruning function and how long it took.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    prune_time : float</span>
<span class="sd">        The time it took to run the pruning step.</span>
<span class="sd">    alpha_vectors_pruned : int</span>
<span class="sd">        How many alpha vectors were pruned.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">tracking_level</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pruning_times</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">prune_time</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">prune_counts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha_vectors_pruned</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>




  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../model_based_util/vi_solver/" class="md-footer__link md-footer__link--prev" aria-label="Previous: vi_solver">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                vi_solver
              </div>
            </div>
          </a>
        
        
          
          <a href="../pbvi_ger_agent/" class="md-footer__link md-footer__link--next" aria-label="Next: pbvi_ger_agent">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                pbvi_ger_agent
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "../../..", "features": ["navigation.footer", "navigation.path", "navigation.top", "navigation.tabs", "navigation.tabs.sticky"], "search": "../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../../../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>