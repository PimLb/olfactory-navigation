
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../mdp/">
      
      
        <link rel="next" href="../value_function/">
      
      
      <link rel="icon" href="../../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.22">
    
    
      
        <title>Pomdp - olfactory_navigation_docs</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.732c4fb1.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#src.agents.model_based_util.pomdp" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="olfactory_navigation_docs" class="md-header__button md-logo" aria-label="olfactory_navigation_docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            olfactory_navigation_docs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Pomdp
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/PimLb/olfactory-navigation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="olfactory_navigation_docs" class="md-nav__button md-logo" aria-label="olfactory_navigation_docs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    olfactory_navigation_docs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PimLb/olfactory-navigation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../SUMMARY/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SUMMARY
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../environment/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../simulation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Simulation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../test_setups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Test setups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6" checked>
        
          
          <label class="md-nav__link" for="__nav_2_6" id="__nav_2_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Agents
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_6_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_6">
            <span class="md-nav__icon md-icon"></span>
            Agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../fsvi_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Fsvi agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../hsvi_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hsvi agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../infotaxis_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Infotaxis agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pbvi_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pbvi agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pbvi_ger_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pbvi ger agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pbvi_ra_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pbvi ra agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pbvi_ssea_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pbvi ssea agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pbvi_ssga_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pbvi ssga agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../pbvi_ssra_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Pbvi ssra agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../perseus_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Perseus agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../q_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Q agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../qmdp_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Qmdp agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_6_13" checked>
        
          
          <label class="md-nav__link" for="__nav_2_6_13" id="__nav_2_6_13_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Model based util
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_6_13_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_6_13">
            <span class="md-nav__icon md-icon"></span>
            Model based util
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../belief/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Belief
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../belief_value_mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Belief value mapping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../mdp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mdp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Pomdp
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Pomdp
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp" class="md-nav__link">
    <span class="md-ellipsis">
      pomdp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp.Model" class="md-nav__link">
    <span class="md-ellipsis">
      Model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp.Model.from_environment" class="md-nav__link">
    <span class="md-ellipsis">
      from_environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp.Model.from_environment--todo-implement-different-action-sets" class="md-nav__link">
    <span class="md-ellipsis">
      TODO: Implement different action sets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp.Model.observe" class="md-nav__link">
    <span class="md-ellipsis">
      observe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp.Model.reward" class="md-nav__link">
    <span class="md-ellipsis">
      reward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../value_function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Value function
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vi_solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vi solver
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp" class="md-nav__link">
    <span class="md-ellipsis">
      pomdp
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp.Model" class="md-nav__link">
    <span class="md-ellipsis">
      Model
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp.Model.from_environment" class="md-nav__link">
    <span class="md-ellipsis">
      from_environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="from_environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp.Model.from_environment--todo-implement-different-action-sets" class="md-nav__link">
    <span class="md-ellipsis">
      TODO: Implement different action sets
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp.Model.observe" class="md-nav__link">
    <span class="md-ellipsis">
      observe
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.agents.model_based_util.pomdp.Model.reward" class="md-nav__link">
    <span class="md-ellipsis">
      reward
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>Pomdp</h1>

<div class="doc doc-object doc-module">



<a id="src.agents.model_based_util.pomdp"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.agents.model_based_util.pomdp.Model" class="doc doc-heading">
          <code>Model</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="src.agents.model_based_util.mdp.Model" href="../mdp/#src.agents.model_based_util.mdp.Model">Model</a></code></p>

  
      <p>POMDP Model class. Partially Observable Markov Decision Process Model.</p>
<p>...</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>states</code></td>
          <td>
                <code>int or list[str] or list[list[str]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of state labels or an amount of states to be used. Also allows to provide a matrix of states to define a grid model.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>actions</code></td>
          <td>
                <code>int or list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of action labels or an amount of actions to be used.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>observations</code></td>
          <td>
                <code>int or list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of observation labels or an amount of observations to be used</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>transitions</code></td>
          <td>
                <code>array - like or function</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The transitions between states, an array can be provided and has to be |S| x |A| x |S| or a function can be provided. 
If a function is provided, it has be able to deal with np.array arguments.
If none is provided, it will be randomly generated.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>reachable_states</code></td>
          <td>
                <code>array - like</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of states that can be reached from each state and actions. It must be a matrix of size |S| x |A| x |R| where |R| is the max amount of states reachable from any given state and action pair.
It is optional but useful for speedup purposes.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>rewards</code></td>
          <td>
                <code>array - like or function</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The reward matrix, has to be |S| x |A| x |S|.
A function can also be provided here but it has to be able to deal with np.array arguments.
If provided, it will be use in combination with the transition matrix to fill to expected rewards.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>observation_table</code></td>
          <td>
                <code>array - like or function</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The observation matrix, has to be |S| x |A| x |O|. If none is provided, it will be randomly generated.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>rewards_are_probabilistic</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether the rewards provided are probabilistic or pure rewards. If probabilist 0 or 1 will be the reward with a certain probability.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>state_grid</code></td>
          <td>
                <code>array - like</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If provided, the model will be converted to a grid model.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>start_probabilities</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The distribution of chances to start in each state. If not provided, there will be an uniform chance for each state. It is also used to represent a belief of complete uncertainty.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>end_states</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Entering either state in the list during a simulation will end the simulation.</p>
            </div>
          </td>
          <td>
                <code>[]</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>end_actions</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Playing action of the list during a simulation will end the simulation.</p>
            </div>
          </td>
          <td>
                <code>[]</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Attributes:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.states">states</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 1D array of states indices. Used to loop over states.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.state_labels">state_labels</span></code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of state labels. (To be mainly used for plotting)</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.state_count">state_count</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>How many states are in the Model.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.state_grid">state_grid</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The state indices organized as a 2D grid. (Used for plotting purposes)</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.actions">actions</span></code></td>
          <td>
                <code><span title="numpy.ndarry">ndarry</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 1D array of action indices. Used to loop over actions.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.action_labels">action_labels</span></code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of action labels. (To be mainly used for plotting)</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.action_count">action_count</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>How many action are in the Model.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.observations">observations</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 1D array of observation indices. Used to loop over obervations.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.observation_labels">observation_labels</span></code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of observation labels. (To be mainly used for plotting)</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.observation_count">observation_count</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>How many observations can be made in the Model.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.transition_table">transition_table</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 3D matrix of the transition probabilities.
Can be None in the case a transition function is provided instead.
Note: When possible, use reachable states and reachable probabilities instead.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.transition_function">transition_function</span></code></td>
          <td>
                <code>function</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A callable function taking 3 arguments: s, a, s_p; and returning a float between 0.0 and 1.0.
Can be None in the case a transition table is provided instead.
Note: When possible, use reachable states and reachable probabilities instead.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.observation_table">observation_table</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 3D matrix of shape S x A x O representing the probabilies of obsevating o when taking action a and leading to state s_p.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.reachable_states">reachable_states</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 3D array of the shape S x A x R, where R is max amount to states that can be reached from any state-action pair.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.reachable_probabilities">reachable_probabilities</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 3D array of the same shape as reachable_states, the array represent the probability of reaching the state pointed by the reachable_states matrix.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.reachable_state_count">reachable_state_count</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The maximum of states that can be reached from any state-action combination.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.reachable_transitional_observation_table">reachable_transitional_observation_table</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 4D array of shape S x A x O x R, representing the probabiliies of landing if each reachable state r, while observing o after having taken action a from state s.
Mainly used to speedup repeated operations in solver.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.immediate_reward_table">immediate_reward_table</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 3D matrix of shape S x A x S x O of the reward that will received when taking action a, in state s, landing in state s_p, and observing o.
Can be None in the case an immediate rewards function is provided instead.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.immediate_reward_function">immediate_reward_function</span></code></td>
          <td>
                <code>function</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A callable function taking 4 argments: s, a, s_p, o and returning the immediate reward the agent will receive.
Can be None in the case an immediate rewards function is provided instead.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.expected_reward_table">expected_reward_table</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 2D array of shape S x A. It represents the rewards that is expected to be received when taking action a from state s.
It is made by taking the weighted average of immediate rewards with the transitions and the observation probabilities.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.start_probabilities">start_probabilities</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 1D array of length |S| containing the probility distribution of the agent starting in each state.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.rewards_are_probabilisitic">rewards_are_probabilisitic</span></code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether the immediate rewards are probabilitic, ie: returning a 0 or 1 based on the reward that is considered to be a probability.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.end_states">end_states</span></code></td>
          <td>
                <code>list[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of states that, when reached, terminate a simulation.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.end_actions">end_actions</span></code></td>
          <td>
                <code>list[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of actions that, when taken, terminate a simulation.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.agents.model_based_util.pomdp.Model.is_on_gpu">is_on_gpu</span></code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether the numpy array of the model are stored on the gpu or not.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><a class="autorefs autorefs-internal" title="src.agents.model_based_util.pomdp.Model.gpu_model" href="../mdp/#src.agents.model_based_util.mdp.Model.gpu_model">gpu_model</a></code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="src.agents.model_based_util.mdp.Model" href="../mdp/#src.agents.model_based_util.mdp.Model">Model</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An equivalent model with the np.ndarray objects on GPU. (If already on GPU, returns self)</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><a class="autorefs autorefs-internal" title="src.agents.model_based_util.pomdp.Model.cpu_model" href="../mdp/#src.agents.model_based_util.mdp.Model.cpu_model">cpu_model</a></code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="src.agents.model_based_util.mdp.Model" href="../mdp/#src.agents.model_based_util.mdp.Model">Model</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An equivalent model with the np.ndarray objects on CPU. (If already on CPU, returns self)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src\agents\model_based_util\pomdp.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Model</span><span class="p">(</span><span class="n">MDP_Model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    POMDP Model class. Partially Observable Markov Decision Process Model.</span>

<span class="sd">    ...</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    states : int or list[str] or list[list[str]]</span>
<span class="sd">        A list of state labels or an amount of states to be used. Also allows to provide a matrix of states to define a grid model.</span>
<span class="sd">    actions : int or list</span>
<span class="sd">        A list of action labels or an amount of actions to be used.</span>
<span class="sd">    observations : int or list</span>
<span class="sd">        A list of observation labels or an amount of observations to be used</span>
<span class="sd">    transitions : array-like or function, optional</span>
<span class="sd">        The transitions between states, an array can be provided and has to be |S| x |A| x |S| or a function can be provided. </span>
<span class="sd">        If a function is provided, it has be able to deal with np.array arguments.</span>
<span class="sd">        If none is provided, it will be randomly generated.</span>
<span class="sd">    reachable_states : array-like, optional</span>
<span class="sd">        A list of states that can be reached from each state and actions. It must be a matrix of size |S| x |A| x |R| where |R| is the max amount of states reachable from any given state and action pair.</span>
<span class="sd">        It is optional but useful for speedup purposes.</span>
<span class="sd">    rewards : array-like or function, optional</span>
<span class="sd">        The reward matrix, has to be |S| x |A| x |S|.</span>
<span class="sd">        A function can also be provided here but it has to be able to deal with np.array arguments.</span>
<span class="sd">        If provided, it will be use in combination with the transition matrix to fill to expected rewards.</span>
<span class="sd">    observation_table : array-like or function, optional</span>
<span class="sd">        The observation matrix, has to be |S| x |A| x |O|. If none is provided, it will be randomly generated.</span>
<span class="sd">    rewards_are_probabilistic: bool, default=False</span>
<span class="sd">        Whether the rewards provided are probabilistic or pure rewards. If probabilist 0 or 1 will be the reward with a certain probability.</span>
<span class="sd">    state_grid : array-like, optional</span>
<span class="sd">        If provided, the model will be converted to a grid model.</span>
<span class="sd">    start_probabilities : list, optional</span>
<span class="sd">        The distribution of chances to start in each state. If not provided, there will be an uniform chance for each state. It is also used to represent a belief of complete uncertainty.</span>
<span class="sd">    end_states : list, optional</span>
<span class="sd">        Entering either state in the list during a simulation will end the simulation.</span>
<span class="sd">    end_actions : list, optional</span>
<span class="sd">        Playing action of the list during a simulation will end the simulation.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    states : np.ndarray</span>
<span class="sd">        A 1D array of states indices. Used to loop over states.</span>
<span class="sd">    state_labels : list[str]</span>
<span class="sd">        A list of state labels. (To be mainly used for plotting)</span>
<span class="sd">    state_count : int</span>
<span class="sd">        How many states are in the Model.</span>
<span class="sd">    state_grid : np.ndarray</span>
<span class="sd">        The state indices organized as a 2D grid. (Used for plotting purposes)</span>
<span class="sd">    actions : np.ndarry</span>
<span class="sd">        A 1D array of action indices. Used to loop over actions.</span>
<span class="sd">    action_labels : list[str]</span>
<span class="sd">        A list of action labels. (To be mainly used for plotting)</span>
<span class="sd">    action_count : int</span>
<span class="sd">        How many action are in the Model.</span>
<span class="sd">    observations : np.ndarray</span>
<span class="sd">        A 1D array of observation indices. Used to loop over obervations.</span>
<span class="sd">    observation_labels : list[str]</span>
<span class="sd">        A list of observation labels. (To be mainly used for plotting)</span>
<span class="sd">    observation_count : int</span>
<span class="sd">        How many observations can be made in the Model.</span>
<span class="sd">    transition_table : np.ndarray</span>
<span class="sd">        A 3D matrix of the transition probabilities.</span>
<span class="sd">        Can be None in the case a transition function is provided instead.</span>
<span class="sd">        Note: When possible, use reachable states and reachable probabilities instead.</span>
<span class="sd">    transition_function : function</span>
<span class="sd">        A callable function taking 3 arguments: s, a, s_p; and returning a float between 0.0 and 1.0.</span>
<span class="sd">        Can be None in the case a transition table is provided instead.</span>
<span class="sd">        Note: When possible, use reachable states and reachable probabilities instead.</span>
<span class="sd">    observation_table : np.ndarray</span>
<span class="sd">        A 3D matrix of shape S x A x O representing the probabilies of obsevating o when taking action a and leading to state s_p.</span>
<span class="sd">    reachable_states : np.ndarray</span>
<span class="sd">        A 3D array of the shape S x A x R, where R is max amount to states that can be reached from any state-action pair.</span>
<span class="sd">    reachable_probabilities : np.ndarray</span>
<span class="sd">        A 3D array of the same shape as reachable_states, the array represent the probability of reaching the state pointed by the reachable_states matrix.</span>
<span class="sd">    reachable_state_count : int</span>
<span class="sd">        The maximum of states that can be reached from any state-action combination.</span>
<span class="sd">    reachable_transitional_observation_table : np.ndarray</span>
<span class="sd">        A 4D array of shape S x A x O x R, representing the probabiliies of landing if each reachable state r, while observing o after having taken action a from state s.</span>
<span class="sd">        Mainly used to speedup repeated operations in solver.</span>
<span class="sd">    immediate_reward_table : np.ndarray</span>
<span class="sd">        A 3D matrix of shape S x A x S x O of the reward that will received when taking action a, in state s, landing in state s_p, and observing o.</span>
<span class="sd">        Can be None in the case an immediate rewards function is provided instead.</span>
<span class="sd">    immediate_reward_function : function</span>
<span class="sd">        A callable function taking 4 argments: s, a, s_p, o and returning the immediate reward the agent will receive.</span>
<span class="sd">        Can be None in the case an immediate rewards function is provided instead.</span>
<span class="sd">    expected_reward_table : np.ndarray</span>
<span class="sd">        A 2D array of shape S x A. It represents the rewards that is expected to be received when taking action a from state s.</span>
<span class="sd">        It is made by taking the weighted average of immediate rewards with the transitions and the observation probabilities.</span>
<span class="sd">    start_probabilities : np.ndarray</span>
<span class="sd">        A 1D array of length |S| containing the probility distribution of the agent starting in each state.</span>
<span class="sd">    rewards_are_probabilisitic : bool</span>
<span class="sd">        Whether the immediate rewards are probabilitic, ie: returning a 0 or 1 based on the reward that is considered to be a probability.</span>
<span class="sd">    end_states : list[int]</span>
<span class="sd">        A list of states that, when reached, terminate a simulation.</span>
<span class="sd">    end_actions : list[int]</span>
<span class="sd">        A list of actions that, when taken, terminate a simulation.</span>
<span class="sd">    is_on_gpu : bool</span>
<span class="sd">        Whether the numpy array of the model are stored on the gpu or not.</span>
<span class="sd">    gpu_model : mdp.Model</span>
<span class="sd">        An equivalent model with the np.ndarray objects on GPU. (If already on GPU, returns self)</span>
<span class="sd">    cpu_model : mdp.Model</span>
<span class="sd">        An equivalent model with the np.ndarray objects on CPU. (If already on CPU, returns self)</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">states</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]]],</span>
                 <span class="n">actions</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
                 <span class="n">observations</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">list</span><span class="p">],</span>
                 <span class="n">transitions</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">reachable_states</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">rewards</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">observation_table</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">rewards_are_probabilistic</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">state_grid</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">start_probabilities</span><span class="p">:</span><span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span><span class="kc">None</span><span class="p">]</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                 <span class="n">end_states</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="p">[],</span>
                 <span class="n">end_actions</span><span class="p">:</span><span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span><span class="o">=</span><span class="p">[]</span>
                 <span class="p">):</span>

        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">states</span><span class="o">=</span><span class="n">states</span><span class="p">,</span>
                         <span class="n">actions</span><span class="o">=</span><span class="n">actions</span><span class="p">,</span>
                         <span class="n">transitions</span><span class="o">=</span><span class="n">transitions</span><span class="p">,</span>
                         <span class="n">reachable_states</span><span class="o">=</span><span class="n">reachable_states</span><span class="p">,</span>
                         <span class="n">rewards</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="c1"># Defined here lower since immediate reward table has different shape for MDP is different than for POMDP</span>
                         <span class="n">rewards_are_probabilistic</span><span class="o">=</span><span class="n">rewards_are_probabilistic</span><span class="p">,</span>
                         <span class="n">state_grid</span><span class="o">=</span><span class="n">state_grid</span><span class="p">,</span>
                         <span class="n">start_probabilities</span><span class="o">=</span><span class="n">start_probabilities</span><span class="p">,</span>
                         <span class="n">end_states</span><span class="o">=</span><span class="n">end_states</span><span class="p">,</span>
                         <span class="n">end_actions</span><span class="o">=</span><span class="n">end_actions</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">()</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;POMDP particular parameters:&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">movement_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span> <span class="c1"># North</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span> <span class="c1"># East</span>
            <span class="p">[</span> <span class="mi">1</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span> <span class="c1"># South</span>
            <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># West</span>
        <span class="p">])</span>

        <span class="c1"># ------------------------- Observations -------------------------</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">observations</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;o_</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">observations</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span> <span class="o">=</span> <span class="n">observations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observation_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_labels</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_count</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">observation_table</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># If no observation matrix given, generate random one</span>
            <span class="n">random_probs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_count</span><span class="p">)</span>
            <span class="c1"># Normalization to have s_p probabilies summing to 1</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observation_table</span> <span class="o">=</span> <span class="n">random_probs</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">random_probs</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">observation_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">observation_table</span><span class="p">)</span>
            <span class="n">o_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_table</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">exp_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_count</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">o_shape</span> <span class="o">==</span> <span class="n">exp_shape</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Observations table doesnt have the right shape, it should be SxAxO (expected: </span><span class="si">{</span><span class="n">exp_shape</span><span class="si">}</span><span class="s2">, received: </span><span class="si">{</span><span class="n">o_shape</span><span class="si">}</span><span class="s2">).&quot;</span>

        <span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;- </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_count</span><span class="si">}</span><span class="s1"> observations&#39;</span><span class="p">)</span>

        <span class="c1"># ------------------------- Reachable transitional observation probabilities -------------------------</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;- Starting of transitional observations for reachable states table&#39;</span><span class="p">)</span>
        <span class="n">start_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="n">reachable_observations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_table</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">reachable_states</span><span class="p">[:,:,</span><span class="kc">None</span><span class="p">,:],</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="kc">None</span><span class="p">,:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:,</span><span class="kc">None</span><span class="p">]]</span> <span class="c1"># SAOR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reachable_transitional_observation_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;sar,saor-&gt;saor&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reachable_probabilities</span><span class="p">,</span> <span class="n">reachable_observations</span><span class="p">)</span>

        <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    &gt; Done in </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>

        <span class="c1"># ------------------------- Rewards -------------------------</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_table</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_function</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="k">if</span> <span class="n">rewards</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_states</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">end_actions</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
                <span class="n">log</span><span class="p">(</span><span class="s1">&#39;- [Warning] Rewards are not define but end states/actions are, reaching an end state or doing an end action will give a reward of 1.&#39;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_end_reward_function</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># If no reward matrix given, generate random one</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_count</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">callable</span><span class="p">(</span><span class="n">rewards</span><span class="p">):</span>
            <span class="c1"># Rewards is a function</span>
            <span class="n">log</span><span class="p">(</span><span class="s1">&#39;- [Warning] The rewards are provided as a function, if the model is saved, the rewards will need to be defined before loading model.&#39;</span><span class="p">)</span>
            <span class="n">log</span><span class="p">(</span><span class="s1">&#39;    &gt; Alternative: Setting end states/actions and leaving the rewards can be done to make the end states/action giving a reward of 1 by default.&#39;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_function</span> <span class="o">=</span> <span class="n">rewards</span>
            <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">signature</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span><span class="o">.</span><span class="n">parameters</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">,</span> <span class="s2">&quot;Reward function should accept 4 parameters: s, a, sn, o...&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Array like</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">rewards</span><span class="p">)</span>
            <span class="n">r_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_table</span><span class="o">.</span><span class="n">shape</span>
            <span class="n">exp_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">action_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">state_count</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_count</span><span class="p">)</span>
            <span class="k">assert</span> <span class="n">r_shape</span> <span class="o">==</span> <span class="n">exp_shape</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;Rewards table doesnt have the right shape, it should be SxAxSxO (expected: </span><span class="si">{</span><span class="n">exp_shape</span><span class="si">}</span><span class="s2">, received </span><span class="si">{</span><span class="n">r_shape</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># ------------------------- Expected rewards -------------------------</span>
        <span class="n">log</span><span class="p">(</span><span class="s1">&#39;- Starting generation of expected rewards table&#39;</span><span class="p">)</span>
        <span class="n">start_ts</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

        <span class="n">reachable_rewards</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">reachable_rewards</span> <span class="o">=</span> <span class="n">rewards</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">states</span><span class="p">[:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">actions</span><span class="p">[</span><span class="kc">None</span><span class="p">,:,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">reachable_states</span><span class="p">[:,:,:,</span><span class="kc">None</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="p">[</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:]]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">reach_reward_func</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">ri</span><span class="p">,</span><span class="n">o</span><span class="p">):</span>
                <span class="n">s</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="n">ri</span> <span class="o">=</span> <span class="n">ri</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="n">o</span> <span class="o">=</span> <span class="n">o</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_function</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">reachable_states</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">ri</span><span class="p">],</span><span class="n">o</span><span class="p">)</span>

            <span class="n">reachable_rewards</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span><span class="n">reach_reward_func</span><span class="p">,</span> <span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">reachable_states</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">observation_count</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_min_reward</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">reachable_rewards</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_max_reward</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">reachable_rewards</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">expected_rewards_table</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;saor,saro-&gt;sa&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">reachable_transitional_observation_table</span><span class="p">,</span> <span class="n">reachable_rewards</span><span class="p">)</span>

        <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span> <span class="o">-</span> <span class="n">start_ts</span><span class="p">)</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
        <span class="n">log</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    &gt; Done in </span><span class="si">{</span><span class="n">duration</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_environment</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                         <span class="n">environment</span><span class="p">:</span><span class="n">Environment</span><span class="p">,</span>
                         <span class="n">threshold</span><span class="p">:</span><span class="nb">float</span><span class="o">|</span><span class="nb">list</span>
                         <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Method to create a POMDP model based on an olfactory environment object.</span>
<span class="sd">        # TODO: Implement different action sets</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        environment : Environment</span>
<span class="sd">            The olfactory environment object to create the POMDP model from.</span>
<span class="sd">        threshold : float or list</span>
<span class="sd">            A threshold for the odor cues.</span>
<span class="sd">            If a single is provided, the agent will smell something when an odor is above the threshold and nothing when it is bellow.</span>
<span class="sd">            If a list is provided, the agent will able to distinguish different levels of smell.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">state_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

        <span class="n">state_grid</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;s_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
        <span class="n">end_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">environment</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">environment</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">environment</span><span class="o">.</span><span class="n">source_radius</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                                                 <span class="n">shape</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

        <span class="c1"># Compute observation matrix</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="p">[</span><span class="n">threshold</span><span class="p">]</span>

        <span class="c1"># Ensure 0.0 and 1.0 begin and end the threshold list</span>
        <span class="k">if</span> <span class="n">threshold</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">+</span> <span class="n">threshold</span>

        <span class="k">if</span> <span class="n">threshold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
            <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>

        <span class="c1"># Computing odor probabilities</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">grid</span><span class="p">[:,:,:,</span><span class="kc">None</span><span class="p">]</span>
        <span class="n">threshs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
        <span class="n">odor_fields</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(((</span><span class="n">grid</span> <span class="o">&gt;=</span> <span class="n">threshs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">grid</span> <span class="o">&lt;</span> <span class="n">threshs</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:])),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># Building observation matrix</span>
        <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">state_count</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">threshold</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="c1"># 4-actions, observations: |thresholds|-1 + goal </span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">observations</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">odor_fields</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:,</span><span class="kc">None</span><span class="p">]</span>

        <span class="c1"># Goal observation</span>
        <span class="n">observations</span><span class="p">[:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">observations</span><span class="p">[</span><span class="n">end_states</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">observations</span><span class="p">[</span><span class="n">end_states</span><span class="p">,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="c1"># Observation labels</span>
        <span class="n">observation_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nothing&#39;</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">threshold</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
                <span class="n">observation_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;something_l</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">observation_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;something&#39;</span><span class="p">)</span>
        <span class="n">observation_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;goal&#39;</span><span class="p">)</span>

        <span class="c1"># Compute reachable states</span>
        <span class="n">row_w</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

        <span class="n">reachable_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">state_count</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">state_count</span><span class="p">):</span>
            <span class="n">reachable_states</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">row_w</span> <span class="k">if</span> <span class="n">s</span> <span class="o">-</span> <span class="n">row_w</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">state_count</span> <span class="o">-</span> <span class="n">row_w</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span> <span class="c1"># North</span>
            <span class="n">reachable_states</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">row_w</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">s</span> <span class="c1"># East</span>
            <span class="n">reachable_states</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">row_w</span> <span class="k">if</span> <span class="n">s</span> <span class="o">+</span> <span class="n">row_w</span> <span class="o">&lt;</span> <span class="n">state_count</span> <span class="k">else</span> <span class="n">s</span> <span class="o">%</span> <span class="n">row_w</span> <span class="c1"># South</span>
            <span class="n">reachable_states</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">row_w</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">row_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">s</span> <span class="c1"># West</span>

        <span class="n">reachable_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reachable_states</span><span class="p">)</span>

        <span class="c1"># Instantiate the model object</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span>
            <span class="n">states</span><span class="o">=</span><span class="n">state_grid</span><span class="p">,</span>
            <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;W&#39;</span><span class="p">],</span>
            <span class="n">observations</span><span class="o">=</span><span class="n">observation_labels</span><span class="p">,</span>
            <span class="n">reachable_states</span><span class="o">=</span><span class="n">reachable_states</span><span class="p">,</span>
            <span class="n">observation_table</span><span class="o">=</span><span class="n">observations</span><span class="p">,</span>
            <span class="n">end_states</span><span class="o">=</span><span class="n">end_states</span><span class="p">,</span>
            <span class="n">start_probabilities</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">start_probabilities</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span>


    <span class="k">def</span> <span class="nf">_end_reward_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">sn</span><span class="p">,</span> <span class="n">o</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The default reward function.</span>
<span class="sd">        Returns 1 if the next state sn is in the end states or if the action is in the end actions (terminating actions)</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">sn</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_states</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">end_actions</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">s_p</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns the rewards of playing action a when in state s and landing in state s_p.</span>
<span class="sd">        If the rewards are probabilistic, it will return 0 or 1.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s : int</span>
<span class="sd">            The current state.</span>
<span class="sd">        a : int</span>
<span class="sd">            The action taking in state s.</span>
<span class="sd">        s_p : int</span>
<span class="sd">            The state landing in after taking action a in state s</span>
<span class="sd">        o : int</span>
<span class="sd">            The observation that is done after having played action a in state s and landing in s_p</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        reward : int or float</span>
<span class="sd">            The reward received.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">reward</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_table</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">s_p</span><span class="p">,</span><span class="n">o</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_function</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">s_p</span><span class="p">,</span><span class="n">o</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards_are_probabilistic</span><span class="p">:</span>
            <span class="n">rnd</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">rnd</span> <span class="o">&lt;</span> <span class="n">reward</span> <span class="k">else</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">reward</span>


    <span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_p</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a random observation knowing action a is taken from state s, it is weighted by the observation probabilities.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        s_p : int</span>
<span class="sd">            The state landed on after having done action a.</span>
<span class="sd">        a : int</span>
<span class="sd">            The action to take.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        o : int</span>
<span class="sd">            A random observation.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_on_gpu</span> <span class="k">else</span> <span class="n">np</span>
        <span class="n">o</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_table</span><span class="p">[</span><span class="n">s_p</span><span class="p">,</span><span class="n">a</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">o</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="src.agents.model_based_util.pomdp.Model.from_environment" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">from_environment</span><span class="p">(</span><span class="n">environment</span><span class="p">,</span> <span class="n">threshold</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Method to create a POMDP model based on an olfactory environment object.</p>
<h4 id="src.agents.model_based_util.pomdp.Model.from_environment--todo-implement-different-action-sets">TODO: Implement different action sets</h4>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>environment</code></td>
          <td>
                <code><a class="autorefs autorefs-internal" title="src.Environment" href="../../../environment/#src.environment.Environment">Environment</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The olfactory environment object to create the POMDP model from.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>threshold</code></td>
          <td>
                <code>float or list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A threshold for the odor cues.
If a single is provided, the agent will smell something when an odor is above the threshold and nothing when it is bellow.
If a list is provided, the agent will able to distinguish different levels of smell.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src\agents\model_based_util\pomdp.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_environment</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
                     <span class="n">environment</span><span class="p">:</span><span class="n">Environment</span><span class="p">,</span>
                     <span class="n">threshold</span><span class="p">:</span><span class="nb">float</span><span class="o">|</span><span class="nb">list</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Model&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Method to create a POMDP model based on an olfactory environment object.</span>
<span class="sd">    # TODO: Implement different action sets</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    environment : Environment</span>
<span class="sd">        The olfactory environment object to create the POMDP model from.</span>
<span class="sd">    threshold : float or list</span>
<span class="sd">        A threshold for the odor cues.</span>
<span class="sd">        If a single is provided, the agent will smell something when an odor is above the threshold and nothing when it is bellow.</span>
<span class="sd">        If a list is provided, the agent will able to distinguish different levels of smell.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">state_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="n">state_grid</span> <span class="o">=</span> <span class="p">[[</span><span class="sa">f</span><span class="s1">&#39;s_</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">y</span><span class="si">}</span><span class="s1">&#39;</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])]</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">environment</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])]</span>
    <span class="n">end_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argwhere</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">:</span> <span class="p">((</span><span class="n">x</span><span class="o">-</span><span class="n">environment</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">y</span><span class="o">-</span><span class="n">environment</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">environment</span><span class="o">.</span><span class="n">source_radius</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span>
                                             <span class="n">shape</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">())[:,</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="c1"># Compute observation matrix</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="p">[</span><span class="n">threshold</span><span class="p">]</span>

    <span class="c1"># Ensure 0.0 and 1.0 begin and end the threshold list</span>
    <span class="k">if</span> <span class="n">threshold</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span> <span class="o">+</span> <span class="n">threshold</span>

    <span class="k">if</span> <span class="n">threshold</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">!=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">:</span>
        <span class="n">threshold</span> <span class="o">=</span> <span class="n">threshold</span> <span class="o">+</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">]</span>

    <span class="c1"># Computing odor probabilities</span>
    <span class="n">grid</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">grid</span><span class="p">[:,:,:,</span><span class="kc">None</span><span class="p">]</span>
    <span class="n">threshs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span>
    <span class="n">odor_fields</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">average</span><span class="p">(((</span><span class="n">grid</span> <span class="o">&gt;=</span> <span class="n">threshs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">grid</span> <span class="o">&lt;</span> <span class="n">threshs</span><span class="p">[</span><span class="mi">1</span><span class="p">:][</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span><span class="p">,:])),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Building observation matrix</span>
    <span class="n">observations</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">state_count</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">threshold</span><span class="p">)),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span> <span class="c1"># 4-actions, observations: |thresholds|-1 + goal </span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">observations</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">odor_fields</span><span class="p">[:,:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">ravel</span><span class="p">()[:,</span><span class="kc">None</span><span class="p">]</span>

    <span class="c1"># Goal observation</span>
    <span class="n">observations</span><span class="p">[:,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">observations</span><span class="p">[</span><span class="n">end_states</span><span class="p">,:,:]</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">observations</span><span class="p">[</span><span class="n">end_states</span><span class="p">,:,</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

    <span class="c1"># Observation labels</span>
    <span class="n">observation_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;nothing&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">threshold</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">_</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">threshold</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">observation_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;something_l</span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">observation_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;something&#39;</span><span class="p">)</span>
    <span class="n">observation_labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;goal&#39;</span><span class="p">)</span>

    <span class="c1"># Compute reachable states</span>
    <span class="n">row_w</span> <span class="o">=</span> <span class="n">environment</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">reachable_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">state_count</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">state_count</span><span class="p">):</span>
        <span class="n">reachable_states</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="n">row_w</span> <span class="k">if</span> <span class="n">s</span> <span class="o">-</span> <span class="n">row_w</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="p">(</span><span class="n">state_count</span> <span class="o">-</span> <span class="n">row_w</span><span class="p">)</span> <span class="o">+</span> <span class="n">s</span> <span class="c1"># North</span>
        <span class="n">reachable_states</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">row_w</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">s</span> <span class="c1"># East</span>
        <span class="n">reachable_states</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">+</span> <span class="n">row_w</span> <span class="k">if</span> <span class="n">s</span> <span class="o">+</span> <span class="n">row_w</span> <span class="o">&lt;</span> <span class="n">state_count</span> <span class="k">else</span> <span class="n">s</span> <span class="o">%</span> <span class="n">row_w</span> <span class="c1"># South</span>
        <span class="n">reachable_states</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s</span> <span class="o">-</span> <span class="mi">1</span> <span class="k">if</span> <span class="p">(</span><span class="n">s</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">%</span> <span class="n">row_w</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">row_w</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">s</span> <span class="c1"># West</span>

    <span class="n">reachable_states</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reachable_states</span><span class="p">)</span>

    <span class="c1"># Instantiate the model object</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">(</span>
        <span class="n">states</span><span class="o">=</span><span class="n">state_grid</span><span class="p">,</span>
        <span class="n">actions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span><span class="s1">&#39;E&#39;</span><span class="p">,</span><span class="s1">&#39;S&#39;</span><span class="p">,</span><span class="s1">&#39;W&#39;</span><span class="p">],</span>
        <span class="n">observations</span><span class="o">=</span><span class="n">observation_labels</span><span class="p">,</span>
        <span class="n">reachable_states</span><span class="o">=</span><span class="n">reachable_states</span><span class="p">,</span>
        <span class="n">observation_table</span><span class="o">=</span><span class="n">observations</span><span class="p">,</span>
        <span class="n">end_states</span><span class="o">=</span><span class="n">end_states</span><span class="p">,</span>
        <span class="n">start_probabilities</span><span class="o">=</span><span class="n">environment</span><span class="o">.</span><span class="n">start_probabilities</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.agents.model_based_util.pomdp.Model.observe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">observe</span><span class="p">(</span><span class="n">s_p</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a random observation knowing action a is taken from state s, it is weighted by the observation probabilities.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>s_p</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The state landed on after having done action a.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>a</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The action to take.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>o</code></td>          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A random observation.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src\agents\model_based_util\pomdp.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">observe</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s_p</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a random observation knowing action a is taken from state s, it is weighted by the observation probabilities.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s_p : int</span>
<span class="sd">        The state landed on after having done action a.</span>
<span class="sd">    a : int</span>
<span class="sd">        The action to take.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    o : int</span>
<span class="sd">        A random observation.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_on_gpu</span> <span class="k">else</span> <span class="n">np</span>
    <span class="n">o</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observations</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">observation_table</span><span class="p">[</span><span class="n">s_p</span><span class="p">,</span><span class="n">a</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">o</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.agents.model_based_util.pomdp.Model.reward" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">reward</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">s_p</span><span class="p">,</span> <span class="n">o</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns the rewards of playing action a when in state s and landing in state s_p.
If the rewards are probabilistic, it will return 0 or 1.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>s</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The current state.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>a</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The action taking in state s.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>s_p</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The state landing in after taking action a in state s</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>o</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The observation that is done after having played action a in state s and landing in s_p</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>reward</code></td>          <td>
                <code>int or float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The reward received.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src\agents\model_based_util\pomdp.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">reward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">a</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">s_p</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">o</span><span class="p">:</span><span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span><span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns the rewards of playing action a when in state s and landing in state s_p.</span>
<span class="sd">    If the rewards are probabilistic, it will return 0 or 1.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    s : int</span>
<span class="sd">        The current state.</span>
<span class="sd">    a : int</span>
<span class="sd">        The action taking in state s.</span>
<span class="sd">    s_p : int</span>
<span class="sd">        The state landing in after taking action a in state s</span>
<span class="sd">    o : int</span>
<span class="sd">        The observation that is done after having played action a in state s and landing in s_p</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    reward : int or float</span>
<span class="sd">        The reward received.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">reward</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_table</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">s_p</span><span class="p">,</span><span class="n">o</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_table</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">immediate_reward_function</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">a</span><span class="p">,</span><span class="n">s_p</span><span class="p">,</span><span class="n">o</span><span class="p">))</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">rewards_are_probabilistic</span><span class="p">:</span>
        <span class="n">rnd</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">rnd</span> <span class="o">&lt;</span> <span class="n">reward</span> <span class="k">else</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">reward</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": [], "search": "../../../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.5cfa9459.min.js"></script>
      
    
  </body>
</html>