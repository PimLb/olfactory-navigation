
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../build_environment_gui/">
      
      
        <link rel="next" href="../simulation/">
      
      
      <link rel="icon" href="../../img/squid_drawing.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.22">
    
    
      
        <title>environment - Olfactory Navigation Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.732c4fb1.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#olfactory_navigation.environment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Olfactory Navigation Documentation" class="md-header__button md-logo" aria-label="Olfactory Navigation Documentation" data-md-component="logo">
      
  <img src="../../img/squid_drawing.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Olfactory Navigation Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              environment
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="green"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/PimLb/olfactory-navigation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
  Code Reference

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../agent_creation/" class="md-tabs__link">
          
  
  Tutorials

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Olfactory Navigation Documentation" class="md-nav__button md-logo" aria-label="Olfactory Navigation Documentation" data-md-component="logo">
      
  <img src="../../img/squid_drawing.png" alt="logo">

    </a>
    Olfactory Navigation Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/PimLb/olfactory-navigation" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  <span class="md-ellipsis">
    Code Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Code Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    olfactory_navigation
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2_1">
            <span class="md-nav__icon md-icon"></span>
            olfactory_navigation
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../agents/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    agents
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2">
            <span class="md-nav__icon md-icon"></span>
            agents
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/fsvi_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fsvi_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/hsvi_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    hsvi_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/infotaxis_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    infotaxis_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2_1_2_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../agents/model_based_util/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    model_based_util
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_1_2_4" id="__nav_2_1_2_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="4" aria-labelledby="__nav_2_1_2_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_1_2_4">
            <span class="md-nav__icon md-icon"></span>
            model_based_util
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/model_based_util/belief/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    belief
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/model_based_util/belief_value_mapping/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    belief_value_mapping
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/model_based_util/environment_converter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    environment_converter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/model_based_util/mdp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mdp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/model_based_util/pomdp/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pomdp
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/model_based_util/value_function/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    value_function
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/model_based_util/vi_solver/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vi_solver
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/pbvi_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pbvi_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/pbvi_ger_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pbvi_ger_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/pbvi_ra_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pbvi_ra_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/pbvi_ssea_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pbvi_ssea_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/pbvi_ssga_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pbvi_ssga_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/pbvi_ssra_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pbvi_ssra_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/perseus_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    perseus_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/q_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    q_agent
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../agents/qmdp_agent/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    qmdp_agent
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../build_environment_gui/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    build_environment_gui
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    environment
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    environment
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#olfactory_navigation.environment" class="md-nav__link">
    <span class="md-ellipsis">
      environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.data" class="md-nav__link">
    <span class="md-ellipsis">
      data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.distance_to_source" class="md-nav__link">
    <span class="md-ellipsis">
      distance_to_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.get_observation" class="md-nav__link">
    <span class="md-ellipsis">
      get_observation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.modify" class="md-nav__link">
    <span class="md-ellipsis">
      modify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.modify_scale" class="md-nav__link">
    <span class="md-ellipsis">
      modify_scale
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.move" class="md-nav__link">
    <span class="md-ellipsis">
      move
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.random_start_points" class="md-nav__link">
    <span class="md-ellipsis">
      random_start_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.source_reached" class="md-nav__link">
    <span class="md-ellipsis">
      source_reached
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.to_cpu" class="md-nav__link">
    <span class="md-ellipsis">
      to_cpu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.to_gpu" class="md-nav__link">
    <span class="md-ellipsis">
      to_gpu
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../simulation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    simulation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../test_setups/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    test_setups
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../visualization/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    visualization
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../agent_creation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Create an Agent?
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#olfactory_navigation.environment" class="md-nav__link">
    <span class="md-ellipsis">
      environment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment" class="md-nav__link">
    <span class="md-ellipsis">
      Environment
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Environment">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.data" class="md-nav__link">
    <span class="md-ellipsis">
      data
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.distance_to_source" class="md-nav__link">
    <span class="md-ellipsis">
      distance_to_source
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.get_observation" class="md-nav__link">
    <span class="md-ellipsis">
      get_observation
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.load" class="md-nav__link">
    <span class="md-ellipsis">
      load
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.modify" class="md-nav__link">
    <span class="md-ellipsis">
      modify
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.modify_scale" class="md-nav__link">
    <span class="md-ellipsis">
      modify_scale
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.move" class="md-nav__link">
    <span class="md-ellipsis">
      move
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.plot" class="md-nav__link">
    <span class="md-ellipsis">
      plot
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.random_start_points" class="md-nav__link">
    <span class="md-ellipsis">
      random_start_points
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.save" class="md-nav__link">
    <span class="md-ellipsis">
      save
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.source_reached" class="md-nav__link">
    <span class="md-ellipsis">
      source_reached
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.to_cpu" class="md-nav__link">
    <span class="md-ellipsis">
      to_cpu
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#olfactory_navigation.environment.Environment.to_gpu" class="md-nav__link">
    <span class="md-ellipsis">
      to_gpu
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


  <h1>environment</h1>

<div class="doc doc-object doc-module">



<a id="olfactory_navigation.environment"></a>
  <div class="doc doc-contents first">

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="olfactory_navigation.environment.Environment" class="doc doc-heading">
          <code>Environment</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Class to represent an olfactory environment.</p>
<p>It is defined based on an olfactory data set provided as either a numpy file or an array directly with shape time, y, x.
From this environment, the various parameters are applied in the following order:</p>
<ol>
<li>The source position is set</li>
<li>The margins are added and the shape (total size) of the environment are set. </li>
<li>The data file's x and y components are squished and streched the to fit the inter-marginal shape of the environment.</li>
<li>The source's position is also moved to stay at the same position within the data.</li>
<li>The multiplier is finally applied to modify the data file's x and y components a final time by growing or shrinking the margins to account for the multiplier. (The multiplication applies with the source position as a center point)</li>
</ol>
<p>Note: to modify the shape of the data file's x and y components the OpenCV library's resize function is used. And the interpolation method is controlled by the interpolation_method parameter. </p>
<p>Then, the starting probability map is built. Either an array can be provided directly or preset option can be chosen:</p>
<ul>
<li>'data_zone': The agent can start at any point in the data_zone (after all the modification parameters have been applied)</li>
<li>'odor_present': The agent can start at any point where an odor cue above the odor_present_threshold can be found at any timestep during the simulation</li>
</ul>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>data_file</code></td>
          <td>
                <code>str or <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The dataset containing the olfactory data. It can be provided as a path to a file containing said array.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>data_source_position</code></td>
          <td>
                <code>list or <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The center point of the source provided as a list or a 1D array with the components being x,y.
This position is computed in the olfactory data zone (so excluding the margins).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>source_radius</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The radius from the center point of the source in which we consider the agent has reached the source.</p>
            </div>
          </td>
          <td>
                <code>1.0</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>layers</code></td>
          <td>
                <code>bool or list[int] or list[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether or not the data provided contains layers or not.
If a list of strings is provided, it will be either used to name the layers found (if numpy data), or it is used to querry the datasets of the h5 file.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>shape</code></td>
          <td>
                <code>list or <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 2-element array or list of how many units should be kept in the final array (including the margins).
As it should include the margins, the shape should be strictly larger than the sum of the margins in each direction.
By default, the shape of the olfactory data will be maintained.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>margins</code></td>
          <td>
                <code>int or list or <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>How many units have to be added to the data as margins. (Before the multiplier is applied)
If a unique element is provided, the margin will be this same value on each side.
If a list or array of 2 elements is provided, the first number will be vertical margins (y-axis), while the other will be on the x-axis (horizontal).</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>multiplier</code></td>
          <td>
                <code>list or <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 2-element array or list of how much the odor field should be streched in each direction.
If a value larger than 1 is provided, the margins will be reduced to accomodate for the larger size of the olfactory data size.
And inversly, less than 1 will increase the margins.
By default, the multipliers will be set to 1.0.</p>
            </div>
          </td>
          <td>
                <code>[1.0,1.0]</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>interpolation_method</code></td>
          <td>
                <code>Nearest or Linear or Cubic</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The interpolation method to be used in the case the data needs to be reshaped to fit the shape, margins and multiplier parameters.
By default, it uses Bi-linear interpolation. The interpolation is performed using the OpenCV library.</p>
            </div>
          </td>
          <td>
                <code>&#39;Linear&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>preprocess_data</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Applicable only for data_file being a path to a h5 file.
Whether to reshape of the data at the creation of the environment.
Reshaping the data ahead of time will require more processing at the creation and more memory overall.
While if this is disabled, when gathering observations, more time will be required but less memory will need to be used at once.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>boundary_condition</code></td>
          <td>
                <code>stop or wrap or wrap_vertical or wrap_horizontal or clip</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>How the agent should behave at the boundary.
Stop means for the agent to stop at the boundary, if the agent tries to move north while being on the top edge, it will stay in the same state.
Wrap means for the borders to be like portals, when entering on one side, it reappears on the other side.
Wrap can be specified to be only vertically or horizontally</p>
            </div>
          </td>
          <td>
                <code>&#39;stop&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>start_zone</code></td>
          <td>
                <code>odor_present or data_zone or <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Either an array or a string representing how the starting probabilities should be constructed.
- odor_present: The start probabilities will be uniform where odor cues can be found above 0 (or a given odor_present_threshold)
- data_zone: Uniform over the data zone, so without the margins.
Note that the points within the source radius will be excluded from this probability grid.</p>
            </div>
          </td>
          <td>
                <code>&#39;data_zone&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>odor_present_threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An olfactory threshold, under which the odor is considered too low to be noticed.
It is used only to build the starting zone if the 'odor_present' option is selected.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A custom name to be given to the agent.
If it is not provided, by default it will have the format:
<shape>-marg_<margins>-edge_<boundary_condition>-start_<start_zone>-source_<source_point>_radius<source_radius></p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>seed</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>For reproducible randomness.</p>
            </div>
          </td>
          <td>
                <code>12131415</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Attributes:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code><a class="autorefs autorefs-internal" title="olfactory_navigation.environment.Environment.data" href="#olfactory_navigation.environment.Environment.data">data</a></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An array containing the olfactory data after the modification parameters have been applied.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.data_file_path">data_file_path</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the data is loaded from a path, the path will be recorded here.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.data_source_position">data_source_position</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The position of the source in the original data file (after modifications have been applied).</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.layers">layers</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A numbered list of the IDs of the layers.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.layer_labels">layer_labels</span></code></td>
          <td>
                <code>list[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of how the layers are named.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.has_layers">has_layers</span></code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether or not the environment is made up of layers.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.margins">margins</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An array of the margins vertically and horizontally (after multiplier is applied).</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.timestamps">timestamps</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The amount of timeslices available in the environment.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.data_shape">data_shape</span></code></td>
          <td>
                <code>tuple[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The shape of the data's odor field (after modifications have been applied).</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.dimensions">dimensions</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The amount of dimensions of the physical space of the olfactory environment.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.shape">shape</span></code></td>
          <td>
                <code>tuple[int]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The shape of the environment. It is a tuple of the size in each axis of the environment.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.data_bounds">data_bounds</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The bounds between which the original olfactory data stands in the coordinate system of the environment (after modifications have been applied).</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.source_position">source_position</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The position of the source in the padded grid (after modifications have been applied).</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.source_radius">source_radius</span></code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The radius of the source.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.interpolation_method">interpolation_method</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The interpolation used to modify the shape of the original data.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.data_processed">data_processed</span></code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether the data was processed (ie the shape is at it should be) or not.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.boundary_condition">boundary_condition</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>How the agent should behave when reaching the boundary.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.start_probabilities">start_probabilities</span></code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A probability map of where the agent is likely to start within the environment.
Note: Zero within the source radius.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.start_type">start_type</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of the start probability map building. For instance: 'data_zone', 'odor_present', or 'custom' (if an array is provided).</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.odor_present_threshold">odor_present_threshold</span></code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The threshold used to uild the start probabilities if the option 'odor_present' is used.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.name">name</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name set to the agent as defined in the parameters.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.saved_at">saved_at</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If the environment is saved, the path at which it is saved will be recorded here.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.on_gpu">on_gpu</span></code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether the environment's arrays are on the gpu's memory or not.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.seed">seed</span></code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The seed used for the random operations (to allow for reproducability).</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="olfactory_navigation.environment.Environment.rnd_state">rnd_state</span></code></td>
          <td>
                <code><span title="numpy.random.RandomState">RandomState</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The random state variable used to generate random values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  41</span>
<span class="normal">  42</span>
<span class="normal">  43</span>
<span class="normal">  44</span>
<span class="normal">  45</span>
<span class="normal">  46</span>
<span class="normal">  47</span>
<span class="normal">  48</span>
<span class="normal">  49</span>
<span class="normal">  50</span>
<span class="normal">  51</span>
<span class="normal">  52</span>
<span class="normal">  53</span>
<span class="normal">  54</span>
<span class="normal">  55</span>
<span class="normal">  56</span>
<span class="normal">  57</span>
<span class="normal">  58</span>
<span class="normal">  59</span>
<span class="normal">  60</span>
<span class="normal">  61</span>
<span class="normal">  62</span>
<span class="normal">  63</span>
<span class="normal">  64</span>
<span class="normal">  65</span>
<span class="normal">  66</span>
<span class="normal">  67</span>
<span class="normal">  68</span>
<span class="normal">  69</span>
<span class="normal">  70</span>
<span class="normal">  71</span>
<span class="normal">  72</span>
<span class="normal">  73</span>
<span class="normal">  74</span>
<span class="normal">  75</span>
<span class="normal">  76</span>
<span class="normal">  77</span>
<span class="normal">  78</span>
<span class="normal">  79</span>
<span class="normal">  80</span>
<span class="normal">  81</span>
<span class="normal">  82</span>
<span class="normal">  83</span>
<span class="normal">  84</span>
<span class="normal">  85</span>
<span class="normal">  86</span>
<span class="normal">  87</span>
<span class="normal">  88</span>
<span class="normal">  89</span>
<span class="normal">  90</span>
<span class="normal">  91</span>
<span class="normal">  92</span>
<span class="normal">  93</span>
<span class="normal">  94</span>
<span class="normal">  95</span>
<span class="normal">  96</span>
<span class="normal">  97</span>
<span class="normal">  98</span>
<span class="normal">  99</span>
<span class="normal"> 100</span>
<span class="normal"> 101</span>
<span class="normal"> 102</span>
<span class="normal"> 103</span>
<span class="normal"> 104</span>
<span class="normal"> 105</span>
<span class="normal"> 106</span>
<span class="normal"> 107</span>
<span class="normal"> 108</span>
<span class="normal"> 109</span>
<span class="normal"> 110</span>
<span class="normal"> 111</span>
<span class="normal"> 112</span>
<span class="normal"> 113</span>
<span class="normal"> 114</span>
<span class="normal"> 115</span>
<span class="normal"> 116</span>
<span class="normal"> 117</span>
<span class="normal"> 118</span>
<span class="normal"> 119</span>
<span class="normal"> 120</span>
<span class="normal"> 121</span>
<span class="normal"> 122</span>
<span class="normal"> 123</span>
<span class="normal"> 124</span>
<span class="normal"> 125</span>
<span class="normal"> 126</span>
<span class="normal"> 127</span>
<span class="normal"> 128</span>
<span class="normal"> 129</span>
<span class="normal"> 130</span>
<span class="normal"> 131</span>
<span class="normal"> 132</span>
<span class="normal"> 133</span>
<span class="normal"> 134</span>
<span class="normal"> 135</span>
<span class="normal"> 136</span>
<span class="normal"> 137</span>
<span class="normal"> 138</span>
<span class="normal"> 139</span>
<span class="normal"> 140</span>
<span class="normal"> 141</span>
<span class="normal"> 142</span>
<span class="normal"> 143</span>
<span class="normal"> 144</span>
<span class="normal"> 145</span>
<span class="normal"> 146</span>
<span class="normal"> 147</span>
<span class="normal"> 148</span>
<span class="normal"> 149</span>
<span class="normal"> 150</span>
<span class="normal"> 151</span>
<span class="normal"> 152</span>
<span class="normal"> 153</span>
<span class="normal"> 154</span>
<span class="normal"> 155</span>
<span class="normal"> 156</span>
<span class="normal"> 157</span>
<span class="normal"> 158</span>
<span class="normal"> 159</span>
<span class="normal"> 160</span>
<span class="normal"> 161</span>
<span class="normal"> 162</span>
<span class="normal"> 163</span>
<span class="normal"> 164</span>
<span class="normal"> 165</span>
<span class="normal"> 166</span>
<span class="normal"> 167</span>
<span class="normal"> 168</span>
<span class="normal"> 169</span>
<span class="normal"> 170</span>
<span class="normal"> 171</span>
<span class="normal"> 172</span>
<span class="normal"> 173</span>
<span class="normal"> 174</span>
<span class="normal"> 175</span>
<span class="normal"> 176</span>
<span class="normal"> 177</span>
<span class="normal"> 178</span>
<span class="normal"> 179</span>
<span class="normal"> 180</span>
<span class="normal"> 181</span>
<span class="normal"> 182</span>
<span class="normal"> 183</span>
<span class="normal"> 184</span>
<span class="normal"> 185</span>
<span class="normal"> 186</span>
<span class="normal"> 187</span>
<span class="normal"> 188</span>
<span class="normal"> 189</span>
<span class="normal"> 190</span>
<span class="normal"> 191</span>
<span class="normal"> 192</span>
<span class="normal"> 193</span>
<span class="normal"> 194</span>
<span class="normal"> 195</span>
<span class="normal"> 196</span>
<span class="normal"> 197</span>
<span class="normal"> 198</span>
<span class="normal"> 199</span>
<span class="normal"> 200</span>
<span class="normal"> 201</span>
<span class="normal"> 202</span>
<span class="normal"> 203</span>
<span class="normal"> 204</span>
<span class="normal"> 205</span>
<span class="normal"> 206</span>
<span class="normal"> 207</span>
<span class="normal"> 208</span>
<span class="normal"> 209</span>
<span class="normal"> 210</span>
<span class="normal"> 211</span>
<span class="normal"> 212</span>
<span class="normal"> 213</span>
<span class="normal"> 214</span>
<span class="normal"> 215</span>
<span class="normal"> 216</span>
<span class="normal"> 217</span>
<span class="normal"> 218</span>
<span class="normal"> 219</span>
<span class="normal"> 220</span>
<span class="normal"> 221</span>
<span class="normal"> 222</span>
<span class="normal"> 223</span>
<span class="normal"> 224</span>
<span class="normal"> 225</span>
<span class="normal"> 226</span>
<span class="normal"> 227</span>
<span class="normal"> 228</span>
<span class="normal"> 229</span>
<span class="normal"> 230</span>
<span class="normal"> 231</span>
<span class="normal"> 232</span>
<span class="normal"> 233</span>
<span class="normal"> 234</span>
<span class="normal"> 235</span>
<span class="normal"> 236</span>
<span class="normal"> 237</span>
<span class="normal"> 238</span>
<span class="normal"> 239</span>
<span class="normal"> 240</span>
<span class="normal"> 241</span>
<span class="normal"> 242</span>
<span class="normal"> 243</span>
<span class="normal"> 244</span>
<span class="normal"> 245</span>
<span class="normal"> 246</span>
<span class="normal"> 247</span>
<span class="normal"> 248</span>
<span class="normal"> 249</span>
<span class="normal"> 250</span>
<span class="normal"> 251</span>
<span class="normal"> 252</span>
<span class="normal"> 253</span>
<span class="normal"> 254</span>
<span class="normal"> 255</span>
<span class="normal"> 256</span>
<span class="normal"> 257</span>
<span class="normal"> 258</span>
<span class="normal"> 259</span>
<span class="normal"> 260</span>
<span class="normal"> 261</span>
<span class="normal"> 262</span>
<span class="normal"> 263</span>
<span class="normal"> 264</span>
<span class="normal"> 265</span>
<span class="normal"> 266</span>
<span class="normal"> 267</span>
<span class="normal"> 268</span>
<span class="normal"> 269</span>
<span class="normal"> 270</span>
<span class="normal"> 271</span>
<span class="normal"> 272</span>
<span class="normal"> 273</span>
<span class="normal"> 274</span>
<span class="normal"> 275</span>
<span class="normal"> 276</span>
<span class="normal"> 277</span>
<span class="normal"> 278</span>
<span class="normal"> 279</span>
<span class="normal"> 280</span>
<span class="normal"> 281</span>
<span class="normal"> 282</span>
<span class="normal"> 283</span>
<span class="normal"> 284</span>
<span class="normal"> 285</span>
<span class="normal"> 286</span>
<span class="normal"> 287</span>
<span class="normal"> 288</span>
<span class="normal"> 289</span>
<span class="normal"> 290</span>
<span class="normal"> 291</span>
<span class="normal"> 292</span>
<span class="normal"> 293</span>
<span class="normal"> 294</span>
<span class="normal"> 295</span>
<span class="normal"> 296</span>
<span class="normal"> 297</span>
<span class="normal"> 298</span>
<span class="normal"> 299</span>
<span class="normal"> 300</span>
<span class="normal"> 301</span>
<span class="normal"> 302</span>
<span class="normal"> 303</span>
<span class="normal"> 304</span>
<span class="normal"> 305</span>
<span class="normal"> 306</span>
<span class="normal"> 307</span>
<span class="normal"> 308</span>
<span class="normal"> 309</span>
<span class="normal"> 310</span>
<span class="normal"> 311</span>
<span class="normal"> 312</span>
<span class="normal"> 313</span>
<span class="normal"> 314</span>
<span class="normal"> 315</span>
<span class="normal"> 316</span>
<span class="normal"> 317</span>
<span class="normal"> 318</span>
<span class="normal"> 319</span>
<span class="normal"> 320</span>
<span class="normal"> 321</span>
<span class="normal"> 322</span>
<span class="normal"> 323</span>
<span class="normal"> 324</span>
<span class="normal"> 325</span>
<span class="normal"> 326</span>
<span class="normal"> 327</span>
<span class="normal"> 328</span>
<span class="normal"> 329</span>
<span class="normal"> 330</span>
<span class="normal"> 331</span>
<span class="normal"> 332</span>
<span class="normal"> 333</span>
<span class="normal"> 334</span>
<span class="normal"> 335</span>
<span class="normal"> 336</span>
<span class="normal"> 337</span>
<span class="normal"> 338</span>
<span class="normal"> 339</span>
<span class="normal"> 340</span>
<span class="normal"> 341</span>
<span class="normal"> 342</span>
<span class="normal"> 343</span>
<span class="normal"> 344</span>
<span class="normal"> 345</span>
<span class="normal"> 346</span>
<span class="normal"> 347</span>
<span class="normal"> 348</span>
<span class="normal"> 349</span>
<span class="normal"> 350</span>
<span class="normal"> 351</span>
<span class="normal"> 352</span>
<span class="normal"> 353</span>
<span class="normal"> 354</span>
<span class="normal"> 355</span>
<span class="normal"> 356</span>
<span class="normal"> 357</span>
<span class="normal"> 358</span>
<span class="normal"> 359</span>
<span class="normal"> 360</span>
<span class="normal"> 361</span>
<span class="normal"> 362</span>
<span class="normal"> 363</span>
<span class="normal"> 364</span>
<span class="normal"> 365</span>
<span class="normal"> 366</span>
<span class="normal"> 367</span>
<span class="normal"> 368</span>
<span class="normal"> 369</span>
<span class="normal"> 370</span>
<span class="normal"> 371</span>
<span class="normal"> 372</span>
<span class="normal"> 373</span>
<span class="normal"> 374</span>
<span class="normal"> 375</span>
<span class="normal"> 376</span>
<span class="normal"> 377</span>
<span class="normal"> 378</span>
<span class="normal"> 379</span>
<span class="normal"> 380</span>
<span class="normal"> 381</span>
<span class="normal"> 382</span>
<span class="normal"> 383</span>
<span class="normal"> 384</span>
<span class="normal"> 385</span>
<span class="normal"> 386</span>
<span class="normal"> 387</span>
<span class="normal"> 388</span>
<span class="normal"> 389</span>
<span class="normal"> 390</span>
<span class="normal"> 391</span>
<span class="normal"> 392</span>
<span class="normal"> 393</span>
<span class="normal"> 394</span>
<span class="normal"> 395</span>
<span class="normal"> 396</span>
<span class="normal"> 397</span>
<span class="normal"> 398</span>
<span class="normal"> 399</span>
<span class="normal"> 400</span>
<span class="normal"> 401</span>
<span class="normal"> 402</span>
<span class="normal"> 403</span>
<span class="normal"> 404</span>
<span class="normal"> 405</span>
<span class="normal"> 406</span>
<span class="normal"> 407</span>
<span class="normal"> 408</span>
<span class="normal"> 409</span>
<span class="normal"> 410</span>
<span class="normal"> 411</span>
<span class="normal"> 412</span>
<span class="normal"> 413</span>
<span class="normal"> 414</span>
<span class="normal"> 415</span>
<span class="normal"> 416</span>
<span class="normal"> 417</span>
<span class="normal"> 418</span>
<span class="normal"> 419</span>
<span class="normal"> 420</span>
<span class="normal"> 421</span>
<span class="normal"> 422</span>
<span class="normal"> 423</span>
<span class="normal"> 424</span>
<span class="normal"> 425</span>
<span class="normal"> 426</span>
<span class="normal"> 427</span>
<span class="normal"> 428</span>
<span class="normal"> 429</span>
<span class="normal"> 430</span>
<span class="normal"> 431</span>
<span class="normal"> 432</span>
<span class="normal"> 433</span>
<span class="normal"> 434</span>
<span class="normal"> 435</span>
<span class="normal"> 436</span>
<span class="normal"> 437</span>
<span class="normal"> 438</span>
<span class="normal"> 439</span>
<span class="normal"> 440</span>
<span class="normal"> 441</span>
<span class="normal"> 442</span>
<span class="normal"> 443</span>
<span class="normal"> 444</span>
<span class="normal"> 445</span>
<span class="normal"> 446</span>
<span class="normal"> 447</span>
<span class="normal"> 448</span>
<span class="normal"> 449</span>
<span class="normal"> 450</span>
<span class="normal"> 451</span>
<span class="normal"> 452</span>
<span class="normal"> 453</span>
<span class="normal"> 454</span>
<span class="normal"> 455</span>
<span class="normal"> 456</span>
<span class="normal"> 457</span>
<span class="normal"> 458</span>
<span class="normal"> 459</span>
<span class="normal"> 460</span>
<span class="normal"> 461</span>
<span class="normal"> 462</span>
<span class="normal"> 463</span>
<span class="normal"> 464</span>
<span class="normal"> 465</span>
<span class="normal"> 466</span>
<span class="normal"> 467</span>
<span class="normal"> 468</span>
<span class="normal"> 469</span>
<span class="normal"> 470</span>
<span class="normal"> 471</span>
<span class="normal"> 472</span>
<span class="normal"> 473</span>
<span class="normal"> 474</span>
<span class="normal"> 475</span>
<span class="normal"> 476</span>
<span class="normal"> 477</span>
<span class="normal"> 478</span>
<span class="normal"> 479</span>
<span class="normal"> 480</span>
<span class="normal"> 481</span>
<span class="normal"> 482</span>
<span class="normal"> 483</span>
<span class="normal"> 484</span>
<span class="normal"> 485</span>
<span class="normal"> 486</span>
<span class="normal"> 487</span>
<span class="normal"> 488</span>
<span class="normal"> 489</span>
<span class="normal"> 490</span>
<span class="normal"> 491</span>
<span class="normal"> 492</span>
<span class="normal"> 493</span>
<span class="normal"> 494</span>
<span class="normal"> 495</span>
<span class="normal"> 496</span>
<span class="normal"> 497</span>
<span class="normal"> 498</span>
<span class="normal"> 499</span>
<span class="normal"> 500</span>
<span class="normal"> 501</span>
<span class="normal"> 502</span>
<span class="normal"> 503</span>
<span class="normal"> 504</span>
<span class="normal"> 505</span>
<span class="normal"> 506</span>
<span class="normal"> 507</span>
<span class="normal"> 508</span>
<span class="normal"> 509</span>
<span class="normal"> 510</span>
<span class="normal"> 511</span>
<span class="normal"> 512</span>
<span class="normal"> 513</span>
<span class="normal"> 514</span>
<span class="normal"> 515</span>
<span class="normal"> 516</span>
<span class="normal"> 517</span>
<span class="normal"> 518</span>
<span class="normal"> 519</span>
<span class="normal"> 520</span>
<span class="normal"> 521</span>
<span class="normal"> 522</span>
<span class="normal"> 523</span>
<span class="normal"> 524</span>
<span class="normal"> 525</span>
<span class="normal"> 526</span>
<span class="normal"> 527</span>
<span class="normal"> 528</span>
<span class="normal"> 529</span>
<span class="normal"> 530</span>
<span class="normal"> 531</span>
<span class="normal"> 532</span>
<span class="normal"> 533</span>
<span class="normal"> 534</span>
<span class="normal"> 535</span>
<span class="normal"> 536</span>
<span class="normal"> 537</span>
<span class="normal"> 538</span>
<span class="normal"> 539</span>
<span class="normal"> 540</span>
<span class="normal"> 541</span>
<span class="normal"> 542</span>
<span class="normal"> 543</span>
<span class="normal"> 544</span>
<span class="normal"> 545</span>
<span class="normal"> 546</span>
<span class="normal"> 547</span>
<span class="normal"> 548</span>
<span class="normal"> 549</span>
<span class="normal"> 550</span>
<span class="normal"> 551</span>
<span class="normal"> 552</span>
<span class="normal"> 553</span>
<span class="normal"> 554</span>
<span class="normal"> 555</span>
<span class="normal"> 556</span>
<span class="normal"> 557</span>
<span class="normal"> 558</span>
<span class="normal"> 559</span>
<span class="normal"> 560</span>
<span class="normal"> 561</span>
<span class="normal"> 562</span>
<span class="normal"> 563</span>
<span class="normal"> 564</span>
<span class="normal"> 565</span>
<span class="normal"> 566</span>
<span class="normal"> 567</span>
<span class="normal"> 568</span>
<span class="normal"> 569</span>
<span class="normal"> 570</span>
<span class="normal"> 571</span>
<span class="normal"> 572</span>
<span class="normal"> 573</span>
<span class="normal"> 574</span>
<span class="normal"> 575</span>
<span class="normal"> 576</span>
<span class="normal"> 577</span>
<span class="normal"> 578</span>
<span class="normal"> 579</span>
<span class="normal"> 580</span>
<span class="normal"> 581</span>
<span class="normal"> 582</span>
<span class="normal"> 583</span>
<span class="normal"> 584</span>
<span class="normal"> 585</span>
<span class="normal"> 586</span>
<span class="normal"> 587</span>
<span class="normal"> 588</span>
<span class="normal"> 589</span>
<span class="normal"> 590</span>
<span class="normal"> 591</span>
<span class="normal"> 592</span>
<span class="normal"> 593</span>
<span class="normal"> 594</span>
<span class="normal"> 595</span>
<span class="normal"> 596</span>
<span class="normal"> 597</span>
<span class="normal"> 598</span>
<span class="normal"> 599</span>
<span class="normal"> 600</span>
<span class="normal"> 601</span>
<span class="normal"> 602</span>
<span class="normal"> 603</span>
<span class="normal"> 604</span>
<span class="normal"> 605</span>
<span class="normal"> 606</span>
<span class="normal"> 607</span>
<span class="normal"> 608</span>
<span class="normal"> 609</span>
<span class="normal"> 610</span>
<span class="normal"> 611</span>
<span class="normal"> 612</span>
<span class="normal"> 613</span>
<span class="normal"> 614</span>
<span class="normal"> 615</span>
<span class="normal"> 616</span>
<span class="normal"> 617</span>
<span class="normal"> 618</span>
<span class="normal"> 619</span>
<span class="normal"> 620</span>
<span class="normal"> 621</span>
<span class="normal"> 622</span>
<span class="normal"> 623</span>
<span class="normal"> 624</span>
<span class="normal"> 625</span>
<span class="normal"> 626</span>
<span class="normal"> 627</span>
<span class="normal"> 628</span>
<span class="normal"> 629</span>
<span class="normal"> 630</span>
<span class="normal"> 631</span>
<span class="normal"> 632</span>
<span class="normal"> 633</span>
<span class="normal"> 634</span>
<span class="normal"> 635</span>
<span class="normal"> 636</span>
<span class="normal"> 637</span>
<span class="normal"> 638</span>
<span class="normal"> 639</span>
<span class="normal"> 640</span>
<span class="normal"> 641</span>
<span class="normal"> 642</span>
<span class="normal"> 643</span>
<span class="normal"> 644</span>
<span class="normal"> 645</span>
<span class="normal"> 646</span>
<span class="normal"> 647</span>
<span class="normal"> 648</span>
<span class="normal"> 649</span>
<span class="normal"> 650</span>
<span class="normal"> 651</span>
<span class="normal"> 652</span>
<span class="normal"> 653</span>
<span class="normal"> 654</span>
<span class="normal"> 655</span>
<span class="normal"> 656</span>
<span class="normal"> 657</span>
<span class="normal"> 658</span>
<span class="normal"> 659</span>
<span class="normal"> 660</span>
<span class="normal"> 661</span>
<span class="normal"> 662</span>
<span class="normal"> 663</span>
<span class="normal"> 664</span>
<span class="normal"> 665</span>
<span class="normal"> 666</span>
<span class="normal"> 667</span>
<span class="normal"> 668</span>
<span class="normal"> 669</span>
<span class="normal"> 670</span>
<span class="normal"> 671</span>
<span class="normal"> 672</span>
<span class="normal"> 673</span>
<span class="normal"> 674</span>
<span class="normal"> 675</span>
<span class="normal"> 676</span>
<span class="normal"> 677</span>
<span class="normal"> 678</span>
<span class="normal"> 679</span>
<span class="normal"> 680</span>
<span class="normal"> 681</span>
<span class="normal"> 682</span>
<span class="normal"> 683</span>
<span class="normal"> 684</span>
<span class="normal"> 685</span>
<span class="normal"> 686</span>
<span class="normal"> 687</span>
<span class="normal"> 688</span>
<span class="normal"> 689</span>
<span class="normal"> 690</span>
<span class="normal"> 691</span>
<span class="normal"> 692</span>
<span class="normal"> 693</span>
<span class="normal"> 694</span>
<span class="normal"> 695</span>
<span class="normal"> 696</span>
<span class="normal"> 697</span>
<span class="normal"> 698</span>
<span class="normal"> 699</span>
<span class="normal"> 700</span>
<span class="normal"> 701</span>
<span class="normal"> 702</span>
<span class="normal"> 703</span>
<span class="normal"> 704</span>
<span class="normal"> 705</span>
<span class="normal"> 706</span>
<span class="normal"> 707</span>
<span class="normal"> 708</span>
<span class="normal"> 709</span>
<span class="normal"> 710</span>
<span class="normal"> 711</span>
<span class="normal"> 712</span>
<span class="normal"> 713</span>
<span class="normal"> 714</span>
<span class="normal"> 715</span>
<span class="normal"> 716</span>
<span class="normal"> 717</span>
<span class="normal"> 718</span>
<span class="normal"> 719</span>
<span class="normal"> 720</span>
<span class="normal"> 721</span>
<span class="normal"> 722</span>
<span class="normal"> 723</span>
<span class="normal"> 724</span>
<span class="normal"> 725</span>
<span class="normal"> 726</span>
<span class="normal"> 727</span>
<span class="normal"> 728</span>
<span class="normal"> 729</span>
<span class="normal"> 730</span>
<span class="normal"> 731</span>
<span class="normal"> 732</span>
<span class="normal"> 733</span>
<span class="normal"> 734</span>
<span class="normal"> 735</span>
<span class="normal"> 736</span>
<span class="normal"> 737</span>
<span class="normal"> 738</span>
<span class="normal"> 739</span>
<span class="normal"> 740</span>
<span class="normal"> 741</span>
<span class="normal"> 742</span>
<span class="normal"> 743</span>
<span class="normal"> 744</span>
<span class="normal"> 745</span>
<span class="normal"> 746</span>
<span class="normal"> 747</span>
<span class="normal"> 748</span>
<span class="normal"> 749</span>
<span class="normal"> 750</span>
<span class="normal"> 751</span>
<span class="normal"> 752</span>
<span class="normal"> 753</span>
<span class="normal"> 754</span>
<span class="normal"> 755</span>
<span class="normal"> 756</span>
<span class="normal"> 757</span>
<span class="normal"> 758</span>
<span class="normal"> 759</span>
<span class="normal"> 760</span>
<span class="normal"> 761</span>
<span class="normal"> 762</span>
<span class="normal"> 763</span>
<span class="normal"> 764</span>
<span class="normal"> 765</span>
<span class="normal"> 766</span>
<span class="normal"> 767</span>
<span class="normal"> 768</span>
<span class="normal"> 769</span>
<span class="normal"> 770</span>
<span class="normal"> 771</span>
<span class="normal"> 772</span>
<span class="normal"> 773</span>
<span class="normal"> 774</span>
<span class="normal"> 775</span>
<span class="normal"> 776</span>
<span class="normal"> 777</span>
<span class="normal"> 778</span>
<span class="normal"> 779</span>
<span class="normal"> 780</span>
<span class="normal"> 781</span>
<span class="normal"> 782</span>
<span class="normal"> 783</span>
<span class="normal"> 784</span>
<span class="normal"> 785</span>
<span class="normal"> 786</span>
<span class="normal"> 787</span>
<span class="normal"> 788</span>
<span class="normal"> 789</span>
<span class="normal"> 790</span>
<span class="normal"> 791</span>
<span class="normal"> 792</span>
<span class="normal"> 793</span>
<span class="normal"> 794</span>
<span class="normal"> 795</span>
<span class="normal"> 796</span>
<span class="normal"> 797</span>
<span class="normal"> 798</span>
<span class="normal"> 799</span>
<span class="normal"> 800</span>
<span class="normal"> 801</span>
<span class="normal"> 802</span>
<span class="normal"> 803</span>
<span class="normal"> 804</span>
<span class="normal"> 805</span>
<span class="normal"> 806</span>
<span class="normal"> 807</span>
<span class="normal"> 808</span>
<span class="normal"> 809</span>
<span class="normal"> 810</span>
<span class="normal"> 811</span>
<span class="normal"> 812</span>
<span class="normal"> 813</span>
<span class="normal"> 814</span>
<span class="normal"> 815</span>
<span class="normal"> 816</span>
<span class="normal"> 817</span>
<span class="normal"> 818</span>
<span class="normal"> 819</span>
<span class="normal"> 820</span>
<span class="normal"> 821</span>
<span class="normal"> 822</span>
<span class="normal"> 823</span>
<span class="normal"> 824</span>
<span class="normal"> 825</span>
<span class="normal"> 826</span>
<span class="normal"> 827</span>
<span class="normal"> 828</span>
<span class="normal"> 829</span>
<span class="normal"> 830</span>
<span class="normal"> 831</span>
<span class="normal"> 832</span>
<span class="normal"> 833</span>
<span class="normal"> 834</span>
<span class="normal"> 835</span>
<span class="normal"> 836</span>
<span class="normal"> 837</span>
<span class="normal"> 838</span>
<span class="normal"> 839</span>
<span class="normal"> 840</span>
<span class="normal"> 841</span>
<span class="normal"> 842</span>
<span class="normal"> 843</span>
<span class="normal"> 844</span>
<span class="normal"> 845</span>
<span class="normal"> 846</span>
<span class="normal"> 847</span>
<span class="normal"> 848</span>
<span class="normal"> 849</span>
<span class="normal"> 850</span>
<span class="normal"> 851</span>
<span class="normal"> 852</span>
<span class="normal"> 853</span>
<span class="normal"> 854</span>
<span class="normal"> 855</span>
<span class="normal"> 856</span>
<span class="normal"> 857</span>
<span class="normal"> 858</span>
<span class="normal"> 859</span>
<span class="normal"> 860</span>
<span class="normal"> 861</span>
<span class="normal"> 862</span>
<span class="normal"> 863</span>
<span class="normal"> 864</span>
<span class="normal"> 865</span>
<span class="normal"> 866</span>
<span class="normal"> 867</span>
<span class="normal"> 868</span>
<span class="normal"> 869</span>
<span class="normal"> 870</span>
<span class="normal"> 871</span>
<span class="normal"> 872</span>
<span class="normal"> 873</span>
<span class="normal"> 874</span>
<span class="normal"> 875</span>
<span class="normal"> 876</span>
<span class="normal"> 877</span>
<span class="normal"> 878</span>
<span class="normal"> 879</span>
<span class="normal"> 880</span>
<span class="normal"> 881</span>
<span class="normal"> 882</span>
<span class="normal"> 883</span>
<span class="normal"> 884</span>
<span class="normal"> 885</span>
<span class="normal"> 886</span>
<span class="normal"> 887</span>
<span class="normal"> 888</span>
<span class="normal"> 889</span>
<span class="normal"> 890</span>
<span class="normal"> 891</span>
<span class="normal"> 892</span>
<span class="normal"> 893</span>
<span class="normal"> 894</span>
<span class="normal"> 895</span>
<span class="normal"> 896</span>
<span class="normal"> 897</span>
<span class="normal"> 898</span>
<span class="normal"> 899</span>
<span class="normal"> 900</span>
<span class="normal"> 901</span>
<span class="normal"> 902</span>
<span class="normal"> 903</span>
<span class="normal"> 904</span>
<span class="normal"> 905</span>
<span class="normal"> 906</span>
<span class="normal"> 907</span>
<span class="normal"> 908</span>
<span class="normal"> 909</span>
<span class="normal"> 910</span>
<span class="normal"> 911</span>
<span class="normal"> 912</span>
<span class="normal"> 913</span>
<span class="normal"> 914</span>
<span class="normal"> 915</span>
<span class="normal"> 916</span>
<span class="normal"> 917</span>
<span class="normal"> 918</span>
<span class="normal"> 919</span>
<span class="normal"> 920</span>
<span class="normal"> 921</span>
<span class="normal"> 922</span>
<span class="normal"> 923</span>
<span class="normal"> 924</span>
<span class="normal"> 925</span>
<span class="normal"> 926</span>
<span class="normal"> 927</span>
<span class="normal"> 928</span>
<span class="normal"> 929</span>
<span class="normal"> 930</span>
<span class="normal"> 931</span>
<span class="normal"> 932</span>
<span class="normal"> 933</span>
<span class="normal"> 934</span>
<span class="normal"> 935</span>
<span class="normal"> 936</span>
<span class="normal"> 937</span>
<span class="normal"> 938</span>
<span class="normal"> 939</span>
<span class="normal"> 940</span>
<span class="normal"> 941</span>
<span class="normal"> 942</span>
<span class="normal"> 943</span>
<span class="normal"> 944</span>
<span class="normal"> 945</span>
<span class="normal"> 946</span>
<span class="normal"> 947</span>
<span class="normal"> 948</span>
<span class="normal"> 949</span>
<span class="normal"> 950</span>
<span class="normal"> 951</span>
<span class="normal"> 952</span>
<span class="normal"> 953</span>
<span class="normal"> 954</span>
<span class="normal"> 955</span>
<span class="normal"> 956</span>
<span class="normal"> 957</span>
<span class="normal"> 958</span>
<span class="normal"> 959</span>
<span class="normal"> 960</span>
<span class="normal"> 961</span>
<span class="normal"> 962</span>
<span class="normal"> 963</span>
<span class="normal"> 964</span>
<span class="normal"> 965</span>
<span class="normal"> 966</span>
<span class="normal"> 967</span>
<span class="normal"> 968</span>
<span class="normal"> 969</span>
<span class="normal"> 970</span>
<span class="normal"> 971</span>
<span class="normal"> 972</span>
<span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Environment</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class to represent an olfactory environment.</span>

<span class="sd">    It is defined based on an olfactory data set provided as either a numpy file or an array directly with shape time, y, x.</span>
<span class="sd">    From this environment, the various parameters are applied in the following order:</span>

<span class="sd">    0. The source position is set</span>
<span class="sd">    1. The margins are added and the shape (total size) of the environment are set. </span>
<span class="sd">    2. The data file&#39;s x and y components are squished and streched the to fit the inter-marginal shape of the environment.</span>
<span class="sd">    3. The source&#39;s position is also moved to stay at the same position within the data.</span>
<span class="sd">    4. The multiplier is finally applied to modify the data file&#39;s x and y components a final time by growing or shrinking the margins to account for the multiplier. (The multiplication applies with the source position as a center point)</span>

<span class="sd">    Note: to modify the shape of the data file&#39;s x and y components the OpenCV library&#39;s resize function is used. And the interpolation method is controlled by the interpolation_method parameter. </span>


<span class="sd">    Then, the starting probability map is built. Either an array can be provided directly or preset option can be chosen:</span>

<span class="sd">    - &#39;data_zone&#39;: The agent can start at any point in the data_zone (after all the modification parameters have been applied)</span>
<span class="sd">    - &#39;odor_present&#39;: The agent can start at any point where an odor cue above the odor_present_threshold can be found at any timestep during the simulation</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_file : str or np.ndarray</span>
<span class="sd">        The dataset containing the olfactory data. It can be provided as a path to a file containing said array.</span>
<span class="sd">    data_source_position : list or np.ndarray</span>
<span class="sd">        The center point of the source provided as a list or a 1D array with the components being x,y.</span>
<span class="sd">        This position is computed in the olfactory data zone (so excluding the margins).</span>
<span class="sd">    source_radius : float, default=1.0</span>
<span class="sd">        The radius from the center point of the source in which we consider the agent has reached the source.</span>
<span class="sd">    layers : bool or list[int] or list[str], default=False</span>
<span class="sd">        Whether or not the data provided contains layers or not.</span>
<span class="sd">        If a list of strings is provided, it will be either used to name the layers found (if numpy data), or it is used to querry the datasets of the h5 file.</span>
<span class="sd">    shape : list or np.ndarray, optional</span>
<span class="sd">        A 2-element array or list of how many units should be kept in the final array (including the margins).</span>
<span class="sd">        As it should include the margins, the shape should be strictly larger than the sum of the margins in each direction.</span>
<span class="sd">        By default, the shape of the olfactory data will be maintained.</span>
<span class="sd">    margins : int or list or np.ndarray, default=0</span>
<span class="sd">        How many units have to be added to the data as margins. (Before the multiplier is applied)</span>
<span class="sd">        If a unique element is provided, the margin will be this same value on each side.</span>
<span class="sd">        If a list or array of 2 elements is provided, the first number will be vertical margins (y-axis), while the other will be on the x-axis (horizontal).</span>
<span class="sd">    multiplier : list or np.ndarray, default=[1.0,1.0]</span>
<span class="sd">        A 2-element array or list of how much the odor field should be streched in each direction.</span>
<span class="sd">        If a value larger than 1 is provided, the margins will be reduced to accomodate for the larger size of the olfactory data size.</span>
<span class="sd">        And inversly, less than 1 will increase the margins.</span>
<span class="sd">        By default, the multipliers will be set to 1.0.</span>
<span class="sd">    interpolation_method : &#39;Nearest&#39; or &#39;Linear&#39; or &#39;Cubic&#39;, default=&#39;Linear&#39;</span>
<span class="sd">        The interpolation method to be used in the case the data needs to be reshaped to fit the shape, margins and multiplier parameters.</span>
<span class="sd">        By default, it uses Bi-linear interpolation. The interpolation is performed using the OpenCV library.</span>
<span class="sd">    preprocess_data : bool, default=False</span>
<span class="sd">        Applicable only for data_file being a path to a h5 file.</span>
<span class="sd">        Whether to reshape of the data at the creation of the environment.</span>
<span class="sd">        Reshaping the data ahead of time will require more processing at the creation and more memory overall.</span>
<span class="sd">        While if this is disabled, when gathering observations, more time will be required but less memory will need to be used at once.</span>
<span class="sd">    boundary_condition : &#39;stop&#39; or &#39;wrap&#39; or &#39;wrap_vertical&#39; or &#39;wrap_horizontal&#39; or &#39;clip&#39;, default=&#39;stop&#39;</span>
<span class="sd">        How the agent should behave at the boundary.</span>
<span class="sd">        Stop means for the agent to stop at the boundary, if the agent tries to move north while being on the top edge, it will stay in the same state.</span>
<span class="sd">        Wrap means for the borders to be like portals, when entering on one side, it reappears on the other side.</span>
<span class="sd">        Wrap can be specified to be only vertically or horizontally</span>
<span class="sd">    start_zone : &#39;odor_present&#39; or &#39;data_zone&#39; or np.ndarray, default=&#39;data_zone&#39;</span>
<span class="sd">        Either an array or a string representing how the starting probabilities should be constructed.</span>
<span class="sd">        - odor_present: The start probabilities will be uniform where odor cues can be found above 0 (or a given odor_present_threshold)</span>
<span class="sd">        - data_zone: Uniform over the data zone, so without the margins.</span>
<span class="sd">        Note that the points within the source radius will be excluded from this probability grid.</span>
<span class="sd">    odor_present_threshold : float, optional</span>
<span class="sd">        An olfactory threshold, under which the odor is considered too low to be noticed.</span>
<span class="sd">        It is used only to build the starting zone if the &#39;odor_present&#39; option is selected.</span>
<span class="sd">    name : str, optional</span>
<span class="sd">        A custom name to be given to the agent.</span>
<span class="sd">        If it is not provided, by default it will have the format:</span>
<span class="sd">        &lt;shape&gt;-marg_&lt;margins&gt;-edge_&lt;boundary_condition&gt;-start_&lt;start_zone&gt;-source_&lt;source_point&gt;_radius&lt;source_radius&gt;</span>
<span class="sd">    seed : int, default=12131415</span>
<span class="sd">        For reproducible randomness.</span>

<span class="sd">    Attributes</span>
<span class="sd">    ----------</span>
<span class="sd">    data : np.ndarray</span>
<span class="sd">        An array containing the olfactory data after the modification parameters have been applied.</span>
<span class="sd">    data_file_path : str</span>
<span class="sd">        If the data is loaded from a path, the path will be recorded here.</span>
<span class="sd">    data_source_position : np.ndarray</span>
<span class="sd">        The position of the source in the original data file (after modifications have been applied).</span>
<span class="sd">    layers : np.ndarray</span>
<span class="sd">        A numbered list of the IDs of the layers.</span>
<span class="sd">    layer_labels : list[str]</span>
<span class="sd">        A list of how the layers are named.</span>
<span class="sd">    has_layers : bool</span>
<span class="sd">        Whether or not the environment is made up of layers.</span>
<span class="sd">    margins : np.ndarray</span>
<span class="sd">        An array of the margins vertically and horizontally (after multiplier is applied).</span>
<span class="sd">    timestamps : int</span>
<span class="sd">        The amount of timeslices available in the environment.</span>
<span class="sd">    data_shape : tuple[int]</span>
<span class="sd">        The shape of the data&#39;s odor field (after modifications have been applied).</span>
<span class="sd">    dimensions : int</span>
<span class="sd">        The amount of dimensions of the physical space of the olfactory environment.</span>
<span class="sd">    shape : tuple[int]</span>
<span class="sd">        The shape of the environment. It is a tuple of the size in each axis of the environment.</span>
<span class="sd">    data_bounds : np.ndarray</span>
<span class="sd">        The bounds between which the original olfactory data stands in the coordinate system of the environment (after modifications have been applied).</span>
<span class="sd">    source_position : np.ndarray</span>
<span class="sd">        The position of the source in the padded grid (after modifications have been applied).</span>
<span class="sd">    source_radius : float</span>
<span class="sd">        The radius of the source.</span>
<span class="sd">    interpolation_method : str</span>
<span class="sd">        The interpolation used to modify the shape of the original data.</span>
<span class="sd">    data_processed : bool</span>
<span class="sd">        Whether the data was processed (ie the shape is at it should be) or not.</span>
<span class="sd">    boundary_condition : str</span>
<span class="sd">        How the agent should behave when reaching the boundary.</span>
<span class="sd">    start_probabilities : np.ndarray</span>
<span class="sd">        A probability map of where the agent is likely to start within the environment.</span>
<span class="sd">        Note: Zero within the source radius.</span>
<span class="sd">    start_type : str</span>
<span class="sd">        The type of the start probability map building. For instance: &#39;data_zone&#39;, &#39;odor_present&#39;, or &#39;custom&#39; (if an array is provided).</span>
<span class="sd">    odor_present_threshold : float</span>
<span class="sd">        The threshold used to uild the start probabilities if the option &#39;odor_present&#39; is used.</span>
<span class="sd">    name : str</span>
<span class="sd">        The name set to the agent as defined in the parameters.</span>
<span class="sd">    saved_at : str</span>
<span class="sd">        If the environment is saved, the path at which it is saved will be recorded here.</span>
<span class="sd">    on_gpu : bool</span>
<span class="sd">        Whether the environment&#39;s arrays are on the gpu&#39;s memory or not.</span>
<span class="sd">    seed : int</span>
<span class="sd">        The seed used for the random operations (to allow for reproducability).</span>
<span class="sd">    rnd_state : np.random.RandomState</span>
<span class="sd">        The random state variable used to generate random values.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">data_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                 <span class="n">data_source_position</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                 <span class="n">source_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">layers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">shape</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">margins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                 <span class="n">multiplier</span><span class="p">:</span> <span class="nb">list</span><span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>
                 <span class="n">interpolation_method</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;Nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span> <span class="s1">&#39;Cubic&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Linear&#39;</span><span class="p">,</span>
                 <span class="n">preprocess_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                 <span class="n">boundary_condition</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;stop&#39;</span><span class="p">,</span> <span class="s1">&#39;wrap&#39;</span><span class="p">,</span> <span class="s1">&#39;wrap_vertical&#39;</span><span class="p">,</span> <span class="s1">&#39;wrap_horizontal&#39;</span><span class="p">,</span> <span class="s1">&#39;clip&#39;</span><span class="p">,</span> <span class="s1">&#39;no&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;stop&#39;</span><span class="p">,</span>
                 <span class="n">start_zone</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;odor_present&#39;</span><span class="p">,</span> <span class="s1">&#39;data_zone&#39;</span><span class="p">]</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="s1">&#39;data_zone&#39;</span><span class="p">,</span>
                 <span class="n">odor_present_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                 <span class="n">seed</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">12131415</span><span class="p">,</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_at</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># Layer properties</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">layers</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">layer</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">]</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layers</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="o">=</span> <span class="n">layers</span>

        <span class="c1"># Load from file if string provided</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">preprocess_data</span>

        <span class="n">loaded_data</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="o">=</span> <span class="n">data_file</span>

            <span class="c1"># NUMPY</span>
            <span class="k">if</span> <span class="n">data_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">):</span>
                <span class="n">loaded_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">data_file</span><span class="p">)</span>

                <span class="c1"># Layered data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span><span class="p">:</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loaded_data</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loaded_data</span><span class="p">))]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">assert</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">loaded_data</span><span class="p">)),</span> <span class="s2">&quot;The amount of layers provided dont match the amount in the dataset.&quot;</span>

                        <span class="c1"># Re-ordering the layers</span>
                        <span class="n">loaded_data</span> <span class="o">=</span> <span class="n">loaded_data</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">]</span>

            <span class="c1"># H5</span>
            <span class="k">elif</span> <span class="n">data_file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.h5&#39;</span><span class="p">):</span>
                <span class="n">loaded_data</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span><span class="s1">&#39;r&#39;</span><span class="p">)</span>

                <span class="c1"># Layered data</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span><span class="p">:</span>

                    <span class="c1"># Converting layers to strings</span>
                    <span class="n">data_layer_labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">loaded_data</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
                    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data_layer_labels</span><span class="p">))</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="o">=</span> <span class="n">data_layer_labels</span>

                    <span class="c1"># Getting the labels based on the list of integers provided</span>
                    <span class="k">elif</span> <span class="nb">all</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="n">layers</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="o">=</span> <span class="p">[</span><span class="n">data_layer_labels</span><span class="p">[</span><span class="n">layer_id</span><span class="p">]</span> <span class="k">for</span> <span class="n">layer_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">]</span>

                    <span class="c1"># Loading the list of slices from the data</span>
                    <span class="n">loaded_data</span> <span class="o">=</span> <span class="p">[[</span><span class="n">loaded_data</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loaded_data</span><span class="p">[</span><span class="n">layer</span><span class="p">]))]</span> <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span><span class="p">]</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="n">loaded_data</span> <span class="o">=</span> <span class="p">[</span><span class="n">loaded_data</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">loaded_data</span><span class="p">))]</span>

            <span class="c1"># Not supported</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;File format loading not implemented&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_file</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Data file should be either a path or an object that is either an h5 object or a numpy array&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="n">loaded_data</span> <span class="k">if</span> <span class="n">loaded_data</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">data_file</span>

        <span class="c1"># Unmodified sizes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_source_position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">original_data_source_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span>

        <span class="n">original_data_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span>

        <span class="c1"># Making margins a |dims|x2 array</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">margins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span> <span class="o">*</span> <span class="n">margins</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">margins</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">margins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">margins</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">margins</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,):</span> <span class="c1"># Symmetric min and max margins</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">margins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">margins</span><span class="p">[:,</span><span class="kc">None</span><span class="p">],</span> <span class="n">margins</span><span class="p">[:,</span><span class="kc">None</span><span class="p">]))</span>
            <span class="k">elif</span> <span class="n">margins</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">margins</span> <span class="o">=</span> <span class="n">margins</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;The array or lists of Margins provided have a shape not supported. (Supported formats (2,) or (2,2))&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;margins argument should be either an integer or a 1D or 2D array with either shape (2) or (2,2)&#39;</span><span class="p">)</span>
        <span class="k">assert</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">int</span><span class="p">),</span> <span class="s1">&#39;margins should be integers&#39;</span>

        <span class="c1"># Process shape parameter</span>
        <span class="n">new_data_shape</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">shape</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="s2">&quot;The shape of the environment must be strictly larger than the sum of margins.&quot;</span>

            <span class="c1"># Computing the new shape of the data</span>
            <span class="n">new_data_shape</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="c1"># New source position</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span> <span class="o">*</span> <span class="p">(</span><span class="n">new_data_shape</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">new_data_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">new_data_shape</span><span class="p">,)</span>

        <span class="c1"># Process multiplier</span>
        <span class="n">multiplier</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">multiplier</span><span class="p">)</span>

        <span class="c1"># Assert multiplier value is correct</span>
        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
            <span class="n">low_max_mult</span> <span class="o">=</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
            <span class="n">high_max_mult</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span><span class="p">)))</span>
            <span class="n">max_mult</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">low_max_mult</span><span class="p">,</span> <span class="n">high_max_mult</span><span class="p">]),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

            <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">multiplier</span> <span class="o">&lt;=</span> <span class="n">max_mult</span><span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;The multiplier given is larger than allowed (the values should be lower than </span><span class="si">{</span><span class="n">max_mult</span><span class="si">}</span><span class="s2">)&quot;</span>

        <span class="c1"># Compute new data shape with the multiplier</span>
        <span class="k">if</span> <span class="n">new_data_shape</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">new_data_shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span>
        <span class="n">new_data_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">new_data_shape</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># New source position based on multiplier</span>
        <span class="n">new_source_position</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span> <span class="o">*</span> <span class="n">multiplier</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="c1"># Recomputing margins with new source position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="p">(</span><span class="n">new_source_position</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">shape</span> <span class="o">-</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_data_shape</span><span class="p">))</span>

        <span class="c1"># Re-Setting new source position</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span> <span class="o">=</span> <span class="n">new_source_position</span>

        <span class="c1"># Interpolation method choice</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span> <span class="o">=</span> <span class="n">interpolation_method</span>

        <span class="c1"># Input the new shape of the data if set by custom shape or multiplier</span>
        <span class="k">if</span> <span class="n">new_data_shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">new_data_shape</span><span class="p">,)</span>

        <span class="c1"># Check if data is already processed by default</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">==</span> <span class="n">original_data_shape</span><span class="p">)</span>

        <span class="c1"># If requested process all the slices of data into a single</span>
        <span class="k">if</span> <span class="n">preprocess_data</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Higher dimensional data doesnt support reshaping yet, ensure it is done beforehand..&quot;</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span><span class="p">:</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                        <span class="n">new_data</span><span class="p">[</span><span class="n">layer</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
                                                           <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                                           <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                    <span class="n">new_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                                <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                                <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">new_data</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="c1"># Reading shape of data array</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),)</span>

        <span class="c1"># Converting the shape tuple to integer sets</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">int</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">])</span>

        <span class="c1"># Building a data bounds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>

        <span class="c1"># Saving arguments</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span> <span class="o">=</span> <span class="n">source_radius</span>

        <span class="c1"># Boundary conditions</span>
        <span class="k">assert</span> <span class="ow">not</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">boundary_condition</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;wrap_vertical&#39;</span><span class="p">,</span> <span class="s1">&#39;wrap_horizontal&#39;</span><span class="p">])),</span> <span class="s2">&quot;There are more than 2 dimensions, the options of &#39;wrap_horizontal&#39; and &#39;wrap_vertical&#39; are disabled.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span> <span class="o">=</span> <span class="n">boundary_condition</span>

        <span class="c1"># Starting zone</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_type</span> <span class="o">=</span> <span class="n">start_zone</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_zone</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span> <span class="k">else</span> <span class="s1">&#39;custom&#39;</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">start_zone</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">start_zone</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span><span class="p">,</span><span class="mi">2</span><span class="p">):</span>
                <span class="n">slices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="n">start_zone</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="p">[</span><span class="n">slices</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_type</span> <span class="o">+=</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">el</span><span class="p">)</span> <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">start_zone</span><span class="o">.</span><span class="n">ravel</span><span class="p">()])</span>
            <span class="k">elif</span> <span class="n">start_zone</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span> <span class="o">=</span> <span class="n">start_zone</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;If an np.ndarray is provided for the start_zone it has to be |dim| x 2...&#39;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">start_zone</span> <span class="o">==</span> <span class="s1">&#39;data_zone&#39;</span><span class="p">:</span>
            <span class="n">slices</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="p">[</span><span class="n">slices</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>

        <span class="k">elif</span> <span class="n">start_zone</span> <span class="o">==</span> <span class="s1">&#39;odor_present&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">odor_present_map</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">odor_present_threshold</span> <span class="k">if</span> <span class="n">odor_present_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">)]</span> <span class="o">=</span> <span class="n">odor_present_map</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">odor_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                    <span class="n">data_slice</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">])</span>
                    <span class="n">reshaped_data_slice</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">data_slice</span><span class="p">,</span>
                                                        <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                                        <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                    <span class="n">odor_sum</span> <span class="o">+=</span> <span class="p">(</span><span class="n">reshaped_data_slice</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">odor_present_threshold</span> <span class="k">if</span> <span class="n">odor_present_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">))</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span> <span class="k">for</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">)]</span> <span class="o">=</span> <span class="p">(</span><span class="n">odor_sum</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;start_zone value is wrong&#39;</span><span class="p">)</span>

        <span class="c1"># Odor present tresh</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span> <span class="o">=</span> <span class="n">odor_present_threshold</span>

        <span class="c1"># Removing the source area from the starting zone</span>
        <span class="n">source_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">fromfunction</span><span class="p">((</span><span class="k">lambda</span> <span class="o">*</span><span class="n">points</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">points</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">([</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">))]</span> <span class="o">+</span> <span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="kc">None</span><span class="p">,:])</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span><span class="o">**</span><span class="mi">2</span><span class="p">),</span> <span class="n">shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="p">[</span><span class="n">source_mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="p">)</span> <span class="c1"># Normalization</span>

        <span class="c1"># Name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span>  <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">axis_size</span><span class="p">)</span> <span class="k">for</span> <span class="n">axis_size</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">])</span> <span class="c1"># Size of env</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;-marg_&#39;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">marg</span><span class="p">)</span> <span class="k">for</span> <span class="n">marg</span> <span class="ow">in</span> <span class="n">dim_margins</span><span class="p">])</span> <span class="k">for</span> <span class="n">dim_margins</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">])</span> <span class="c1"># margins</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;-edge_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span><span class="si">}</span><span class="s1">&#39;</span> <span class="c1"># Boundary condition</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;-start_</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">start_type</span><span class="si">}</span><span class="s1">&#39;</span> <span class="c1"># Start zone</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+=</span> <span class="sa">f</span><span class="s1">&#39;-source_&#39;</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">pos</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">])</span> <span class="o">+</span> <span class="sa">f</span><span class="s1">&#39;_radius</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span><span class="si">}</span><span class="s1">&#39;</span> <span class="c1"># Source</span>

        <span class="c1"># gpu support</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># random state</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rnd_state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        The whole dataset with the right shape. If not preprocessed to modify its shape the data will be processed when querrying this object.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_is_numpy</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span><span class="p">:</span>
            <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;[Warning] The whole dataset is being querried, it will be reshaped at this time. To avoid this, avoid querrying environment.data directly.&#39;</span><span class="p">)</span>

            <span class="c1"># Reshaping</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span><span class="p">:</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">layer</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                        <span class="n">new_data</span><span class="p">[</span><span class="n">layer</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">i</span><span class="p">]),</span>
                                                           <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                                           <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">new_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">))</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">):</span>
                    <span class="n">new_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span>
                                                <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                                <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">new_data</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span> <span class="o">=</span> <span class="kc">True</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_data_is_numpy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Wheter or nor the data is a numpy array or not.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>
        <span class="k">return</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">xp</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
             <span class="n">layer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
             <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Simple function to plot the environment with a single frame of odor cues.</span>
<span class="sd">        The starting zone is also market down with a blue contour.</span>
<span class="sd">        The source of the odor is marked by a red circle.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        frame : int, default=0</span>
<span class="sd">            The frame of odor cues to print.</span>
<span class="sd">        layer : int, default=0</span>
<span class="sd">            The layer of the odor cues to print. (Ignored if the environment is not layered.)</span>
<span class="sd">        ax : plt.Axes, optional</span>
<span class="sd">            An ax on which the environment can be plot.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># If on GPU use the CPU version to plot</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
                <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span>
                <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="c1"># Blank return</span>

        <span class="c1"># TODO: Implement plotting for 3D</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Plotting function only available for 2D environments for now...&quot;</span>

        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

        <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[[],[]]</span>

        <span class="c1"># Gather data frame</span>
        <span class="n">data_frame</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">frame</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">data_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span><span class="p">:</span>
            <span class="n">data_frame</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span>
                                       <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                       <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="c1"># Odor grid</span>
        <span class="n">odor</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_frame</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">environment_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
        <span class="n">environment_frame</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">frame_data</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">environment_frame</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>

        <span class="n">legend_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">odor</span><span class="p">)</span>
        <span class="n">legend_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39; (layer </span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; odor cues&#39;</span><span class="p">)</span>

        <span class="c1"># Start zone contour</span>
        <span class="n">start_zone</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

        <span class="n">legend_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_zone</span><span class="p">)</span>
        <span class="n">legend_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Start zone&#39;</span><span class="p">)</span>

        <span class="c1"># Source circle</span>
        <span class="n">goal_circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
        <span class="n">legend_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goal_circle</span><span class="p">)</span>
        <span class="n">legend_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">goal_circle</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

        <span class="c1"># Legend</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">legend_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>


    <span class="k">def</span> <span class="nf">get_observation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">pos</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                        <span class="n">time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                        <span class="n">layer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="mi">0</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to get an observation at a given position on the grid at a given time.</span>
<span class="sd">        A set of observations can also be requested, either at a single position for multiple timestamps or with the same amoung of positions as timestamps provided.</span>

<span class="sd">        Note: The position will not be checked against boundary conditions; if a position is out-of-bounds it will simply return 0.0!</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pos : np.ndarray</span>
<span class="sd">            The position or list of positions to get observations at.</span>
<span class="sd">        time : int or np.ndarray, default=0</span>
<span class="sd">            A timestamp or list of timestamps to get the observations at.</span>
<span class="sd">        layer : int or np.ndarray, default=0</span>
<span class="sd">            A layer or list of timestamps to get the observations at.</span>
<span class="sd">            Note: If the environment doesnt have layers, this parameter will be ignored.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        observation : float or np.ndarray</span>
<span class="sd">            A single observation or list of observations.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>

        <span class="c1"># Handling the case of a single point</span>
        <span class="n">is_single_point</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_single_point</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>

        <span class="c1"># Counting how many position points we are dealing with</span>
        <span class="n">pos_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

        <span class="c1"># Time looping</span>
        <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span>

        <span class="c1"># Determine unique layers and reindexing them if needed</span>
        <span class="n">unique_layers</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">layer</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">xp</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
        <span class="n">layer</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">xp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">layer</span> <span class="o">==</span> <span class="n">unique_layers</span><span class="p">[:,</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">layer_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_layers</span><span class="p">)</span>

        <span class="c1"># Determine unique times and reindexing them if needed</span>
        <span class="n">unique_times</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">time</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">xp</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
        <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">xp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time</span> <span class="o">==</span> <span class="n">unique_times</span><span class="p">[:,</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">time_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">)</span>

        <span class="c1"># Handling the case where the data is a sequence of slices (h5, so not numpy array)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

        <span class="c1"># Selecting the required slices</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_is_numpy</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">unique_layers</span><span class="p">][:,</span><span class="n">unique_times</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="n">unique_times</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Case where we are dealing with a h5 file</span>
            <span class="c1"># Note: Can&#39;t use self.data_shape because we don&#39;t know whether the data is processed yet or no</span>
            <span class="n">selected_slices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">layer_count</span><span class="p">,</span> <span class="n">time_count</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">time_count</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_times</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_layers</span><span class="p">):</span>
                        <span class="n">selected_slices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">t</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">selected_slices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">selected_slices</span><span class="p">)</span>

        <span class="c1"># Handle the case it needs to be processed on the fly</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span><span class="p">:</span>
            <span class="n">reshaped_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">layer_count</span><span class="p">,</span> <span class="n">time_count</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">time_count</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">time_count</span><span class="p">):</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer_count</span><span class="p">):</span>
                        <span class="n">reshaped_data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">],</span>
                                                           <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                                           <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">reshaped_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                     <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                                     <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

            <span class="n">data</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reshaped_data</span><span class="p">)</span>

        <span class="c1"># Return 0.0 if outside of data zone</span>
        <span class="n">data_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="kc">None</span><span class="p">,:]</span>
        <span class="n">data_pos_valid</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data_pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_pos</span> <span class="o">&lt;</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">observation</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pos_count</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

        <span class="c1"># Gathering data on layered data on not</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span><span class="p">:</span>
            <span class="n">observation</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">layer</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">layer</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">]),</span> <span class="c1"># layer</span>
                                               <span class="p">(</span><span class="n">time</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">time</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">]),</span> <span class="c1"># t</span>
                                               <span class="o">*</span><span class="n">data_pos</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">]</span> <span class="c1"># physical position</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">observation</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">time</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">time</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">]),</span> <span class="c1"># t</span>
                                               <span class="o">*</span><span class="n">data_pos</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">]</span> <span class="c1"># physical position</span>

        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">observation</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">is_single_point</span> <span class="k">else</span> <span class="n">observation</span>


    <span class="k">def</span> <span class="nf">source_reached</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">pos</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks whether a given position is within the source radius.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pos : np.ndarray</span>
<span class="sd">            The position to check whether in the radius of the source.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        is_at_source : bool</span>
<span class="sd">            Whether or not the position is within the radius of the source.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>

        <span class="c1"># Handling the case of a single point</span>
        <span class="n">is_single_point</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_single_point</span><span class="p">:</span>
            <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>

        <span class="n">is_at_source</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pos</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="kc">None</span><span class="p">,:])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">is_at_source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">is_single_point</span> <span class="k">else</span> <span class="n">is_at_source</span>


    <span class="k">def</span> <span class="nf">random_start_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
                            <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to generate n starting positions following the starting probabilities.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        n : int, default=1</span>
<span class="sd">            How many random starting positions to generate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        random_states_2d : np.ndarray</span>
<span class="sd">            The n random 2d points in a n x 2 array. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>

        <span class="k">assert</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;n has to be a strictly positive number (&gt;0)&quot;</span>

        <span class="n">random_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">))),</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
        <span class="n">random_states_2d</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">random_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
        <span class="k">return</span> <span class="n">random_states_2d</span>


    <span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">pos</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
             <span class="n">movement</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Applies a movement vector to a position point and returns a new position point while respecting the boundary conditions.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        pos : np.ndarray</span>
<span class="sd">            The start position of the movement.</span>
<span class="sd">        movement : np.ndarray</span>
<span class="sd">            A 2D movement vector.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new_pos : np.ndarray</span>
<span class="sd">            The new position after applying the movement.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>

        <span class="c1"># Applying the movement vector</span>
        <span class="n">new_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">movement</span>

        <span class="c1"># Handling the case we are dealing with a single point.</span>
        <span class="n">is_single_point</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_single_point</span><span class="p">:</span>
            <span class="n">new_pos</span> <span class="o">=</span> <span class="n">new_pos</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>

        <span class="n">shape_array</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>

        <span class="c1"># Wrap boundary</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span> <span class="o">==</span> <span class="s1">&#39;wrap&#39;</span><span class="p">:</span>
            <span class="n">new_pos</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_pos</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">new_pos</span> <span class="o">+</span> <span class="n">shape_array</span><span class="p">),</span> <span class="n">new_pos</span><span class="p">)</span>
            <span class="n">new_pos</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_pos</span> <span class="o">&gt;=</span> <span class="n">shape_array</span><span class="p">,</span> <span class="p">(</span><span class="n">new_pos</span> <span class="o">-</span> <span class="n">shape_array</span><span class="p">),</span> <span class="n">new_pos</span><span class="p">)</span>

        <span class="c1"># Stop boundary</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span> <span class="o">==</span> <span class="s1">&#39;stop&#39;</span><span class="p">:</span>
            <span class="n">new_pos</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">new_pos</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">shape_array</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Special wrap - vertical only</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span> <span class="o">==</span> <span class="s1">&#39;wrap_vertical&#39;</span><span class="p">):</span>
            <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>

            <span class="n">new_pos</span><span class="p">[</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">height</span>
            <span class="n">new_pos</span><span class="p">[</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">height</span>

            <span class="n">new_pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Special wrap - horizontal only</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span> <span class="o">==</span> <span class="s1">&#39;wrap_horizontal&#39;</span><span class="p">):</span>
            <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>

            <span class="n">new_pos</span><span class="p">[</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">width</span>
            <span class="n">new_pos</span><span class="p">[</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">width</span>

            <span class="n">new_pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">height</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">new_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_single_point</span> <span class="k">else</span> <span class="n">new_pos</span>


    <span class="k">def</span> <span class="nf">distance_to_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                           <span class="n">point</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                           <span class="n">metric</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;manhattan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;manhattan&#39;</span>
                           <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to compute the distance(s) between given points and the source point.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        point : np.ndarray</span>
<span class="sd">            A single or an Nx2 array containing N points.</span>
<span class="sd">        metric : &#39;manhattan&#39;</span>
<span class="sd">            The metric to use to compute the distance.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        dist : float or np.ndarray</span>
<span class="sd">            A single distance or a list of distance in a 1D distance array.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>

        <span class="c1"># Handling the case we have a single point</span>
        <span class="n">is_single_point</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_single_point</span><span class="p">:</span>
            <span class="n">point</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>

        <span class="c1"># Computing dist</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;manhattan&#39;</span><span class="p">:</span>
            <span class="n">dist</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">point</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span>

        <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Meaning it was not computed</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This distance metric has not yet been implemented&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">is_single_point</span> <span class="k">else</span> <span class="n">dist</span>


    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
             <span class="n">save_arrays</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
             <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to save the environment to the memory.</span>

<span class="sd">        By default it saved in a new folder at the current path in a new folder with the name &#39;Env-&lt;name&gt;&#39; where &lt;name&gt; is the name set when initializing an environment.</span>
<span class="sd">        In this folder a file &quot;METADATA.json&quot; is created containing all the properties of the environment.</span>

<span class="sd">        The numpy arrays of the environment (grid and start_probabilities) can be saved or not. If not, when the environment is loaded it needs to be reconstructed from the original data file.</span>
<span class="sd">        The arrays are saved to .npy files along with the METADATA file.</span>

<span class="sd">        If an environment of the same name is already saved, the saving will be interupted. It can however be forced with the force parameter.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : str, optional</span>
<span class="sd">            The folder to which to save the environment data. If it is not provided, it will be created in the current folder.</span>
<span class="sd">        save_arrays : bool, default=False</span>
<span class="sd">            Whether or not to save the numpy arrays to memory. (The arrays can be heavy)</span>
<span class="sd">        force : bool, default=False</span>
<span class="sd">            In case an environment of the same name is already saved, it will be overwritten.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># If on gpu, use the cpu version to save</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
                <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
                <span class="n">save_arrays</span><span class="o">=</span><span class="n">save_arrays</span><span class="p">,</span>
                <span class="n">force</span><span class="o">=</span><span class="n">force</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="c1"># Blank return</span>

        <span class="c1"># Assert either data_file is provided or save_arrays is enabled</span>
        <span class="k">assert</span> <span class="n">save_arrays</span> <span class="ow">or</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)),</span> <span class="s2">&quot;The environment was not created from a data file so &#39;save_arrays&#39; has to be set to True.&quot;</span>

        <span class="c1"># Adding env name to folder path</span>
        <span class="k">if</span> <span class="n">folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./Env-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">folder</span> <span class="o">+=</span> <span class="s1">&#39;/Env-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="c1"># Checking the folder exists or creates it</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
                <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1"> is not empty. If you want to overwrite the saved model, enable &quot;force&quot;.&#39;</span><span class="p">)</span>

        <span class="c1"># Generating the metadata arguments dictionary</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_file_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span>

        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;timesteps&#39;</span><span class="p">]</span>                     <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_shape&#39;</span><span class="p">]</span>                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]</span>                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;margins&#39;</span><span class="p">]</span>                       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>                         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_bounds&#39;</span><span class="p">]</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;original_data_source_position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_data_source_position</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_source_position&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">]</span>                        <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;source_position&#39;</span><span class="p">]</span>               <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;source_radius&#39;</span><span class="p">]</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;interpolation_method&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;preprocess_data&#39;</span><span class="p">]</span>               <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_processed&#39;</span><span class="p">]</span>                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;boundary_condition&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;start_type&#39;</span><span class="p">]</span>                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_type</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>                          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>

        <span class="c1"># Check how the start probabilities were built</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;custom&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">save_arrays</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Start probabilities have been set from a custom array, please enable save_arrays to be able to reconstruct the environment later.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;odor_present_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span>

        <span class="c1"># Output the arguments to a METADATA file</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/METADATA.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

        <span class="c1"># Output the numpy arrays</span>
        <span class="k">if</span> <span class="n">save_arrays</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/data.npy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;The saving of data that is not a Numpy array was not implemented yet.&#39;</span><span class="p">)</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/start_probabilities.npy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="p">)</span>

        <span class="c1"># Success print</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">saved_at</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Environment saved to: </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
             <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span>
             <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Environment&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to load an environment from a given folder.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        folder : str</span>
<span class="sd">            The folder of the Environment.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        loaded_env : Environment</span>
<span class="sd">            The loaded environment.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">),</span> <span class="s2">&quot;Folder doesn&#39;t exist...&quot;</span>
        <span class="k">assert</span> <span class="n">folder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Env-&#39;</span><span class="p">),</span> <span class="s2">&quot;The folder provided is not the data of en Environment object.&quot;</span>

        <span class="c1"># Load arguments</span>
        <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/METADATA.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
            <span class="n">arguments</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

        <span class="c1"># Check if numpy arrays are provided, if not, recreate a new environment model</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/data.npy&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/start_probabilities.npy&#39;</span><span class="p">):</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/data.npy&#39;</span><span class="p">)</span>
            <span class="n">start_probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/start_probabilities.npy&#39;</span><span class="p">)</span>

            <span class="n">loaded_env</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

            <span class="c1"># Set the arguments</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">name</span>                          <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">timesteps</span>                     <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;timesteps&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">data_shape</span>                    <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_shape&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">dimensions</span>                    <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">margins</span>                       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;margins&#39;</span><span class="p">])</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">shape</span>                         <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">data_bounds</span>                   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_bounds&#39;</span><span class="p">])</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">original_data_source_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;original_data_source_position&#39;</span><span class="p">])</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">data_source_position</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_source_position&#39;</span><span class="p">])</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">source_position</span>               <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;source_position&#39;</span><span class="p">])</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">source_radius</span>                 <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;source_radius&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">has_layers</span>                    <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">layers</span>                        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">loaded_env</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="kc">None</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">layer_labels</span>                  <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">interpolation_method</span>          <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;interpolation_method&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">_preprocess_data</span>              <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;preprocess_data&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">data_processed</span>                <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_processed&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">boundary_condition</span>            <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;boundary_condition&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">on_gpu</span>                        <span class="o">=</span> <span class="kc">False</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">seed</span>                          <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">rnd_state</span>                     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>

            <span class="c1"># Optional arguments</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">data_file_path</span>                <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_file_path&#39;</span><span class="p">)</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">odor_present_threshold</span>        <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;odor_present_threshold&#39;</span><span class="p">)</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">start_type</span>                    <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start_type&#39;</span><span class="p">)</span>

            <span class="c1"># Arrays</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
            <span class="n">loaded_env</span><span class="o">.</span><span class="n">start_probabilities</span> <span class="o">=</span> <span class="n">start_probabilities</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="n">start_zone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;start_type&#39;</span><span class="p">]</span>
            <span class="n">start_zone_boundaries</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="k">if</span> <span class="n">start_zone</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;custom&#39;</span><span class="p">):</span>
                <span class="n">start_zone_boundaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">start_zone</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;dimensions&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

            <span class="n">loaded_env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
                <span class="n">data_file</span>              <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_file_path&#39;</span><span class="p">],</span>
                <span class="n">data_source_position</span>   <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;original_data_source_position&#39;</span><span class="p">],</span>
                <span class="n">source_radius</span>          <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;source_radius&#39;</span><span class="p">],</span>
                <span class="n">layers</span>                 <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">],</span>
                <span class="n">shape</span>                  <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">],</span>
                <span class="n">margins</span>                <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;margins&#39;</span><span class="p">],</span>
                <span class="n">interpolation_method</span>   <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;interpolation_method&#39;</span><span class="p">],</span>
                <span class="n">preprocess_data</span>        <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;preprocess_data&#39;</span><span class="p">],</span>
                <span class="n">boundary_condition</span>     <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;boundary_condition&#39;</span><span class="p">],</span>
                <span class="n">start_zone</span>             <span class="o">=</span> <span class="p">(</span><span class="n">start_zone_boundaries</span> <span class="k">if</span> <span class="n">start_zone_boundaries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start_zone</span><span class="p">),</span>
                <span class="n">odor_present_threshold</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;odor_present_threshold&#39;</span><span class="p">),</span>
                <span class="n">name</span>                   <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
                <span class="n">seed</span>                   <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>
            <span class="p">)</span>

        <span class="c1"># Folder where the environment was pulled from</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">saved_at</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">loaded_env</span>


    <span class="k">def</span> <span class="nf">to_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Environment&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to send the numpy arrays of the environment to the gpu memory.</span>
<span class="sd">        It returns a new instance of the Environment with the arrays as cupy arrays.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        gpu_environment : Environment</span>
<span class="sd">            A new environment instance where the arrays are on the gpu memory.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">assert</span> <span class="n">gpu_support</span><span class="p">,</span> <span class="s2">&quot;GPU support is not enabled...&quot;</span>

        <span class="c1"># Generating a new instance</span>
        <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
        <span class="n">gpu_environment</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Copying arguments to gpu</span>
        <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_environment</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
            <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;rnd_state&#39;</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_environment</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_environment</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

        <span class="c1"># Self reference instances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="n">gpu_environment</span>
        <span class="n">gpu_environment</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">gpu_environment</span><span class="o">.</span><span class="n">on_gpu</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="n">gpu_environment</span>


    <span class="k">def</span> <span class="nf">to_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Environment&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to send the numpy arrays of the environment to the cpu memory.</span>
<span class="sd">        It returns a new instance of the Environment with the arrays as numpy arrays.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        cpu_environment : Environment</span>
<span class="sd">            A new environment instance where the arrays are on the cpu memory.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Something went wrong&quot;</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span>

        <span class="k">return</span> <span class="bp">self</span>


    <span class="k">def</span> <span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
               <span class="n">data_source_position</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">source_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">shape</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">margins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">multiplier</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">interpolation_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
               <span class="n">boundary_condition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
               <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Environment&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Returns a copy of the environment with one or more parameters modified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        data_source_position: list or np.ndarray, optional</span>
<span class="sd">            A new position for the source relative to the data file.</span>
<span class="sd">        source_radius: float, optional</span>
<span class="sd">            A new source radius.</span>
<span class="sd">        shape: list or np.ndarray, optional</span>
<span class="sd">            A new shape of environment.</span>
<span class="sd">        margins: int or list or np.ndarray, optional</span>
<span class="sd">            A new set of margins.</span>
<span class="sd">        multiplier: list or np.ndarray, optional</span>
<span class="sd">            A new multiplier to be applied to the data file (this will in turn increase or reduce the margins).</span>
<span class="sd">        interpolation_method: str, optional</span>
<span class="sd">            A new interpolation method to be used.</span>
<span class="sd">        boundary_condition: str, optional</span>
<span class="sd">            New boundary conditions for how the agent should behave at the edges.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        modified_environment</span>
<span class="sd">            A copy of the environment where the modified parameters have been applied.</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">()</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span>
                <span class="n">data_source_position</span> <span class="o">=</span> <span class="n">data_source_position</span><span class="p">,</span>
                <span class="n">source_radius</span>        <span class="o">=</span> <span class="n">source_radius</span><span class="p">,</span>
                <span class="n">shape</span>                <span class="o">=</span> <span class="n">shape</span><span class="p">,</span>
                <span class="n">margins</span>              <span class="o">=</span> <span class="n">margins</span><span class="p">,</span>
                <span class="n">multiplier</span>           <span class="o">=</span> <span class="n">multiplier</span><span class="p">,</span>
                <span class="n">interpolation_method</span> <span class="o">=</span> <span class="n">interpolation_method</span><span class="p">,</span>
                <span class="n">boundary_condition</span>   <span class="o">=</span> <span class="n">boundary_condition</span>
            <span class="p">)</span>

        <span class="n">modified_environment</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
            <span class="n">data_file</span>              <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">),</span>
            <span class="n">data_source_position</span>   <span class="o">=</span> <span class="p">(</span><span class="n">data_source_position</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_source_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_data_source_position</span><span class="p">),</span>
            <span class="n">source_radius</span>          <span class="o">=</span> <span class="p">(</span><span class="n">source_radius</span> <span class="k">if</span> <span class="p">(</span><span class="n">source_radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span><span class="p">),</span>
            <span class="n">layers</span>                 <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">shape</span>                  <span class="o">=</span> <span class="p">(</span><span class="n">shape</span> <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
            <span class="n">margins</span>                <span class="o">=</span> <span class="p">(</span><span class="n">margins</span> <span class="k">if</span> <span class="p">(</span><span class="n">margins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">),</span>
            <span class="n">multiplier</span>             <span class="o">=</span> <span class="p">(</span><span class="n">multiplier</span> <span class="k">if</span> <span class="p">(</span><span class="n">multiplier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]),</span>
            <span class="n">interpolation_method</span>   <span class="o">=</span> <span class="p">(</span><span class="n">interpolation_method</span> <span class="k">if</span> <span class="p">(</span><span class="n">interpolation_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="p">),</span>
            <span class="n">preprocess_data</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span><span class="p">,</span>
            <span class="n">boundary_condition</span>     <span class="o">=</span> <span class="p">(</span><span class="n">boundary_condition</span> <span class="k">if</span> <span class="p">(</span><span class="n">boundary_condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span><span class="p">),</span>
            <span class="n">start_zone</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_type</span><span class="p">,</span>
            <span class="n">odor_present_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span><span class="p">,</span>
            <span class="n">name</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">seed</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">modified_environment</span>


    <span class="k">def</span> <span class="nf">modify_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span>
                     <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Environment&#39;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Function to modify the size of the environment by a scale factor.</span>
<span class="sd">        Everything will be scaled this factor. This includes: shape, margins, source radius, and data shape.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        scale_factor : float</span>
<span class="sd">            By how much to modify the size of the current environment.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        modified_environment : Environment</span>
<span class="sd">            The environment with the scale factor applied. </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">modified_source_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span> <span class="o">*</span> <span class="n">scale_factor</span>
        <span class="n">modified_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
        <span class="n">modified_margins</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">modified_environment</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
            <span class="n">data_file</span>              <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">),</span>
            <span class="n">data_source_position</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_data_source_position</span><span class="p">,</span>
            <span class="n">source_radius</span>          <span class="o">=</span> <span class="n">modified_source_radius</span><span class="p">,</span>
            <span class="n">layers</span>                 <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span>
            <span class="n">shape</span>                  <span class="o">=</span> <span class="n">modified_shape</span><span class="p">,</span>
            <span class="n">margins</span>                <span class="o">=</span> <span class="n">modified_margins</span><span class="p">,</span>
            <span class="n">multiplier</span>             <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span>
            <span class="n">interpolation_method</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="p">,</span>
            <span class="n">preprocess_data</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span><span class="p">,</span>
            <span class="n">boundary_condition</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span><span class="p">,</span>
            <span class="n">start_zone</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_type</span><span class="p">,</span>
            <span class="n">odor_present_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span><span class="p">,</span>
            <span class="n">name</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">seed</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">modified_environment</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">







<div class="doc doc-object doc-attribute">



<h3 id="olfactory_navigation.environment.Environment.data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-property"><code>property</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>The whole dataset with the right shape. If not preprocessed to modify its shape the data will be processed when querrying this object.</p>
  </div>

</div>




<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.distance_to_source" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">distance_to_source</span><span class="p">(</span><span class="n">point</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;manhattan&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to compute the distance(s) between given points and the source point.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>point</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A single or an Nx2 array containing N points.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>metric</code></td>
          <td>
                <code>manhattan</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The metric to use to compute the distance.</p>
            </div>
          </td>
          <td>
                <code>&#39;manhattan&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>dist</code></td>          <td>
                <code>float or <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A single distance or a list of distance in a 1D distance array.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">distance_to_source</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                       <span class="n">point</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                       <span class="n">metric</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;manhattan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;manhattan&#39;</span>
                       <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to compute the distance(s) between given points and the source point.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    point : np.ndarray</span>
<span class="sd">        A single or an Nx2 array containing N points.</span>
<span class="sd">    metric : &#39;manhattan&#39;</span>
<span class="sd">        The metric to use to compute the distance.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    dist : float or np.ndarray</span>
<span class="sd">        A single distance or a list of distance in a 1D distance array.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>

    <span class="c1"># Handling the case we have a single point</span>
    <span class="n">is_single_point</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_single_point</span><span class="p">:</span>
        <span class="n">point</span> <span class="o">=</span> <span class="n">point</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>

    <span class="c1"># Computing dist</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s1">&#39;manhattan&#39;</span><span class="p">:</span>
        <span class="n">dist</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">point</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span>

    <span class="k">if</span> <span class="n">dist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> <span class="c1"># Meaning it was not computed</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;This distance metric has not yet been implemented&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">dist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">is_single_point</span> <span class="k">else</span> <span class="n">dist</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.get_observation" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_observation</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">time</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to get an observation at a given position on the grid at a given time.
A set of observations can also be requested, either at a single position for multiple timestamps or with the same amoung of positions as timestamps provided.</p>
<p>Note: The position will not be checked against boundary conditions; if a position is out-of-bounds it will simply return 0.0!</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>pos</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The position or list of positions to get observations at.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>time</code></td>
          <td>
                <code>int or <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A timestamp or list of timestamps to get the observations at.</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>layer</code></td>
          <td>
                <code>int or <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A layer or list of timestamps to get the observations at.
Note: If the environment doesnt have layers, this parameter will be ignored.</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>observation</code></td>          <td>
                <code>float or <span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A single observation or list of observations.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span>
<span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_observation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                    <span class="n">pos</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
                    <span class="n">time</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
                    <span class="n">layer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="mi">0</span>
                    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to get an observation at a given position on the grid at a given time.</span>
<span class="sd">    A set of observations can also be requested, either at a single position for multiple timestamps or with the same amoung of positions as timestamps provided.</span>

<span class="sd">    Note: The position will not be checked against boundary conditions; if a position is out-of-bounds it will simply return 0.0!</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pos : np.ndarray</span>
<span class="sd">        The position or list of positions to get observations at.</span>
<span class="sd">    time : int or np.ndarray, default=0</span>
<span class="sd">        A timestamp or list of timestamps to get the observations at.</span>
<span class="sd">    layer : int or np.ndarray, default=0</span>
<span class="sd">        A layer or list of timestamps to get the observations at.</span>
<span class="sd">        Note: If the environment doesnt have layers, this parameter will be ignored.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    observation : float or np.ndarray</span>
<span class="sd">        A single observation or list of observations.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>

    <span class="c1"># Handling the case of a single point</span>
    <span class="n">is_single_point</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_single_point</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>

    <span class="c1"># Counting how many position points we are dealing with</span>
    <span class="n">pos_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span>

    <span class="c1"># Time looping</span>
    <span class="n">time</span> <span class="o">=</span> <span class="n">time</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span>

    <span class="c1"># Determine unique layers and reindexing them if needed</span>
    <span class="n">unique_layers</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">layer</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">xp</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">layer</span><span class="p">)</span>
    <span class="n">layer</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">xp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">layer</span> <span class="o">==</span> <span class="n">unique_layers</span><span class="p">[:,</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">layer_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_layers</span><span class="p">)</span>

    <span class="c1"># Determine unique times and reindexing them if needed</span>
    <span class="n">unique_times</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">time</span><span class="p">])</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">xp</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">time</span><span class="p">)</span>
    <span class="n">time</span> <span class="o">=</span> <span class="mi">0</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">xp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">time</span> <span class="o">==</span> <span class="n">unique_times</span><span class="p">[:,</span><span class="kc">None</span><span class="p">])[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">time_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">unique_times</span><span class="p">)</span>

    <span class="c1"># Handling the case where the data is a sequence of slices (h5, so not numpy array)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span>

    <span class="c1"># Selecting the required slices</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data_is_numpy</span><span class="p">:</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">unique_layers</span><span class="p">][:,</span><span class="n">unique_times</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="n">data</span><span class="p">[</span><span class="n">unique_times</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Case where we are dealing with a h5 file</span>
        <span class="c1"># Note: Can&#39;t use self.data_shape because we don&#39;t know whether the data is processed yet or no</span>
        <span class="n">selected_slices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">layer_count</span><span class="p">,</span> <span class="n">time_count</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">time_count</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_times</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">unique_layers</span><span class="p">):</span>
                    <span class="n">selected_slices</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">l</span><span class="p">][</span><span class="n">t</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">selected_slices</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">t</span><span class="p">])</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">selected_slices</span><span class="p">)</span>

    <span class="c1"># Handle the case it needs to be processed on the fly</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span><span class="p">:</span>
        <span class="n">reshaped_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">layer_count</span><span class="p">,</span> <span class="n">time_count</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">))</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">time_count</span><span class="p">,</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">time_count</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">layer_count</span><span class="p">):</span>
                    <span class="n">reshaped_data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">],</span>
                                                       <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                                       <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">reshaped_data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
                                                 <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                                 <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">reshaped_data</span><span class="p">)</span>

    <span class="c1"># Return 0.0 if outside of data zone</span>
    <span class="n">data_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">[:,</span><span class="mi">0</span><span class="p">][</span><span class="kc">None</span><span class="p">,:]</span>
    <span class="n">data_pos_valid</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">all</span><span class="p">((</span><span class="n">data_pos</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">data_pos</span> <span class="o">&lt;</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">observation</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">pos_count</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>

    <span class="c1"># Gathering data on layered data on not</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span><span class="p">:</span>
        <span class="n">observation</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">layer</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">layer</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">layer</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">]),</span> <span class="c1"># layer</span>
                                           <span class="p">(</span><span class="n">time</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">time</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">]),</span> <span class="c1"># t</span>
                                           <span class="o">*</span><span class="n">data_pos</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">]</span> <span class="c1"># physical position</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">observation</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[(</span><span class="n">time</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">else</span> <span class="n">time</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">]),</span> <span class="c1"># t</span>
                                           <span class="o">*</span><span class="n">data_pos</span><span class="p">[</span><span class="n">data_pos_valid</span><span class="p">,:]</span><span class="o">.</span><span class="n">T</span><span class="p">]</span> <span class="c1"># physical position</span>

    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">observation</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">is_single_point</span> <span class="k">else</span> <span class="n">observation</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.load" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">load</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to load an environment from a given folder.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>folder</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The folder of the Environment.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>loaded_env</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="olfactory_navigation.environment.Environment" href="#olfactory_navigation.environment.Environment">Environment</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The loaded environment.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span>
<span class="normal">984</span>
<span class="normal">985</span>
<span class="normal">986</span>
<span class="normal">987</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span>
         <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span>
         <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Environment&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to load an environment from a given folder.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    folder : str</span>
<span class="sd">        The folder of the Environment.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    loaded_env : Environment</span>
<span class="sd">        The loaded environment.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">),</span> <span class="s2">&quot;Folder doesn&#39;t exist...&quot;</span>
    <span class="k">assert</span> <span class="n">folder</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;Env-&#39;</span><span class="p">),</span> <span class="s2">&quot;The folder provided is not the data of en Environment object.&quot;</span>

    <span class="c1"># Load arguments</span>
    <span class="n">arguments</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/METADATA.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">arguments</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>

    <span class="c1"># Check if numpy arrays are provided, if not, recreate a new environment model</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/data.npy&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/start_probabilities.npy&#39;</span><span class="p">):</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/data.npy&#39;</span><span class="p">)</span>
        <span class="n">start_probabilities</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/start_probabilities.npy&#39;</span><span class="p">)</span>

        <span class="n">loaded_env</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

        <span class="c1"># Set the arguments</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">name</span>                          <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">timesteps</span>                     <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;timesteps&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">data_shape</span>                    <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_shape&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">dimensions</span>                    <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">margins</span>                       <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;margins&#39;</span><span class="p">])</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">shape</span>                         <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">data_bounds</span>                   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_bounds&#39;</span><span class="p">])</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">original_data_source_position</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;original_data_source_position&#39;</span><span class="p">])</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">data_source_position</span>          <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_source_position&#39;</span><span class="p">])</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">source_position</span>               <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;source_position&#39;</span><span class="p">])</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">source_radius</span>                 <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;source_radius&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">has_layers</span>                    <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">layers</span>                        <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">]))</span> <span class="k">if</span> <span class="n">loaded_env</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">layer_labels</span>                  <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">interpolation_method</span>          <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;interpolation_method&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">_preprocess_data</span>              <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;preprocess_data&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">data_processed</span>                <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_processed&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">boundary_condition</span>            <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;boundary_condition&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">on_gpu</span>                        <span class="o">=</span> <span class="kc">False</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">seed</span>                          <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">rnd_state</span>                     <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>

        <span class="c1"># Optional arguments</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">data_file_path</span>                <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;data_file_path&#39;</span><span class="p">)</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">odor_present_threshold</span>        <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;odor_present_threshold&#39;</span><span class="p">)</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">start_type</span>                    <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;start_type&#39;</span><span class="p">)</span>

        <span class="c1"># Arrays</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">_data</span> <span class="o">=</span> <span class="n">data</span>
        <span class="n">loaded_env</span><span class="o">.</span><span class="n">start_probabilities</span> <span class="o">=</span> <span class="n">start_probabilities</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">start_zone</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;start_type&#39;</span><span class="p">]</span>
        <span class="n">start_zone_boundaries</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">start_zone</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;custom&#39;</span><span class="p">):</span>
            <span class="n">start_zone_boundaries</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">start_zone</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:])</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;dimensions&#39;</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

        <span class="n">loaded_env</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
            <span class="n">data_file</span>              <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_file_path&#39;</span><span class="p">],</span>
            <span class="n">data_source_position</span>   <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;original_data_source_position&#39;</span><span class="p">],</span>
            <span class="n">source_radius</span>          <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;source_radius&#39;</span><span class="p">],</span>
            <span class="n">layers</span>                 <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">],</span>
            <span class="n">shape</span>                  <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">],</span>
            <span class="n">margins</span>                <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;margins&#39;</span><span class="p">],</span>
            <span class="n">interpolation_method</span>   <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;interpolation_method&#39;</span><span class="p">],</span>
            <span class="n">preprocess_data</span>        <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;preprocess_data&#39;</span><span class="p">],</span>
            <span class="n">boundary_condition</span>     <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;boundary_condition&#39;</span><span class="p">],</span>
            <span class="n">start_zone</span>             <span class="o">=</span> <span class="p">(</span><span class="n">start_zone_boundaries</span> <span class="k">if</span> <span class="n">start_zone_boundaries</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">start_zone</span><span class="p">),</span>
            <span class="n">odor_present_threshold</span> <span class="o">=</span> <span class="n">arguments</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;odor_present_threshold&#39;</span><span class="p">),</span>
            <span class="n">name</span>                   <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span>
            <span class="n">seed</span>                   <span class="o">=</span> <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="c1"># Folder where the environment was pulled from</span>
    <span class="n">loaded_env</span><span class="o">.</span><span class="n">saved_at</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">loaded_env</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.modify" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">modify</span><span class="p">(</span><span class="n">data_source_position</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">source_radius</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">margins</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">multiplier</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">interpolation_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">boundary_condition</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Returns a copy of the environment with one or more parameters modified.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>data_source_position</code></td>
          <td>
                <code>list | <span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new position for the source relative to the data file.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>source_radius</code></td>
          <td>
                <code>float | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new source radius.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>shape</code></td>
          <td>
                <code>list | <span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new shape of environment.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>margins</code></td>
          <td>
                <code>int | list | <span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new set of margins.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>multiplier</code></td>
          <td>
                <code>list | <span title="numpy.ndarray">ndarray</span> | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new multiplier to be applied to the data file (this will in turn increase or reduce the margins).</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>interpolation_method</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new interpolation method to be used.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>boundary_condition</code></td>
          <td>
                <code>str | None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>New boundary conditions for how the agent should behave at the edges.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>modified_environment</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A copy of the environment where the modified parameters have been applied.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">modify</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
           <span class="n">data_source_position</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">source_radius</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">shape</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">margins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">multiplier</span><span class="p">:</span> <span class="nb">list</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">interpolation_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
           <span class="n">boundary_condition</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
           <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Environment&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Returns a copy of the environment with one or more parameters modified.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    data_source_position: list or np.ndarray, optional</span>
<span class="sd">        A new position for the source relative to the data file.</span>
<span class="sd">    source_radius: float, optional</span>
<span class="sd">        A new source radius.</span>
<span class="sd">    shape: list or np.ndarray, optional</span>
<span class="sd">        A new shape of environment.</span>
<span class="sd">    margins: int or list or np.ndarray, optional</span>
<span class="sd">        A new set of margins.</span>
<span class="sd">    multiplier: list or np.ndarray, optional</span>
<span class="sd">        A new multiplier to be applied to the data file (this will in turn increase or reduce the margins).</span>
<span class="sd">    interpolation_method: str, optional</span>
<span class="sd">        A new interpolation method to be used.</span>
<span class="sd">    boundary_condition: str, optional</span>
<span class="sd">        New boundary conditions for how the agent should behave at the edges.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    modified_environment</span>
<span class="sd">        A copy of the environment where the modified parameters have been applied.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">to_cpu</span><span class="p">()</span><span class="o">.</span><span class="n">modify</span><span class="p">(</span>
            <span class="n">data_source_position</span> <span class="o">=</span> <span class="n">data_source_position</span><span class="p">,</span>
            <span class="n">source_radius</span>        <span class="o">=</span> <span class="n">source_radius</span><span class="p">,</span>
            <span class="n">shape</span>                <span class="o">=</span> <span class="n">shape</span><span class="p">,</span>
            <span class="n">margins</span>              <span class="o">=</span> <span class="n">margins</span><span class="p">,</span>
            <span class="n">multiplier</span>           <span class="o">=</span> <span class="n">multiplier</span><span class="p">,</span>
            <span class="n">interpolation_method</span> <span class="o">=</span> <span class="n">interpolation_method</span><span class="p">,</span>
            <span class="n">boundary_condition</span>   <span class="o">=</span> <span class="n">boundary_condition</span>
        <span class="p">)</span>

    <span class="n">modified_environment</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
        <span class="n">data_file</span>              <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">),</span>
        <span class="n">data_source_position</span>   <span class="o">=</span> <span class="p">(</span><span class="n">data_source_position</span> <span class="k">if</span> <span class="p">(</span><span class="n">data_source_position</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_data_source_position</span><span class="p">),</span>
        <span class="n">source_radius</span>          <span class="o">=</span> <span class="p">(</span><span class="n">source_radius</span> <span class="k">if</span> <span class="p">(</span><span class="n">source_radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span><span class="p">),</span>
        <span class="n">layers</span>                 <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">shape</span>                  <span class="o">=</span> <span class="p">(</span><span class="n">shape</span> <span class="k">if</span> <span class="p">(</span><span class="n">shape</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span>
        <span class="n">margins</span>                <span class="o">=</span> <span class="p">(</span><span class="n">margins</span> <span class="k">if</span> <span class="p">(</span><span class="n">margins</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="p">),</span>
        <span class="n">multiplier</span>             <span class="o">=</span> <span class="p">(</span><span class="n">multiplier</span> <span class="k">if</span> <span class="p">(</span><span class="n">multiplier</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">]),</span>
        <span class="n">interpolation_method</span>   <span class="o">=</span> <span class="p">(</span><span class="n">interpolation_method</span> <span class="k">if</span> <span class="p">(</span><span class="n">interpolation_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="p">),</span>
        <span class="n">preprocess_data</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span><span class="p">,</span>
        <span class="n">boundary_condition</span>     <span class="o">=</span> <span class="p">(</span><span class="n">boundary_condition</span> <span class="k">if</span> <span class="p">(</span><span class="n">boundary_condition</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span><span class="p">),</span>
        <span class="n">start_zone</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_type</span><span class="p">,</span>
        <span class="n">odor_present_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span><span class="p">,</span>
        <span class="n">name</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">seed</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">modified_environment</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.modify_scale" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">modify_scale</span><span class="p">(</span><span class="n">scale_factor</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to modify the size of the environment by a scale factor.
Everything will be scaled this factor. This includes: shape, margins, source radius, and data shape.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>scale_factor</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>By how much to modify the size of the current environment.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>modified_environment</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="olfactory_navigation.environment.Environment" href="#olfactory_navigation.environment.Environment">Environment</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The environment with the scale factor applied.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">modify_scale</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">scale_factor</span><span class="p">:</span> <span class="nb">float</span>
                 <span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Environment&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to modify the size of the environment by a scale factor.</span>
<span class="sd">    Everything will be scaled this factor. This includes: shape, margins, source radius, and data shape.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    scale_factor : float</span>
<span class="sd">        By how much to modify the size of the current environment.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    modified_environment : Environment</span>
<span class="sd">        The environment with the scale factor applied. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">modified_source_radius</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span> <span class="o">*</span> <span class="n">scale_factor</span>
    <span class="n">modified_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">modified_margins</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">margins</span> <span class="o">*</span> <span class="n">scale_factor</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

    <span class="n">modified_environment</span> <span class="o">=</span> <span class="n">Environment</span><span class="p">(</span>
        <span class="n">data_file</span>              <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">),</span>
        <span class="n">data_source_position</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_data_source_position</span><span class="p">,</span>
        <span class="n">source_radius</span>          <span class="o">=</span> <span class="n">modified_source_radius</span><span class="p">,</span>
        <span class="n">layers</span>                 <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="kc">False</span><span class="p">),</span>
        <span class="n">shape</span>                  <span class="o">=</span> <span class="n">modified_shape</span><span class="p">,</span>
        <span class="n">margins</span>                <span class="o">=</span> <span class="n">modified_margins</span><span class="p">,</span>
        <span class="n">multiplier</span>             <span class="o">=</span> <span class="p">[</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">],</span>
        <span class="n">interpolation_method</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="p">,</span>
        <span class="n">preprocess_data</span>        <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span><span class="p">,</span>
        <span class="n">boundary_condition</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span><span class="p">,</span>
        <span class="n">start_zone</span>             <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_type</span><span class="p">,</span>
        <span class="n">odor_present_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span><span class="p">,</span>
        <span class="n">name</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
        <span class="n">seed</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">modified_environment</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.move" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">move</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">movement</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Applies a movement vector to a position point and returns a new position point while respecting the boundary conditions.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>pos</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The start position of the movement.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>movement</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A 2D movement vector.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>new_pos</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The new position after applying the movement.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">move</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
         <span class="n">pos</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
         <span class="n">movement</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
         <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Applies a movement vector to a position point and returns a new position point while respecting the boundary conditions.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pos : np.ndarray</span>
<span class="sd">        The start position of the movement.</span>
<span class="sd">    movement : np.ndarray</span>
<span class="sd">        A 2D movement vector.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    new_pos : np.ndarray</span>
<span class="sd">        The new position after applying the movement.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>

    <span class="c1"># Applying the movement vector</span>
    <span class="n">new_pos</span> <span class="o">=</span> <span class="n">pos</span> <span class="o">+</span> <span class="n">movement</span>

    <span class="c1"># Handling the case we are dealing with a single point.</span>
    <span class="n">is_single_point</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_single_point</span><span class="p">:</span>
        <span class="n">new_pos</span> <span class="o">=</span> <span class="n">new_pos</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>

    <span class="n">shape_array</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">)[</span><span class="kc">None</span><span class="p">,:]</span>

    <span class="c1"># Wrap boundary</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span> <span class="o">==</span> <span class="s1">&#39;wrap&#39;</span><span class="p">:</span>
        <span class="n">new_pos</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_pos</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">new_pos</span> <span class="o">+</span> <span class="n">shape_array</span><span class="p">),</span> <span class="n">new_pos</span><span class="p">)</span>
        <span class="n">new_pos</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">new_pos</span> <span class="o">&gt;=</span> <span class="n">shape_array</span><span class="p">,</span> <span class="p">(</span><span class="n">new_pos</span> <span class="o">-</span> <span class="n">shape_array</span><span class="p">),</span> <span class="n">new_pos</span><span class="p">)</span>

    <span class="c1"># Stop boundary</span>
    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span> <span class="o">==</span> <span class="s1">&#39;stop&#39;</span><span class="p">:</span>
        <span class="n">new_pos</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">new_pos</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">shape_array</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Special wrap - vertical only</span>
    <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span> <span class="o">==</span> <span class="s1">&#39;wrap_vertical&#39;</span><span class="p">):</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">new_pos</span><span class="p">[</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">height</span>
        <span class="n">new_pos</span><span class="p">[</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">height</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">-=</span> <span class="n">height</span>

        <span class="n">new_pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="c1"># Special wrap - horizontal only</span>
    <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span> <span class="o">==</span> <span class="s1">&#39;wrap_horizontal&#39;</span><span class="p">):</span>
        <span class="n">height</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>

        <span class="n">new_pos</span><span class="p">[</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">width</span>
        <span class="n">new_pos</span><span class="p">[</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">width</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-=</span> <span class="n">width</span>

        <span class="n">new_pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">new_pos</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">height</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">new_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_single_point</span> <span class="k">else</span> <span class="n">new_pos</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.plot" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">plot</span><span class="p">(</span><span class="n">frame</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">layer</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Simple function to plot the environment with a single frame of odor cues.
The starting zone is also market down with a blue contour.
The source of the odor is marked by a red circle.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>frame</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The frame of odor cues to print.</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>layer</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The layer of the odor cues to print. (Ignored if the environment is not layered.)</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>ax</code></td>
          <td>
                <code><span title="matplotlib.pyplot.Axes">Axes</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An ax on which the environment can be plot.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
         <span class="n">frame</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
         <span class="n">layer</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
         <span class="n">ax</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">Axes</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
         <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Simple function to plot the environment with a single frame of odor cues.</span>
<span class="sd">    The starting zone is also market down with a blue contour.</span>
<span class="sd">    The source of the odor is marked by a red circle.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    frame : int, default=0</span>
<span class="sd">        The frame of odor cues to print.</span>
<span class="sd">    layer : int, default=0</span>
<span class="sd">        The layer of the odor cues to print. (Ignored if the environment is not layered.)</span>
<span class="sd">    ax : plt.Axes, optional</span>
<span class="sd">        An ax on which the environment can be plot.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># If on GPU use the CPU version to plot</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">frame</span><span class="o">=</span><span class="n">frame</span><span class="p">,</span>
            <span class="n">ax</span><span class="o">=</span><span class="n">ax</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="c1"># Blank return</span>

    <span class="c1"># TODO: Implement plotting for 3D</span>
    <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span> <span class="o">==</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;Plotting function only available for 2D environments for now...&quot;</span>

    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

    <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[[],[]]</span>

    <span class="c1"># Gather data frame</span>
    <span class="n">data_frame</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">layer</span><span class="p">][</span><span class="n">frame</span><span class="p">]</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">[</span><span class="n">frame</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_frame</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span><span class="p">:</span>
        <span class="n">data_frame</span> <span class="o">=</span> <span class="n">_resize_array</span><span class="p">(</span><span class="n">data_frame</span><span class="p">,</span>
                                   <span class="n">new_shape</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span><span class="p">,</span>
                                   <span class="n">interpolation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>

    <span class="c1"># Odor grid</span>
    <span class="n">odor</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">frame_data</span> <span class="o">=</span> <span class="p">(</span><span class="n">data_frame</span> <span class="o">&gt;</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="mi">0</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">environment_frame</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">environment_frame</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]:</span><span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="n">frame_data</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">environment_frame</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys&#39;</span><span class="p">)</span>

    <span class="n">legend_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">odor</span><span class="p">)</span>
    <span class="n">legend_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s1">&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="s1">&#39;&#39;</span> <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39; (layer </span><span class="si">{</span><span class="n">layer</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; odor cues&#39;</span><span class="p">)</span>

    <span class="c1"># Start zone contour</span>
    <span class="n">start_zone</span> <span class="o">=</span> <span class="n">Rectangle</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="p">,</span> <span class="n">levels</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">],</span> <span class="n">colors</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>

    <span class="n">legend_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">start_zone</span><span class="p">)</span>
    <span class="n">legend_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Start zone&#39;</span><span class="p">)</span>

    <span class="c1"># Source circle</span>
    <span class="n">goal_circle</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
    <span class="n">legend_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">goal_circle</span><span class="p">)</span>
    <span class="n">legend_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;Source&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">goal_circle</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>

    <span class="c1"># Legend</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_elements</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">legend_elements</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.random_start_points" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">random_start_points</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to generate n starting positions following the starting probabilities.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>n</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>How many random starting positions to generate</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>random_states_2d</code></td>          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The n random 2d points in a n x 2 array.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">random_start_points</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">n</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>
                        <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to generate n starting positions following the starting probabilities.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    n : int, default=1</span>
<span class="sd">        How many random starting positions to generate</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    random_states_2d : np.ndarray</span>
<span class="sd">        The n random 2d points in a n x 2 array. </span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>

    <span class="k">assert</span> <span class="p">(</span><span class="n">n</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;n has to be a strictly positive number (&gt;0)&quot;</span>

    <span class="n">random_states</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnd_state</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">))),</span> <span class="n">size</span><span class="o">=</span><span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="o">.</span><span class="n">ravel</span><span class="p">())</span>
    <span class="n">random_states_2d</span> <span class="o">=</span> <span class="n">xp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">random_states</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
    <span class="k">return</span> <span class="n">random_states_2d</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.save" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">save</span><span class="p">(</span><span class="n">folder</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_arrays</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to save the environment to the memory.</p>
<p>By default it saved in a new folder at the current path in a new folder with the name 'Env-<name>' where <name> is the name set when initializing an environment.
In this folder a file "METADATA.json" is created containing all the properties of the environment.</p>
<p>The numpy arrays of the environment (grid and start_probabilities) can be saved or not. If not, when the environment is loaded it needs to be reconstructed from the original data file.
The arrays are saved to .npy files along with the METADATA file.</p>
<p>If an environment of the same name is already saved, the saving will be interupted. It can however be forced with the force parameter.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>folder</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The folder to which to save the environment data. If it is not provided, it will be created in the current folder.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>save_arrays</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether or not to save the numpy arrays to memory. (The arrays can be heavy)</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>force</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>In case an environment of the same name is already saved, it will be overwritten.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
         <span class="n">folder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
         <span class="n">save_arrays</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
         <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
         <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to save the environment to the memory.</span>

<span class="sd">    By default it saved in a new folder at the current path in a new folder with the name &#39;Env-&lt;name&gt;&#39; where &lt;name&gt; is the name set when initializing an environment.</span>
<span class="sd">    In this folder a file &quot;METADATA.json&quot; is created containing all the properties of the environment.</span>

<span class="sd">    The numpy arrays of the environment (grid and start_probabilities) can be saved or not. If not, when the environment is loaded it needs to be reconstructed from the original data file.</span>
<span class="sd">    The arrays are saved to .npy files along with the METADATA file.</span>

<span class="sd">    If an environment of the same name is already saved, the saving will be interupted. It can however be forced with the force parameter.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    folder : str, optional</span>
<span class="sd">        The folder to which to save the environment data. If it is not provided, it will be created in the current folder.</span>
<span class="sd">    save_arrays : bool, default=False</span>
<span class="sd">        Whether or not to save the numpy arrays to memory. (The arrays can be heavy)</span>
<span class="sd">    force : bool, default=False</span>
<span class="sd">        In case an environment of the same name is already saved, it will be overwritten.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># If on gpu, use the cpu version to save</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span><span class="o">.</span><span class="n">save</span><span class="p">(</span>
            <span class="n">folder</span><span class="o">=</span><span class="n">folder</span><span class="p">,</span>
            <span class="n">save_arrays</span><span class="o">=</span><span class="n">save_arrays</span><span class="p">,</span>
            <span class="n">force</span><span class="o">=</span><span class="n">force</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="c1"># Blank return</span>

    <span class="c1"># Assert either data_file is provided or save_arrays is enabled</span>
    <span class="k">assert</span> <span class="n">save_arrays</span> <span class="ow">or</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)),</span> <span class="s2">&quot;The environment was not created from a data file so &#39;save_arrays&#39; has to be set to True.&quot;</span>

    <span class="c1"># Adding env name to folder path</span>
    <span class="k">if</span> <span class="n">folder</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">folder</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;./Env-</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">folder</span> <span class="o">+=</span> <span class="s1">&#39;/Env-&#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="c1"># Checking the folder exists or creates it</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">folder</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">folder</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1"> is not empty. If you want to overwrite the saved model, enable &quot;force&quot;.&#39;</span><span class="p">)</span>

    <span class="c1"># Generating the metadata arguments dictionary</span>
    <span class="n">arguments</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_file_path&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_file_path</span>

    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;timesteps&#39;</span><span class="p">]</span>                     <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timesteps</span><span class="p">)</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_shape&#39;</span><span class="p">]</span>                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_shape</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;dimensions&#39;</span><span class="p">]</span>                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dimensions</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;margins&#39;</span><span class="p">]</span>                       <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">margins</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;shape&#39;</span><span class="p">]</span>                         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_bounds&#39;</span><span class="p">]</span>                   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_bounds</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;original_data_source_position&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">original_data_source_position</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_source_position&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_source_position</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;layers&#39;</span><span class="p">]</span>                        <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layer_labels</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_layers</span> <span class="k">else</span> <span class="kc">False</span><span class="p">)</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;source_position&#39;</span><span class="p">]</span>               <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;source_radius&#39;</span><span class="p">]</span>                 <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;interpolation_method&#39;</span><span class="p">]</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">interpolation_method</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;preprocess_data&#39;</span><span class="p">]</span>               <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_preprocess_data</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;data_processed&#39;</span><span class="p">]</span>                <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">data_processed</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;boundary_condition&#39;</span><span class="p">]</span>            <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">boundary_condition</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;start_type&#39;</span><span class="p">]</span>                    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_type</span>
    <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>                          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">seed</span>

    <span class="c1"># Check how the start probabilities were built</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_type</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;custom&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">start_type</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">))</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">save_arrays</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Start probabilities have been set from a custom array, please enable save_arrays to be able to reconstruct the environment later.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">arguments</span><span class="p">[</span><span class="s1">&#39;odor_present_threshold&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">odor_present_threshold</span>

    <span class="c1"># Output the arguments to a METADATA file</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/METADATA.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">arguments</span><span class="p">,</span> <span class="n">json_file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

    <span class="c1"># Output the numpy arrays</span>
    <span class="k">if</span> <span class="n">save_arrays</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/data.npy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_data</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s1">&#39;The saving of data that is not a Numpy array was not implemented yet.&#39;</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">folder</span> <span class="o">+</span> <span class="s1">&#39;/start_probabilities.npy&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">start_probabilities</span><span class="p">)</span>

    <span class="c1"># Success print</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">saved_at</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">folder</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\\</span><span class="s1">&#39;</span><span class="p">,</span> <span class="s1">&#39;/&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Environment saved to: </span><span class="si">{</span><span class="n">folder</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.source_reached" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">source_reached</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Checks whether a given position is within the source radius.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>pos</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The position to check whether in the radius of the source.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>is_at_source</code></td>          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether or not the position is within the radius of the source.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">source_reached</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                   <span class="n">pos</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span>
                   <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Checks whether a given position is within the source radius.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    pos : np.ndarray</span>
<span class="sd">        The position to check whether in the radius of the source.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    is_at_source : bool</span>
<span class="sd">        Whether or not the position is within the radius of the source.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">xp</span> <span class="o">=</span> <span class="n">cp</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span> <span class="k">else</span> <span class="n">np</span>

    <span class="c1"># Handling the case of a single point</span>
    <span class="n">is_single_point</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">is_single_point</span><span class="p">:</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="n">pos</span><span class="p">[</span><span class="kc">None</span><span class="p">,:]</span>

    <span class="n">is_at_source</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="p">(</span><span class="n">xp</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">pos</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">source_position</span><span class="p">[</span><span class="kc">None</span><span class="p">,:])</span> <span class="o">**</span> <span class="mi">2</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">source_radius</span> <span class="o">**</span> <span class="mi">2</span><span class="p">))</span>

    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">is_at_source</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">is_single_point</span> <span class="k">else</span> <span class="n">is_at_source</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.to_cpu" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">to_cpu</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to send the numpy arrays of the environment to the cpu memory.
It returns a new instance of the Environment with the arrays as numpy arrays.</p>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>cpu_environment</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="olfactory_navigation.environment.Environment" href="#olfactory_navigation.environment.Environment">Environment</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new environment instance where the arrays are on the cpu memory.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_cpu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Environment&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to send the numpy arrays of the environment to the cpu memory.</span>
<span class="sd">    It returns a new instance of the Environment with the arrays as numpy arrays.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    cpu_environment : Environment</span>
<span class="sd">        A new environment instance where the arrays are on the cpu memory.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">on_gpu</span><span class="p">:</span>
        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Something went wrong&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span>

    <span class="k">return</span> <span class="bp">self</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="olfactory_navigation.environment.Environment.to_gpu" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">to_gpu</span><span class="p">()</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Function to send the numpy arrays of the environment to the gpu memory.
It returns a new instance of the Environment with the arrays as cupy arrays.</p>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>gpu_environment</code></td>          <td>
                <code><a class="autorefs autorefs-internal" title="olfactory_navigation.environment.Environment" href="#olfactory_navigation.environment.Environment">Environment</a></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A new environment instance where the arrays are on the gpu memory.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>olfactory_navigation\environment.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">to_gpu</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s1">&#39;Environment&#39;</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Function to send the numpy arrays of the environment to the gpu memory.</span>
<span class="sd">    It returns a new instance of the Environment with the arrays as cupy arrays.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    gpu_environment : Environment</span>
<span class="sd">        A new environment instance where the arrays are on the gpu memory.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="k">assert</span> <span class="n">gpu_support</span><span class="p">,</span> <span class="s2">&quot;GPU support is not enabled...&quot;</span>

    <span class="c1"># Generating a new instance</span>
    <span class="bp">cls</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span>
    <span class="n">gpu_environment</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>

    <span class="c1"># Copying arguments to gpu</span>
    <span class="k">for</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_environment</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
        <span class="k">elif</span> <span class="n">arg</span> <span class="o">==</span> <span class="s1">&#39;rnd_state&#39;</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_environment</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">cp</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">seed</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">gpu_environment</span><span class="p">,</span> <span class="n">arg</span><span class="p">,</span> <span class="n">val</span><span class="p">)</span>

    <span class="c1"># Self reference instances</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="n">gpu_environment</span>
    <span class="n">gpu_environment</span><span class="o">.</span><span class="n">_alternate_version</span> <span class="o">=</span> <span class="bp">self</span>

    <span class="n">gpu_environment</span><span class="o">.</span><span class="n">on_gpu</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="n">gpu_environment</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../build_environment_gui/" class="md-footer__link md-footer__link--prev" aria-label="Previous: build_environment_gui">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                build_environment_gui
              </div>
            </div>
          </a>
        
        
          
          <a href="../simulation/" class="md-footer__link md-footer__link--next" aria-label="Next: simulation">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                simulation
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "navigation.expand", "navigation.path", "navigation.top", "navigation.tabs"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5cfa9459.min.js"></script>
      
    
  </body>
</html>